<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Design C ‚Äî Quick Card Preview + Full Detail Panel</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; overflow: hidden; height: 100vh; background: #f3f4f6; }

  .banner { position: fixed; top: 50px; left: 50%; transform: translateX(-50%); background: #fef3c7; color: #92400e; padding: 5px 16px; border-radius: 0 0 8px 8px; font-size: 11px; font-weight: 600; z-index: 60; white-space: nowrap; }

  /* Header */
  .header { height: 44px; background: #fff; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; padding: 0 12px; gap: 8px; z-index: 30; position: relative; }
  .header h1 { font-size: 14px; font-weight: 700; color: #111827; }
  .sep { width: 1px; height: 20px; background: #e5e7eb; }
  .date-nav { display: flex; align-items: center; gap: 4px; }
  .date-nav button { background: none; border: none; cursor: pointer; font-size: 14px; color: #6b7280; padding: 2px 6px; border-radius: 4px; }
  .date-nav span { font-size: 13px; font-weight: 500; color: #374151; }
  .day-badge { font-size: 11px; background: #e5e7eb; color: #374151; padding: 1px 8px; border-radius: 4px; font-weight: 500; }
  .stat-dots { display: flex; gap: 4px; }
  .stat-dot { display: flex; align-items: center; gap: 3px; font-size: 11px; font-weight: 600; color: #374151; padding: 2px 6px; }
  .stat-dot .dot { width: 6px; height: 6px; border-radius: 50%; }
  .header-right { margin-left: auto; display: flex; align-items: center; gap: 6px; }
  .view-dropdown { padding: 4px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px; font-weight: 500; background: #fff; cursor: pointer; color: #374151; }
  .add-btn { height: 32px; padding: 0 10px; border: none; border-radius: 6px; background: #2563eb; color: #fff; font-size: 12px; font-weight: 600; cursor: pointer; }

  /* Timeline */
  .timeline-area { height: calc(50vh - 22px); overflow: hidden; background: #fff; }
  .timeline-flex { display: flex; height: 100%; }
  .crew-col { width: 150px; flex-shrink: 0; border-right: 1px solid #e5e7eb; }
  .crew-col-header { height: 28px; background: #fafafa; border-bottom: 1px solid #e5e7eb; }
  .crew-row { display: flex; align-items: center; height: 56px; padding: 0 10px; gap: 8px; border-bottom: 1px solid #f3f4f6; }
  .crew-avatar { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 11px; font-weight: 700; }
  .crew-info { flex: 1; }
  .crew-name { font-size: 13px; font-weight: 600; color: #111827; }
  .crew-meta { font-size: 10px; color: #9ca3af; }
  .unassigned-row { display: flex; height: 40px; background: #fef2f2; border-bottom: 1px solid #fecaca; align-items: center; padding: 0 10px; gap: 6px; }
  .unassigned-dot { width: 8px; height: 8px; border-radius: 50%; background: #ef4444; }
  .unassigned-label { font-size: 12px; font-weight: 600; color: #dc2626; }

  .grid-area { flex: 1; overflow-x: auto; }
  .time-headers { display: flex; height: 28px; border-bottom: 1px solid #e5e7eb; background: #fafafa; }
  .time-header { min-width: 80px; font-size: 10px; color: #9ca3af; font-weight: 500; display: flex; align-items: center; padding-left: 6px; border-right: 1px solid #f3f4f6; }
  .grid-row { height: 56px; border-bottom: 1px solid #f3f4f6; position: relative; min-width: 960px; }
  .job-block { height: 40px; border-radius: 6px; padding: 4px 8px; font-size: 11px; color: #fff; font-weight: 500; display: flex; flex-direction: column; justify-content: center; cursor: pointer; position: absolute; top: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: transform 0.15s; }
  .job-block:hover { transform: translateY(-1px); box-shadow: 0 3px 8px rgba(0,0,0,0.15); }
  .job-block .jb-title { font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .job-block .jb-sub { font-size: 10px; opacity: 0.8; }
  .ua-chips { display: flex; gap: 4px; padding: 8px; min-width: 960px; height: 40px; background: #fef2f2; }
  .ua-chip { padding: 4px 10px; background: #fff; border: 1px solid #fecaca; border-radius: 6px; font-size: 11px; font-weight: 500; color: #374151; cursor: pointer; }

  .status-legend { display: flex; gap: 12px; padding: 4px 12px; background: #fff; border-bottom: 1px solid #e5e7eb; font-size: 10px; color: #6b7280; justify-content: flex-end; }
  .sl-item { display: flex; align-items: center; gap: 4px; }
  .sl-dot { width: 6px; height: 6px; border-radius: 50%; }

  .drawer-handle { height: 28px; background: #f9fafb; border-top: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: center; gap: 8px; cursor: ns-resize; }
  .handle-bar { width: 40px; height: 4px; background: #d1d5db; border-radius: 2px; }
  .handle-label { font-size: 11px; color: #6b7280; font-weight: 500; }

  /* Map */
  .map-drawer { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
  .map-content { flex: 1; display: flex; overflow: hidden; position: relative; }
  .map-canvas { flex: 1; position: relative; background: linear-gradient(135deg, #dce8d0 0%, #e2dcc8 30%, #ddd8c6 50%, #d5ddd0 70%, #e0e4d6 100%); transition: margin-right 0.35s ease; }
  .map-canvas.panel-open { margin-right: 380px; }
  .map-roads { position: absolute; inset: 0; opacity: 0.12; }
  .area-label { position: absolute; font-weight: 500; letter-spacing: 1.5px; color: #777; font-size: 11px; }

  /* Pins */
  .map-pin { position: absolute; cursor: pointer; transition: transform 0.2s; z-index: 2; }
  .map-pin:hover { transform: scale(1.15); z-index: 5; }
  .map-pin.selected { transform: scale(1.25); z-index: 10; }
  .pin-svg { width: 28px; height: 34px; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.25)); }
  .pin-num { position: absolute; top: 4px; left: 50%; transform: translateX(-50%); font-size: 10px; font-weight: 700; color: #fff; }
  .pin-tip { position: absolute; bottom: calc(100% + 4px); left: 50%; transform: translateX(-50%); background: #1e293b; color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 10px; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.15s; }
  .map-pin:hover .pin-tip { opacity: 1; }
  .map-pin.selected .pin-tip { opacity: 0; }

  /* ‚ïê‚ïê‚ïê POPUP CARD (Level 1 ‚Äî Quick Preview) ‚ïê‚ïê‚ïê */
  .popup-card { position: absolute; width: 300px; background: #fff; border-radius: 10px; box-shadow: 0 6px 30px rgba(0,0,0,0.25); z-index: 50; opacity: 0; transform: translateY(8px) scale(0.95); pointer-events: none; transition: opacity 0.2s, transform 0.2s; overflow: hidden; }
  .popup-card.open { opacity: 1; transform: translateY(0) scale(1); pointer-events: all; }
  .popup-card .popup-arrow { position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent; border-top: 8px solid #fff; }

  .popup-photo-strip { display: flex; height: 70px; gap: 2px; overflow: hidden; background: #f3f4f6; }
  .popup-photo-strip img { width: 33.33%; height: 100%; object-fit: cover; }

  .popup-body { padding: 10px 12px; }
  .popup-title { font-size: 14px; font-weight: 600; color: #111827; }
  .popup-subtitle { font-size: 11px; color: #6b7280; margin-top: 1px; }
  .popup-meta { display: flex; gap: 8px; margin-top: 6px; font-size: 11px; color: #4b5563; }
  .popup-meta-item { display: flex; align-items: center; gap: 3px; }
  .popup-tags { display: flex; gap: 4px; margin-top: 6px; }
  .popup-tag { font-size: 9px; font-weight: 600; padding: 2px 6px; border-radius: 99px; }

  .popup-actions { display: flex; gap: 4px; padding: 8px 12px; border-top: 1px solid #f3f4f6; }
  .popup-action { flex: 1; padding: 6px; font-size: 10px; font-weight: 600; border-radius: 5px; cursor: pointer; border: none; text-align: center; transition: background 0.15s; }
  .action-details { background: #2563eb; color: #fff; }
  .action-details:hover { background: #1d4ed8; }
  .action-nav { background: #f3f4f6; color: #374151; }
  .action-nav:hover { background: #e5e7eb; }
  .action-call { background: #f3f4f6; color: #374151; }
  .action-call:hover { background: #e5e7eb; }

  /* ‚ïê‚ïê‚ïê FULL DETAIL PANEL (Level 2) ‚ïê‚ïê‚ïê */
  .detail-panel { position: absolute; right: 0; top: 0; bottom: 0; width: 380px; background: #fff; border-left: 1px solid #e5e7eb; transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.4,0,0.2,1); z-index: 20; display: flex; flex-direction: column; box-shadow: -3px 0 15px rgba(0,0,0,0.08); }
  .detail-panel.open { transform: translateX(0); }

  .dp-header { padding: 14px 16px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: flex-start; }
  .dp-header h3 { font-size: 16px; font-weight: 600; color: #111827; }
  .dp-header p { font-size: 12px; color: #6b7280; margin-top: 2px; line-height: 1.3; }
  .dp-close { background: none; border: none; cursor: pointer; width: 28px; height: 28px; border-radius: 6px; color: #9ca3af; font-size: 16px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
  .dp-close:hover { background: #f3f4f6; color: #374151; }

  .dp-body { flex: 1; overflow-y: auto; padding: 14px 16px; }

  .dp-customer { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
  .dp-cust-name { font-size: 14px; font-weight: 600; color: #111827; }
  .dp-cust-phone { font-size: 12px; color: #2563eb; cursor: pointer; margin-top: 2px; }
  .dp-badge { font-size: 10px; font-weight: 500; padding: 2px 8px; border-radius: 99px; background: #dbeafe; color: #1d4ed8; }
  .dp-info-row { display: flex; align-items: flex-start; gap: 6px; font-size: 12px; color: #4b5563; margin-bottom: 6px; }
  .dp-icon { width: 14px; height: 14px; flex-shrink: 0; margin-top: 1px; color: #9ca3af; }
  .dp-divider { border-top: 1px solid #e5e7eb; margin: 10px 0; }
  .dp-form-group { margin-bottom: 10px; }
  .dp-label { font-size: 11px; font-weight: 500; color: #374151; margin-bottom: 3px; display: block; }
  .dp-select { width: 100%; padding: 6px 8px; font-size: 12px; border: 1px solid #d1d5db; border-radius: 5px; background: #fff; }
  .dp-tab-group { display: flex; margin-bottom: 4px; border: 1px solid #d1d5db; border-radius: 5px; overflow: hidden; }
  .dp-tab-btn { flex: 1; padding: 4px 8px; font-size: 10px; font-weight: 500; border: none; cursor: pointer; text-align: center; background: #fff; color: #6b7280; }
  .dp-tab-btn.active { background: #f3f4f6; color: #111827; }

  .photo-section-title { display: flex; justify-content: space-between; margin-bottom: 8px; }
  .photo-section-title span:first-child { font-size: 12px; font-weight: 600; color: #111827; }
  .photo-section-title span:last-child { font-size: 10px; color: #6b7280; }
  .photo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
  .photo-thumb { aspect-ratio: 1; border-radius: 6px; overflow: hidden; cursor: pointer; position: relative; border: 1px solid #e5e7eb; transition: transform 0.15s; }
  .photo-thumb:hover { transform: scale(1.05); box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
  .photo-thumb img { width: 100%; height: 100%; object-fit: cover; }
  .photo-thumb .zo { position: absolute; inset: 0; background: rgba(0,0,0,0.35); display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.15s; }
  .photo-thumb:hover .zo { opacity: 1; }
  .zo svg { width: 18px; height: 18px; color: #fff; }

  .quick-actions { display: flex; gap: 4px; margin-top: 10px; }
  .qa-btn { flex: 1; padding: 6px 4px; font-size: 10px; font-weight: 500; border: 1px solid #e5e7eb; border-radius: 5px; background: #fff; cursor: pointer; text-align: center; color: #374151; display: flex; flex-direction: column; align-items: center; gap: 2px; }
  .qa-btn:hover { background: #f3f4f6; }

  .dp-footer { padding: 10px 16px; border-top: 1px solid #e5e7eb; display: flex; gap: 6px; }
  .dp-btn { flex: 1; padding: 7px 12px; font-size: 12px; font-weight: 500; border-radius: 6px; cursor: pointer; border: none; text-align: center; }
  .dp-btn-outline { background: #fff; border: 1px solid #d1d5db; color: #374151; }
  .dp-btn-primary { background: #2563eb; color: #fff; }

  /* Sidebar */
  .map-sidebar { width: 240px; background: #fff; border-left: 1px solid #e5e7eb; overflow-y: auto; flex-shrink: 0; }
  .sidebar-title { padding: 6px 10px; border-bottom: 1px solid #f3f4f6; font-size: 10px; font-weight: 600; color: #9ca3af; text-transform: uppercase; }
  .sg-header { display: flex; align-items: center; gap: 6px; padding: 4px 10px; background: #fafafa; border-bottom: 1px solid #f3f4f6; }
  .sg-color { width: 10px; height: 10px; border-radius: 2px; }
  .sg-name { font-size: 11px; font-weight: 600; }
  .sg-count { font-size: 10px; color: #9ca3af; margin-left: auto; }
  .sj-item { display: flex; align-items: center; gap: 8px; padding: 6px 10px; border-bottom: 1px solid #f9fafb; cursor: pointer; transition: background 0.1s; }
  .sj-item:hover { background: #f9fafb; }
  .sj-item.active { background: #eff6ff; }
  .sj-num { width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 10px; font-weight: 700; flex-shrink: 0; }
  .sj-info { flex: 1; min-width: 0; }
  .sj-title { font-size: 12px; font-weight: 500; color: #111827; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .sj-addr { font-size: 10px; color: #9ca3af; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .sj-time { font-size: 10px; color: #b0b0b0; }

  /* Map controls */
  .map-zoom { position: absolute; bottom: 12px; right: 12px; background: #fff; border-radius: 6px; box-shadow: 0 1px 4px rgba(0,0,0,0.15); overflow: hidden; z-index: 5; transition: right 0.35s; }
  .map-zoom.shifted { right: 392px; }
  .map-zoom button { display: block; width: 32px; height: 32px; border: none; background: #fff; cursor: pointer; font-size: 16px; color: #374151; border-bottom: 1px solid #e5e7eb; }
  .map-zoom button:last-child { border-bottom: none; }
  .map-legend { position: absolute; bottom: 12px; left: 12px; background: #fff; padding: 6px 10px; border-radius: 6px; box-shadow: 0 1px 4px rgba(0,0,0,0.15); font-size: 10px; z-index: 5; }
  .legend-row { display: flex; align-items: center; gap: 5px; margin-bottom: 3px; }
  .legend-row:last-child { margin-bottom: 0; }
  .legend-dot { width: 8px; height: 8px; border-radius: 50%; }

  /* Lightbox */
  .lightbox { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 200; }
  .lightbox.open { display: flex; }
  .lightbox img { max-width: 85%; max-height: 80vh; border-radius: 8px; }
  .lb-close { position: absolute; top: 16px; right: 16px; background: rgba(255,255,255,0.15); border: none; color: #fff; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; }
  .lb-nav { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.15); border: none; color: #fff; width: 44px; height: 44px; border-radius: 50%; cursor: pointer; font-size: 22px; display: flex; align-items: center; justify-content: center; }
  .lb-nav.prev { left: 16px; }
  .lb-nav.next { right: 16px; }
</style>
</head>
<body>

<div class="banner">DESIGN C ‚Äî Hover Pin = Quick Card ¬∑ Click "View Details" or Sidebar = Full Panel</div>

<!-- Header -->
<div class="header">
  <h1>Dispatch</h1><div class="sep"></div>
  <div class="date-nav">
    <button>‚Äπ</button><button>‚Ä∫</button>
    <span>Monday, February 9, 2026</span>
    <span class="day-badge">Day</span>
  </div>
  <div class="sep"></div>
  <div class="stat-dots">
    <div class="stat-dot"><div class="dot" style="background:#ef4444;"></div>2</div>
    <div class="stat-dot"><div class="dot" style="background:#3b82f6;"></div>4</div>
    <div class="stat-dot"><div class="dot" style="background:#eab308;"></div>1</div>
    <div class="stat-dot"><div class="dot" style="background:#22c55e;"></div>1</div>
  </div>
  <div class="header-right">
    <span style="font-size:12px;color:#6b7280;">View:</span>
    <button class="view-dropdown">üë• Crew + Map ‚ñæ</button>
    <button class="add-btn">+ Job</button>
  </div>
</div>

<!-- Timeline -->
<div class="timeline-area">
  <div class="timeline-flex">
    <div class="crew-col">
      <div class="crew-col-header"></div>
      <div class="unassigned-row">
        <div class="unassigned-dot"></div>
        <span class="unassigned-label">Unassigned</span>
      </div>
      <div class="crew-row">
        <div class="crew-avatar" style="background:#2563eb;">T1</div>
        <div class="crew-info"><div class="crew-name">Truck 1</div><div class="crew-meta">Adam R. ¬∑ 5 jobs</div></div>
      </div>
      <div class="crew-row">
        <div class="crew-avatar" style="background:#dc2626;">T2</div>
        <div class="crew-info"><div class="crew-name">Truck 2</div><div class="crew-meta">John S., Sammy T ¬∑ 2 jobs</div></div>
      </div>
    </div>
    <div class="grid-area">
      <div class="time-headers">
        <div class="time-header">6am</div><div class="time-header">7am</div><div class="time-header">8am</div><div class="time-header">9am</div><div class="time-header">10am</div><div class="time-header">11am</div><div class="time-header">12pm</div><div class="time-header">1pm</div><div class="time-header">2pm</div><div class="time-header">3pm</div><div class="time-header">4pm</div><div class="time-header">5pm</div>
      </div>
      <div class="ua-chips"><div class="ua-chip">HVAC Maintenance</div><div class="ua-chip">Garage Door Fix</div></div>
      <div class="grid-row">
        <div class="job-block" style="background:#2563eb;left:80px;width:120px;" onclick="openFullPanel('ac')"><span class="jb-title">AC Unit Repair</span><span class="jb-sub">Adam Richardson</span></div>
        <div class="job-block" style="background:#2563eb;left:240px;width:140px;"><span class="jb-title">Electrical Panel</span><span class="jb-sub">David Chen</span></div>
        <div class="job-block" style="background:#eab308;left:480px;width:100px;"><span class="jb-title">HVAC Maint.</span><span class="jb-sub">James Thompson</span></div>
        <div class="job-block" style="background:#2563eb;left:640px;width:120px;"><span class="jb-title">Water Heater</span><span class="jb-sub">Maria Gonzales</span></div>
      </div>
      <div class="grid-row">
        <div class="job-block" style="background:#dc2626;left:240px;width:120px;" onclick="openFullPanel('plumb')"><span class="jb-title">Plumbing Insp.</span><span class="jb-sub">Sarah Mitchell</span></div>
        <div class="job-block" style="background:#dc2626;left:480px;width:100px;"><span class="jb-title">Kitchen Faucet</span><span class="jb-sub">Lisa Park</span></div>
      </div>
    </div>
  </div>
</div>

<div class="status-legend">
  <div class="sl-item"><div class="sl-dot" style="background:#6b7280;"></div>Unassigned</div>
  <div class="sl-item"><div class="sl-dot" style="background:#3b82f6;"></div>Scheduled</div>
  <div class="sl-item"><div class="sl-dot" style="background:#eab308;"></div>In Progress</div>
  <div class="sl-item"><div class="sl-dot" style="background:#22c55e;"></div>Completed</div>
  <div class="sl-item"><div class="sl-dot" style="background:#ef4444;"></div>Cancelled</div>
</div>

<div class="drawer-handle">
  <div class="handle-bar"></div>
  <span class="handle-label">üó∫ Map View ¬∑ 8 jobs</span>
  <div class="handle-bar"></div>
</div>

<!-- Map -->
<div class="map-drawer">
  <div class="map-content">
    <div class="map-canvas" id="mapCanvas">
      <svg class="map-roads" style="width:100%;height:100%;">
        <line x1="0" y1="30%" x2="100%" y2="28%" stroke="#888" stroke-width="2"/>
        <line x1="0" y1="60%" x2="100%" y2="62%" stroke="#888" stroke-width="2"/>
        <line x1="25%" y1="0" x2="27%" y2="100%" stroke="#888" stroke-width="2"/>
        <line x1="55%" y1="0" x2="52%" y2="100%" stroke="#888" stroke-width="2"/>
        <line x1="80%" y1="0" x2="78%" y2="100%" stroke="#888" stroke-width="1.5"/>
      </svg>
      <div class="area-label" style="top:15%;left:35%;">SCOTTSDALE</div>
      <div class="area-label" style="top:65%;left:45%;">TEMPE</div>
      <div class="area-label" style="top:40%;left:12%;">PHOENIX</div>

      <!-- Pins -->
      <div class="map-pin" id="pin1" data-job="ac" style="top:20%;left:38%;" onclick="pinClick(1)" onmouseenter="showCard(1)" onmouseleave="scheduleHideCard()">
        <svg class="pin-svg" viewBox="0 0 28 34"><path d="M14 0C6.3 0 0 6.3 0 14c0 10.5 14 20 14 20s14-9.5 14-20C28 6.3 21.7 0 14 0z" fill="#2563eb"/></svg>
        <span class="pin-num">1</span><div class="pin-tip">AC Unit Repair</div>
      </div>
      <div class="map-pin" id="pin2" style="top:35%;left:50%;" onmouseenter="showCard(2)" onmouseleave="scheduleHideCard()">
        <svg class="pin-svg" viewBox="0 0 28 34"><path d="M14 0C6.3 0 0 6.3 0 14c0 10.5 14 20 14 20s14-9.5 14-20C28 6.3 21.7 0 14 0z" fill="#2563eb"/></svg>
        <span class="pin-num">2</span><div class="pin-tip">Electrical Panel</div>
      </div>
      <div class="map-pin" id="pin3" style="top:55%;left:42%;" onmouseenter="showCard(3)" onmouseleave="scheduleHideCard()">
        <svg class="pin-svg" viewBox="0 0 28 34"><path d="M14 0C6.3 0 0 6.3 0 14c0 10.5 14 20 14 20s14-9.5 14-20C28 6.3 21.7 0 14 0z" fill="#eab308"/></svg>
        <span class="pin-num">3</span><div class="pin-tip">HVAC Maint.</div>
      </div>
      <div class="map-pin" id="pin4" style="top:25%;left:65%;" onmouseenter="showCard(4)" onmouseleave="scheduleHideCard()">
        <svg class="pin-svg" viewBox="0 0 28 34"><path d="M14 0C6.3 0 0 6.3 0 14c0 10.5 14 20 14 20s14-9.5 14-20C28 6.3 21.7 0 14 0z" fill="#2563eb"/></svg>
        <span class="pin-num">4</span><div class="pin-tip">Water Heater</div>
      </div>
      <div class="map-pin" id="pin5" data-job="plumb" style="top:42%;left:28%;" onclick="pinClick(5)" onmouseenter="showCard(5)" onmouseleave="scheduleHideCard()">
        <svg class="pin-svg" viewBox="0 0 28 34"><path d="M14 0C6.3 0 0 6.3 0 14c0 10.5 14 20 14 20s14-9.5 14-20C28 6.3 21.7 0 14 0z" fill="#dc2626"/></svg>
        <span class="pin-num">1</span><div class="pin-tip">Plumbing Insp.</div>
      </div>
      <div class="map-pin" id="pin6" style="top:60%;left:58%;" onmouseenter="showCard(6)" onmouseleave="scheduleHideCard()">
        <svg class="pin-svg" viewBox="0 0 28 34"><path d="M14 0C6.3 0 0 6.3 0 14c0 10.5 14 20 14 20s14-9.5 14-20C28 6.3 21.7 0 14 0z" fill="#dc2626"/></svg>
        <span class="pin-num">2</span><div class="pin-tip">Kitchen Faucet</div>
      </div>
      <div class="map-pin" id="pin7" style="top:70%;left:35%;" onmouseenter="showCard(7)" onmouseleave="scheduleHideCard()">
        <svg class="pin-svg" viewBox="0 0 28 34"><path d="M14 0C6.3 0 0 6.3 0 14c0 10.5 14 20 14 20s14-9.5 14-20C28 6.3 21.7 0 14 0z" fill="#6b7280"/></svg>
        <span class="pin-num">?</span><div class="pin-tip">HVAC Maint. (Unassigned)</div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Popup Card (Level 1) ‚ïê‚ïê‚ïê -->
      <div class="popup-card" id="popupCard" onmouseenter="cancelHideCard()" onmouseleave="scheduleHideCard()">
        <div class="popup-photo-strip">
          <img src="https://images.unsplash.com/photo-1585771724684-38269d6639fd?w=150&h=80&fit=crop"/>
          <img src="https://images.unsplash.com/photo-1631545806609-3c480a498e26?w=150&h=80&fit=crop"/>
          <img src="https://images.unsplash.com/photo-1504328345606-18bbc8c9d7d1?w=150&h=80&fit=crop"/>
        </div>
        <div class="popup-body">
          <div class="popup-title" id="cardTitle">AC Unit Repair</div>
          <div class="popup-subtitle" id="cardCustomer">Adam Richardson ¬∑ (480) 555-1234</div>
          <div class="popup-meta">
            <div class="popup-meta-item">üïê <span id="cardTime">07:00</span></div>
            <div class="popup-meta-item">‚è± <span id="cardDur">90 min</span></div>
            <div class="popup-meta-item">üìç <span id="cardAddr">Scottsdale</span></div>
          </div>
          <div class="popup-tags">
            <span class="popup-tag" id="cardStatus" style="background:#dbeafe;color:#1d4ed8;">Scheduled</span>
            <span class="popup-tag" id="cardTech" style="background:#2563eb;color:#fff;">Truck 1</span>
          </div>
        </div>
        <div class="popup-actions">
          <button class="popup-action action-details" onclick="openFullPanelFromCard()">View Details</button>
          <button class="popup-action action-nav">Navigate ‚Üó</button>
          <button class="popup-action action-call">üìû Call</button>
        </div>
        <div class="popup-arrow"></div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Full Detail Panel (Level 2) ‚ïê‚ïê‚ïê -->
      <div class="detail-panel" id="detailPanel">
        <div class="dp-header">
          <div>
            <h3>AC Unit Repair</h3>
            <p>Central AC not cooling properly. Customer reports warm air from all vents.</p>
          </div>
          <button class="dp-close" onclick="closePanel()">‚úï</button>
        </div>
        <div class="dp-body">
          <div class="dp-customer">
            <div>
              <div class="dp-cust-name">Adam Richardson</div>
              <div class="dp-cust-phone">üìû (480) 555-1234</div>
            </div>
            <span class="dp-badge">Normal</span>
          </div>
          <div class="dp-info-row">
            <svg class="dp-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
            <span>4521 E Cactus Rd, Scottsdale, AZ 85254</span>
          </div>
          <div class="dp-info-row">
            <svg class="dp-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
            <span>2026-02-09 at 07:00</span>
          </div>
          <div class="dp-info-row">
            <svg class="dp-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            <span>90 minutes</span>
          </div>
          <div class="dp-info-row">
            <svg class="dp-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
            <span>Check refrigerant levels and clean condenser coils.</span>
          </div>

          <div class="dp-divider"></div>

          <div class="dp-form-group">
            <label class="dp-label">Status</label>
            <select class="dp-select"><option selected>Scheduled</option><option>In Progress</option><option>Completed</option><option>Cancelled</option></select>
          </div>
          <div class="dp-form-group">
            <label class="dp-label">Assigned Technician</label>
            <div class="dp-tab-group"><button class="dp-tab-btn active">Individual</button><button class="dp-tab-btn">Crew</button></div>
            <select class="dp-select"><option>Truck 1 ‚Äî Adam R.</option><option>Truck 2 ‚Äî John S., Sammy T</option><option>Jimmy G.</option></select>
          </div>

          <div class="dp-divider"></div>

          <div class="photo-section-title"><span>Job Photos</span><span>5 photos</span></div>
          <div class="photo-grid">
            <div class="photo-thumb" onclick="openLB(0)"><img src="https://images.unsplash.com/photo-1585771724684-38269d6639fd?w=200&h=200&fit=crop"/><div class="zo"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div></div>
            <div class="photo-thumb" onclick="openLB(1)"><img src="https://images.unsplash.com/photo-1631545806609-3c480a498e26?w=200&h=200&fit=crop"/><div class="zo"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div></div>
            <div class="photo-thumb" onclick="openLB(2)"><img src="https://images.unsplash.com/photo-1504328345606-18bbc8c9d7d1?w=200&h=200&fit=crop"/><div class="zo"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div></div>
            <div class="photo-thumb" onclick="openLB(3)"><img src="https://images.unsplash.com/photo-1621905252507-b35492cc74b4?w=200&h=200&fit=crop"/><div class="zo"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div></div>
            <div class="photo-thumb" onclick="openLB(4)"><img src="https://images.unsplash.com/photo-1558618666-fcd25c85f82e?w=200&h=200&fit=crop"/><div class="zo"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div></div>
          </div>

          <div class="quick-actions">
            <button class="qa-btn"><span>üìû</span>Call</button>
            <button class="qa-btn"><span>üìç</span>Navigate</button>
            <button class="qa-btn"><span>üìß</span>Email</button>
            <button class="qa-btn"><span>üìã</span>Copy</button>
          </div>
        </div>
        <div class="dp-footer">
          <button class="dp-btn dp-btn-outline" onclick="closePanel()">Close</button>
          <button class="dp-btn dp-btn-primary">View Full Job ‚Üí</button>
        </div>
      </div>

      <div class="map-zoom" id="mapZoom"><button>+</button><button>‚àí</button></div>
      <div class="map-legend">
        <div class="legend-row"><div class="legend-dot" style="background:#2563eb;"></div>Truck 1 (5)</div>
        <div class="legend-row"><div class="legend-dot" style="background:#dc2626;"></div>Truck 2 (2)</div>
        <div class="legend-row"><div class="legend-dot" style="background:#6b7280;"></div>Unassigned (2)</div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="map-sidebar">
      <div class="sidebar-title">Today's Jobs (8)</div>
      <div class="sg-header"><div class="sg-color" style="background:#2563eb;"></div><span class="sg-name" style="color:#2563eb;">Truck 1 ‚Äî Adam R.</span><span class="sg-count">5</span></div>
      <div class="sj-item" id="sj1" onclick="openFullPanel('ac')"><div class="sj-num" style="background:#2563eb;">1</div><div class="sj-info"><div class="sj-title">AC Unit Repair</div><div class="sj-addr">4521 E Cactus Rd</div><div class="sj-time">07:00</div></div></div>
      <div class="sj-item" id="sj2" onclick="openFullPanel('elec')"><div class="sj-num" style="background:#2563eb;">2</div><div class="sj-info"><div class="sj-title">Electrical Panel</div><div class="sj-addr">789 E Camelback</div><div class="sj-time">09:00</div></div></div>
      <div class="sj-item" id="sj3"><div class="sj-num" style="background:#eab308;">3</div><div class="sj-info"><div class="sj-title">HVAC Maint.</div><div class="sj-addr">555 W Indian School</div><div class="sj-time">13:00</div></div></div>
      <div class="sj-item" id="sj4"><div class="sj-num" style="background:#2563eb;">4</div><div class="sj-info"><div class="sj-title">Water Heater</div><div class="sj-addr">321 E Paradise Ln</div><div class="sj-time">15:00</div></div></div>
      <div class="sg-header"><div class="sg-color" style="background:#dc2626;"></div><span class="sg-name" style="color:#dc2626;">Truck 2 ‚Äî John S.</span><span class="sg-count">2</span></div>
      <div class="sj-item" id="sj5" onclick="openFullPanel('plumb')"><div class="sj-num" style="background:#dc2626;">1</div><div class="sj-info"><div class="sj-title">Plumbing Insp.</div><div class="sj-addr">1220 N Central Ave</div><div class="sj-time">09:00</div></div></div>
      <div class="sj-item" id="sj6"><div class="sj-num" style="background:#dc2626;">2</div><div class="sj-info"><div class="sj-title">Kitchen Faucet</div><div class="sj-addr">999 S Mill Ave</div><div class="sj-time">13:00</div></div></div>
      <div class="sg-header"><div class="sg-color" style="background:#6b7280;"></div><span class="sg-name" style="color:#6b7280;">Unassigned</span><span class="sg-count">2</span></div>
      <div class="sj-item" id="sj7"><div class="sj-num" style="background:#6b7280;">?</div><div class="sj-info"><div class="sj-title">HVAC Maintenance</div><div class="sj-addr">456 W McDowell</div><div class="sj-time">‚Äî</div></div></div>
    </div>
  </div>
</div>

<!-- Lightbox -->
<div class="lightbox" id="lightbox" onclick="closeLB()">
  <button class="lb-close" onclick="closeLB()">‚úï</button>
  <button class="lb-nav prev" onclick="event.stopPropagation(); navLB(-1)">‚Äπ</button>
  <img id="lbImg" src="" onclick="event.stopPropagation()" />
  <button class="lb-nav next" onclick="event.stopPropagation(); navLB(1)">‚Ä∫</button>
</div>

<script>
const photos = [
  'https://images.unsplash.com/photo-1585771724684-38269d6639fd?w=900&h=700&fit=crop',
  'https://images.unsplash.com/photo-1631545806609-3c480a498e26?w=900&h=700&fit=crop',
  'https://images.unsplash.com/photo-1504328345606-18bbc8c9d7d1?w=900&h=700&fit=crop',
  'https://images.unsplash.com/photo-1621905252507-b35492cc74b4?w=900&h=700&fit=crop',
  'https://images.unsplash.com/photo-1558618666-fcd25c85f82e?w=900&h=700&fit=crop',
];
let currentPhoto = 0;
let hideCardTimer = null;
let currentCardPin = null;
let panelOpen = false;

const jobData = {
  1: { title: 'AC Unit Repair', customer: 'Adam Richardson ¬∑ (480) 555-1234', time: '07:00', dur: '90 min', addr: 'Scottsdale', status: 'Scheduled', statusBg: '#dbeafe', statusColor: '#1d4ed8', tech: 'Truck 1', techBg: '#2563eb' },
  2: { title: 'Electrical Panel', customer: 'David Chen ¬∑ (480) 555-2345', time: '09:00', dur: '120 min', addr: 'Phoenix', status: 'Scheduled', statusBg: '#dbeafe', statusColor: '#1d4ed8', tech: 'Truck 1', techBg: '#2563eb' },
  3: { title: 'HVAC Maint.', customer: 'James Thompson ¬∑ (480) 555-3456', time: '13:00', dur: '60 min', addr: 'Phoenix', status: 'In Progress', statusBg: '#fef3c7', statusColor: '#92400e', tech: 'Truck 1', techBg: '#eab308' },
  4: { title: 'Water Heater', customer: 'Maria Gonzales ¬∑ (480) 555-4567', time: '15:00', dur: '90 min', addr: 'Scottsdale', status: 'Scheduled', statusBg: '#dbeafe', statusColor: '#1d4ed8', tech: 'Truck 1', techBg: '#2563eb' },
  5: { title: 'Plumbing Insp.', customer: 'Sarah Mitchell ¬∑ (480) 555-5678', time: '09:00', dur: '60 min', addr: 'Phoenix', status: 'Scheduled', statusBg: '#dbeafe', statusColor: '#1d4ed8', tech: 'Truck 2', techBg: '#dc2626' },
  6: { title: 'Kitchen Faucet', customer: 'Lisa Park ¬∑ (480) 555-6789', time: '13:00', dur: '45 min', addr: 'Tempe', status: 'Scheduled', statusBg: '#dbeafe', statusColor: '#1d4ed8', tech: 'Truck 2', techBg: '#dc2626' },
  7: { title: 'HVAC Maintenance', customer: 'Unassigned', time: '‚Äî', dur: '60 min', addr: 'Phoenix', status: 'Unassigned', statusBg: '#f3f4f6', statusColor: '#6b7280', tech: 'Unassigned', techBg: '#6b7280' },
};

function showCard(pinId) {
  if (panelOpen) return; // don't show card if full panel is open
  cancelHideCard();
  currentCardPin = pinId;
  const pin = document.getElementById('pin' + pinId);
  const card = document.getElementById('popupCard');
  const mapRect = document.getElementById('mapCanvas').getBoundingClientRect();
  const pinRect = pin.getBoundingClientRect();
  const data = jobData[pinId];

  // Update card content
  document.getElementById('cardTitle').textContent = data.title;
  document.getElementById('cardCustomer').textContent = data.customer;
  document.getElementById('cardTime').textContent = data.time;
  document.getElementById('cardDur').textContent = data.dur;
  document.getElementById('cardAddr').textContent = data.addr;
  document.getElementById('cardStatus').textContent = data.status;
  document.getElementById('cardStatus').style.background = data.statusBg;
  document.getElementById('cardStatus').style.color = data.statusColor;
  document.getElementById('cardTech').textContent = data.tech;
  document.getElementById('cardTech').style.background = data.techBg;

  // Position above pin
  let left = pinRect.left - mapRect.left + pinRect.width / 2 - 150;
  let top = pinRect.top - mapRect.top - 260;
  if (left < 10) left = 10;
  if (left + 300 > mapRect.width - 10) left = mapRect.width - 310;
  if (top < 10) {
    top = pinRect.top - mapRect.top + pinRect.height + 10;
    card.querySelector('.popup-arrow').style.display = 'none';
  } else {
    card.querySelector('.popup-arrow').style.display = 'block';
  }

  card.style.left = left + 'px';
  card.style.top = top + 'px';
  card.classList.add('open');

  // Highlight pin
  document.querySelectorAll('.map-pin').forEach(p => p.classList.remove('selected'));
  pin.classList.add('selected');
}

function scheduleHideCard() {
  hideCardTimer = setTimeout(() => {
    document.getElementById('popupCard').classList.remove('open');
    if (!panelOpen) {
      document.querySelectorAll('.map-pin').forEach(p => p.classList.remove('selected'));
    }
    currentCardPin = null;
  }, 300);
}

function cancelHideCard() {
  if (hideCardTimer) { clearTimeout(hideCardTimer); hideCardTimer = null; }
}

function pinClick(pinId) {
  // Clicking pin directly opens card (hover already does this)
  showCard(pinId);
}

function openFullPanelFromCard() {
  document.getElementById('popupCard').classList.remove('open');
  document.getElementById('detailPanel').classList.add('open');
  document.getElementById('mapCanvas').classList.add('panel-open');
  document.getElementById('mapZoom').classList.add('shifted');
  panelOpen = true;
  // Highlight sidebar
  document.querySelectorAll('.sj-item').forEach(s => s.classList.remove('active'));
  if (currentCardPin) {
    const sj = document.getElementById('sj' + currentCardPin);
    if (sj) sj.classList.add('active');
  }
}

function openFullPanel(jobId) {
  document.getElementById('popupCard').classList.remove('open');
  document.getElementById('detailPanel').classList.add('open');
  document.getElementById('mapCanvas').classList.add('panel-open');
  document.getElementById('mapZoom').classList.add('shifted');
  panelOpen = true;
  // Highlight sidebar + pin
  document.querySelectorAll('.sj-item').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.map-pin').forEach(p => p.classList.remove('selected'));
}

function closePanel() {
  document.getElementById('detailPanel').classList.remove('open');
  document.getElementById('mapCanvas').classList.remove('panel-open');
  document.getElementById('mapZoom').classList.remove('shifted');
  document.querySelectorAll('.map-pin').forEach(p => p.classList.remove('selected'));
  document.querySelectorAll('.sj-item').forEach(s => s.classList.remove('active'));
  panelOpen = false;
}

// Close on map background click
document.getElementById('mapCanvas').addEventListener('click', function(e) {
  if (e.target === this || e.target.closest('.map-roads') || e.target.closest('.area-label')) {
    document.getElementById('popupCard').classList.remove('open');
    if (panelOpen) closePanel();
    document.querySelectorAll('.map-pin').forEach(p => p.classList.remove('selected'));
  }
});

function openLB(i) { currentPhoto = i; document.getElementById('lbImg').src = photos[i]; document.getElementById('lightbox').classList.add('open'); }
function closeLB() { document.getElementById('lightbox').classList.remove('open'); }
function navLB(d) { currentPhoto = (currentPhoto + d + photos.length) % photos.length; document.getElementById('lbImg').src = photos[currentPhoto]; }
</script>

</body>
</html>
