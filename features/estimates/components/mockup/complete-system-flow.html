<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Complete System Flow — All Pages Connected</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f8fafc; margin: 0; color: #1e293b; font-size: 13px; }
    .card { background: white; border: 1px solid #e2e8f0; border-radius: 0.75rem; }
    .cp { padding: 0.875rem 1rem; }
    .fi { display: flex; align-items: center; justify-content: space-between; padding: 0.35rem 0; }
    .fi-l { color: #64748b; font-weight: 500; }
    .fi select { border: none; background: none; color: #2563eb; font-weight: 500; cursor: pointer; text-align: right; font-size: 13px; }
    .b { font-size: 12px; font-weight: 500; padding: 5px 10px; border-radius: 6px; cursor: pointer; display: inline-flex; align-items: center; gap: 4px; transition: all 0.15s; border: none; }
    .b-blue { background: #2563eb; color: white; }
    .b-green { background: #16a34a; color: white; }
    .b-amber { background: #f59e0b; color: white; }
    .b-out { background: white; color: #475569; border: 1px solid #e2e8f0 !important; }
    .b-ghost { background: none; border: none; color: #2563eb; cursor: pointer; font-weight: 500; padding: 0; }
    .ico { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border: 1px solid #e2e8f0; border-radius: 6px; background: white; cursor: pointer; }
    .ico:hover { background: #f1f5f9; }
    .dot { width: 9px; height: 9px; border-radius: 50%; flex-shrink: 0; }
    .pr { display: flex; justify-content: space-between; padding: 0.3rem 0; }
    .badge { font-size: 11px; padding: 1px 7px; border-radius: 999px; font-weight: 600; }
    .total-bar { background: #1e40af; color: white; border-radius: 0 0 0.75rem 0.75rem; padding: 10px 16px; margin-top: -1px; }
    .fade { animation: fadeIn 0.2s ease; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* Nav */
    .nav-bar { background: #1e293b; color: white; position: sticky; top: 0; z-index: 50; }
    .nav-inner { max-width: 1400px; margin: 0 auto; padding: 0 20px; display: flex; align-items: center; gap: 0; overflow-x: auto; }
    .nav-btn { padding: 10px 14px; font-size: 12px; font-weight: 500; cursor: pointer; color: rgba(255,255,255,0.6); border: none; background: none; white-space: nowrap; border-bottom: 2px solid transparent; transition: all 0.15s; }
    .nav-btn:hover { color: white; }
    .nav-btn.on { color: white; border-bottom-color: #3b82f6; }
    .nav-sep { width: 1px; height: 20px; background: rgba(255,255,255,0.15); flex-shrink: 0; }

    /* Lifecycle */
    .lc { display: flex; align-items: center; gap: 0; }
    .lc-d { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; flex-shrink: 0; }
    .lc-d.done { background: #16a34a; color: white; }
    .lc-d.on { background: #2563eb; color: white; box-shadow: 0 0 0 3px rgba(37,99,235,0.2); }
    .lc-d.off { background: #f1f5f9; color: #94a3b8; }
    .lc-ln { width: 20px; height: 2px; }
    .lc-ln.done { background: #16a34a; }
    .lc-ln.off { background: #e2e8f0; }
    .lc-t { font-size: 10px; text-align: center; margin-top: 2px; }

    /* Toggle */
    .tog { display: flex; background: #f1f5f9; border-radius: 6px; padding: 2px; }
    .tog-b { padding: 6px 12px; font-size: 12px; font-weight: 500; border: none; background: none; cursor: pointer; border-radius: 4px; color: #64748b; }
    .tog-b.on { background: white; color: #1e293b; box-shadow: 0 1px 2px rgba(0,0,0,0.08); }

    /* Section toggle */
    .st { display: flex; align-items: center; justify-content: space-between; padding: 6px 10px; border-bottom: 1px solid #f1f5f9; }
    .sw { width: 32px; height: 18px; border-radius: 9px; background: #e2e8f0; cursor: pointer; position: relative; transition: 0.2s; }
    .sw.on { background: #2563eb; }
    .sw::after { content: ''; width: 14px; height: 14px; border-radius: 50%; background: white; position: absolute; top: 2px; left: 2px; transition: 0.2s; }
    .sw.on::after { transform: translateX(14px); }

    /* Tabs */
    .tab-row { display: flex; border-bottom: 1px solid #e2e8f0; }
    .tab { padding: 8px 14px; font-size: 13px; font-weight: 500; cursor: pointer; color: #94a3b8; border-bottom: 2px solid transparent; margin-bottom: -1px; }
    .tab.on { color: #1e293b; border-bottom-color: #1e293b; }

    /* Timeline */
    .tl { display: flex; gap: 10px; padding-bottom: 10px; position: relative; }
    .tl::before { content: ''; position: absolute; left: 4px; top: 16px; bottom: 0; width: 1px; background: #e2e8f0; }
    .tl:last-child::before { display: none; }

    .view { display: none; }
    .view.on { display: block; }

    /* Mode bar */
    .mode-bar { background: #fffbeb; border-bottom: 1px solid #fde68a; padding: 6px 0; }
    .mode-inner { max-width: 1400px; margin: 0 auto; padding: 0 20px; display: flex; align-items: center; gap: 12px; }
    .mode-tog { display: flex; background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 2px; }
    .mode-btn { padding: 4px 12px; font-size: 11px; font-weight: 600; border: none; background: none; cursor: pointer; border-radius: 4px; color: #64748b; transition: 0.15s; }
    .mode-btn.on { background: #1e293b; color: white; }
    .mode-hint { font-size: 11px; color: #92400e; }

    /* Assignment card highlight */
    .assign-card { transition: all 0.3s ease; }
    .assign-card.highlight { box-shadow: 0 0 0 2px #f59e0b; }

    /* Slide panel */
    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.25); z-index: 90; display: none; }
    .overlay.show { display: block; }
    .spanel { position: fixed; top: 0; right: -100%; width: min(400px, 90vw); height: 100vh; background: white; box-shadow: -4px 0 24px rgba(0,0,0,0.12); z-index: 100; transition: right 0.25s ease; overflow-y: auto; }
    .spanel.open { right: 0; }
    .sp-head { background: #1e293b; color: white; padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 1; }
    .sp-close { background: none; border: none; color: white; font-size: 20px; cursor: pointer; line-height: 1; }

    @media (max-width: 1024px) {
      .grid-3 { grid-template-columns: 1fr !important; }
      .grid-2 { grid-template-columns: 1fr !important; }
    }
  </style>
</head>
<body>

<!-- ===== NAVIGATION BAR ===== -->
<div class="nav-bar">
  <div class="nav-inner">
    <div style="font-weight:700;font-size:13px;padding:10px 14px 10px 0;white-space:nowrap;">System Flow</div>
    <div class="nav-sep"></div>
    <button class="nav-btn on" id="n-est-list" onclick="go('est-list')">Estimates List</button>
    <button class="nav-btn" id="n-est-detail" onclick="go('est-detail')">Estimate Detail</button>
    <button class="nav-btn" id="n-est-preview" onclick="go('est-preview')">Customer Page</button>
    <div class="nav-sep"></div>
    <button class="nav-btn" id="n-jobs-list" onclick="go('jobs-list')">Jobs List</button>
    <button class="nav-btn" id="n-job-est" onclick="go('job-est')">Job (from Estimate)</button>
    <button class="nav-btn" id="n-job-quick" onclick="go('job-quick')">Job (Quick Book)</button>
    <button class="nav-btn" id="n-job-recur" onclick="go('job-recur')">Recurring Job</button>
    <div class="nav-sep"></div>
    <button class="nav-btn" id="n-scheduler" onclick="go('scheduler')" style="color:#8b5cf6;">Job Scheduler</button>
    <button class="nav-btn" id="n-dispatch" onclick="go('dispatch')">Dispatch Board</button>
    <div class="nav-sep"></div>
    <button class="nav-btn" id="n-payments" onclick="go('payments')">Payments</button>
    <button class="nav-btn" id="n-portal" onclick="go('portal')">Customer Portal</button>
    <div class="nav-sep"></div>
    <button class="nav-btn" id="n-needed" onclick="go('needed')" style="color:#f59e0b;">Things Needed</button>
    <div class="nav-sep"></div>
    <button class="nav-btn" id="n-map" onclick="go('map')">System Map</button>
  </div>
</div>

<!-- ===== COMPANY MODE TOGGLE BAR ===== -->
<div class="mode-bar">
  <div class="mode-inner">
    <span style="font-size:11px;font-weight:700;color:#92400e;">ASSIGNMENT MODE:</span>
    <div class="mode-tog">
      <button class="mode-btn" id="m-individual" onclick="setMode('individual')">Individual</button>
      <button class="mode-btn" id="m-crew" onclick="setMode('crew')">Crew</button>
      <button class="mode-btn on" id="m-both" onclick="setMode('both')">Both</button>
    </div>
    <span class="mode-hint" id="mode-hint">Toggle to see how assignment UI adapts per company type. "Both" = moving companies. "Individual" = pest control. "Crew" = cleaning teams.</span>
  </div>
</div>

<!-- ===== CUSTOMER HEADER (shared) ===== -->
<div style="background:white;border-bottom:1px solid #e2e8f0;">
  <div style="max-width:1400px;margin:0 auto;padding:8px 20px;display:flex;align-items:center;justify-content:space-between;">
    <div style="display:flex;align-items:center;gap:10px;">
      <a href="#" style="color:#64748b;text-decoration:none;">&larr;</a>
      <div style="width:32px;height:32px;border-radius:50%;background:#2563eb;color:white;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px;">J</div>
      <div>
        <div style="display:flex;align-items:center;gap:6px;"><span style="font-size:14px;font-weight:700;">John</span><span class="badge" style="background:#dbeafe;color:#2563eb;">Lead</span></div>
        <div style="font-size:11px;color:#64748b;">6029030482 &bull; teachout05@gmail.com</div>
      </div>
    </div>
    <div style="display:flex;gap:6px;">
      <button class="b b-out">Edit</button>
      <button class="b b-blue">+New Job</button>
    </div>
  </div>
</div>

<div style="max-width:1400px;margin:0 auto;padding:16px 20px;">

<!-- ================================================================ -->
<!-- 1. ESTIMATES LIST                                                 -->
<!-- ================================================================ -->
<div class="view on fade" id="v-est-list">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
    <div><div style="font-size:15px;font-weight:600;">Estimates</div><div style="color:#64748b;">2 estimates for John</div></div>
    <button class="b b-blue" style="padding:6px 14px;">+ Create Estimate</button>
  </div>
  <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:14px;" class="grid-2">
    <div class="card cp"><div style="color:#64748b;">Total</div><div style="font-size:20px;font-weight:700;">2</div></div>
    <div class="card cp"><div style="color:#64748b;">Pending</div><div style="font-size:20px;font-weight:700;color:#d97706;">1</div></div>
    <div class="card cp"><div style="color:#64748b;">Approved</div><div style="font-size:20px;font-weight:700;color:#16a34a;">$850</div></div>
    <div class="card cp"><div style="color:#64748b;">Conversion</div><div style="font-size:20px;font-weight:700;">50%</div></div>
  </div>
  <div class="card" style="overflow:hidden;">
    <table style="width:100%;border-collapse:collapse;">
      <thead><tr style="background:#f8fafc;border-bottom:1px solid #e2e8f0;">
        <th style="text-align:left;padding:8px 16px;color:#64748b;font-weight:500;">Estimate</th>
        <th style="text-align:left;padding:8px 16px;color:#64748b;font-weight:500;">Date</th>
        <th style="text-align:left;padding:8px 16px;color:#64748b;font-weight:500;">Amount</th>
        <th style="text-align:left;padding:8px 16px;color:#64748b;font-weight:500;">Status</th>
        <th style="text-align:left;padding:8px 16px;color:#64748b;font-weight:500;">Job</th>
        <th style="padding:8px 16px;"></th>
      </tr></thead>
      <tbody>
        <tr style="border-bottom:1px solid #f1f5f9;cursor:pointer;" onclick="go('est-detail')" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">
          <td style="padding:10px 16px;font-weight:600;">EST-001</td>
          <td style="padding:10px 16px;">Jan 15</td>
          <td style="padding:10px 16px;font-weight:600;">$425.00</td>
          <td style="padding:10px 16px;"><span class="badge" style="background:#fef3c7;color:#92400e;">Sent</span></td>
          <td style="padding:10px 16px;"><span class="badge" style="background:#f1f5f9;color:#64748b;">Unscheduled</span></td>
          <td style="padding:10px 16px;text-align:right;"><button class="b-ghost" onclick="event.stopPropagation();go('est-detail')">View</button></td>
        </tr>
        <tr style="cursor:pointer;" onclick="go('job-est')" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">
          <td style="padding:10px 16px;font-weight:600;">EST-002</td>
          <td style="padding:10px 16px;">Jan 20</td>
          <td style="padding:10px 16px;font-weight:600;">$150.00</td>
          <td style="padding:10px 16px;"><span class="badge" style="background:#dcfce7;color:#166534;">Approved</span></td>
          <td style="padding:10px 16px;"><span class="badge" style="background:#dbeafe;color:#1e40af;">Scheduled</span></td>
          <td style="padding:10px 16px;text-align:right;"><button class="b-ghost" onclick="event.stopPropagation();go('job-recur')">View</button></td>
        </tr>
      </tbody>
    </table>
  </div>
  <div style="border:2px dashed #3b82f6;background:#eff6ff;border-radius:8px;padding:10px;text-align:center;margin-top:14px;">
    <b>Page 1: Estimates List</b> — All estimates for this customer. "Job" column shows if it's been booked. Click a row to open inline detail.
  </div>
</div>

<!-- ================================================================ -->
<!-- 2. ESTIMATE DETAIL (V3 inline + lifecycle)                        -->
<!-- ================================================================ -->
<div class="view fade" id="v-est-detail">
  <!-- Breadcrumb + Lifecycle -->
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;flex-wrap:wrap;gap:8px;">
    <div style="display:flex;align-items:center;gap:6px;"><a href="#" onclick="event.preventDefault();go('est-list')" style="color:#2563eb;text-decoration:none;">Estimates</a><span style="color:#cbd5e1;">/</span><span style="font-weight:600;">EST-001</span></div>
    <div class="lc">
      <div class="lc-d done" style="cursor:pointer;" title="Estimate">&#10003;</div><div class="lc-ln done"></div>
      <div class="lc-d on" style="cursor:pointer;" onclick="go('est-preview')" title="Page">2</div><div class="lc-ln off"></div>
      <div class="lc-d off" title="Approved">3</div><div class="lc-ln off"></div>
      <div class="lc-d off" title="Scheduled">4</div><div class="lc-ln off"></div>
      <div class="lc-d off" title="Contract">5</div><div class="lc-ln off"></div>
      <div class="lc-d off" title="Invoice">6</div>
    </div>
    <div style="display:flex;gap:6px;">
      <div class="ico" title="Documents" onclick="openPanel('docs')"><svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg></div>
      <div class="ico" title="Activity" onclick="openPanel('activity')"><svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></div>
      <div class="ico" title="Payments" onclick="openPanel('pay')" style="position:relative;"><svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg></div>
      <div style="position:relative;display:inline-block;">
        <button class="b b-green" onclick="this.nextElementSibling.style.display=this.nextElementSibling.style.display==='block'?'none':'block'">Book &darr;</button>
        <div style="display:none;position:absolute;right:0;top:100%;margin-top:4px;background:white;border:1px solid #e2e8f0;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.1);min-width:180px;z-index:50;overflow:hidden;">
          <div style="padding:8px 12px;cursor:pointer;font-size:13px;border-bottom:1px solid #f1f5f9;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''" onclick="this.parentElement.style.display='none';mode('prev')">&#128065; Preview Estimate</div>
          <div style="padding:8px 12px;cursor:pointer;font-size:13px;border-bottom:1px solid #f1f5f9;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">&#9993; Send Estimate</div>
          <div style="padding:8px 12px;cursor:pointer;font-size:13px;border-bottom:1px solid #f1f5f9;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''" onclick="this.parentElement.style.display='none';openPanel('pay')">&#128179; Take Payment</div>
          <div style="padding:8px 12px;cursor:pointer;font-size:13px;border-bottom:1px solid #f1f5f9;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''" onclick="this.parentElement.style.display='none';openPanel('schedule')">&#128197; Book Job</div>
          <div style="padding:8px 12px;cursor:pointer;font-size:13px;color:#dc2626;border-bottom:1px solid #f1f5f9;" onmouseover="this.style.background='#fef2f2'" onmouseout="this.style.background=''">&#10005; Mark Lost</div>
          <div style="padding:8px 12px;cursor:pointer;font-size:13px;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">&#128203; Duplicate</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mode Toggle -->
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
    <div class="tog">
      <button class="tog-b on" id="m-edit" onclick="mode('edit')">Estimate Editor</button>
      <button class="tog-b" id="m-prev" onclick="mode('prev')">Customer Page</button>
    </div>
    <span class="badge" style="background:#fef3c7;color:#92400e;">Sent — Unscheduled</span>
  </div>

  <!-- EDITOR MODE -->
  <div id="editor" class="grid-3" style="display:grid;grid-template-columns:210px 1fr 260px;gap:10px;align-items:start;">
    <!-- L -->
    <div style="display:flex;flex-direction:column;gap:10px;">
      <div class="card cp">
        <div style="font-weight:600;margin-bottom:6px;">Quote Info</div>
        <div class="fi"><span class="fi-l">Number</span><span style="font-weight:600;">EST-001</span></div>
        <div class="fi"><span class="fi-l">Type</span><select><option selected>Local</option></select></div>
        <div class="fi"><span class="fi-l">Source</span><select><option selected>Website</option></select></div>
        <div class="fi"><span class="fi-l">Sales</span><select><option selected>Daniela</option></select></div>
        <div class="fi"><span class="fi-l">Tags</span><a href="#" style="color:#2563eb;">+</a></div>
      </div>
      <div class="card cp">
        <div style="display:flex;justify-content:space-between;"><span style="font-weight:600;">Tasks</span><a href="#" style="color:#2563eb;">+</a></div>
        <div style="text-align:center;color:#94a3b8;padding:8px 0;">No tasks</div>
      </div>
    </div>
    <!-- C -->
    <div style="display:flex;flex-direction:column;gap:10px;">
      <div class="card cp">
        <div style="display:flex;justify-content:space-between;margin-bottom:8px;"><span style="font-size:14px;font-weight:600;">Stops</span><div style="display:flex;gap:6px;"><a href="#" style="color:#2563eb;font-size:12px;">Map</a><a href="#" style="color:#2563eb;">+</a></div></div>
        <div style="background:#e2e8f0;border-radius:6px;height:70px;display:flex;align-items:center;justify-content:center;margin-bottom:8px;cursor:pointer;position:relative;">
          <div style="font-size:12px;color:#64748b;">&#128205; Phoenix 85015 &mdash;&mdash; &#128205; Phoenix 85041</div>
          <div style="position:absolute;bottom:4px;right:6px;background:white;border-radius:4px;padding:2px 6px;font-size:10px;font-weight:600;color:#2563eb;">12.4 mi &bull; 18 min</div>
        </div>
        <div style="display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid #f1f5f9;"><span class="dot" style="background:#3b82f6;"></span><span style="color:#2563eb;font-weight:500;width:70px;">Origin</span><span>Phoenix, AZ 85015</span></div>
        <div style="display:flex;align-items:center;gap:8px;padding:6px 0;"><span class="dot" style="background:#16a34a;"></span><span style="color:#2563eb;font-weight:500;width:70px;">Destination</span><span>Phoenix, AZ 85041</span></div>
      </div>
      <div class="card">
        <div class="tab-row"><div class="tab on">Internal</div><div class="tab">Customer</div><div class="tab">Crew</div></div>
        <div style="padding:10px;"><textarea style="width:100%;min-height:80px;border:1px solid #e2e8f0;border-radius:6px;padding:8px;font-size:13px;resize:vertical;">2 bedroom apt, 1st to 2nd floor, no appliances</textarea></div>
      </div>
    </div>
    <!-- R -->
    <div style="display:flex;flex-direction:column;gap:10px;">
      <div class="card cp">
        <div style="font-weight:600;margin-bottom:8px;">Resources</div>
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:6px;text-align:center;">
          <div style="background:#f8fafc;border-radius:4px;padding:6px;"><div style="font-size:10px;color:#64748b;text-transform:uppercase;">Trucks</div><div style="font-size:15px;font-weight:700;">1</div></div>
          <div style="background:#f8fafc;border-radius:4px;padding:6px;"><div style="font-size:10px;color:#64748b;text-transform:uppercase;">Team</div><div style="font-size:15px;font-weight:700;">2</div></div>
          <div style="background:#f8fafc;border-radius:4px;padding:6px;"><div style="font-size:10px;color:#64748b;text-transform:uppercase;">Hours</div><div style="font-size:15px;font-weight:700;">2h</div></div>
          <div style="background:#f0fdf4;border-radius:4px;padding:6px;"><div style="font-size:10px;color:#16a34a;text-transform:uppercase;">Rate</div><div style="font-size:15px;font-weight:700;color:#16a34a;">$150</div></div>
        </div>
      </div>
      <div class="card">
        <div class="cp">
          <div class="pr"><a href="#" style="color:#2563eb;">Moving Services</a><span style="font-weight:500;">$300</span></div>
          <div class="pr"><a href="#" style="color:#2563eb;">Trip Fee</a><span style="font-weight:500;">$125</span></div>
          <div style="border-top:1px dashed #fde68a;margin:6px 0;"></div>
          <div style="font-size:10px;font-weight:600;color:#92400e;text-transform:uppercase;margin-bottom:2px;">Auto-Fees</div>
          <div class="pr"><label style="display:flex;align-items:center;gap:4px;cursor:pointer;"><input type="checkbox" checked style="accent-color:#f59e0b;"> <span style="color:#92400e;">Supply Fee (10%)</span></label><span style="font-weight:500;">$42.50</span></div>
          <div style="border-top:1px solid #e2e8f0;margin:4px 0;"></div>
          <div class="pr"><span style="font-weight:600;">Estimated Total</span><span style="font-weight:600;">$467.50</span></div>
          <div class="pr"><a href="#" style="color:#2563eb;" onclick="event.preventDefault();openPanel('pay')">Payments</a><span style="color:#94a3b8;">&mdash;</span></div>
          <div style="border-top:1px solid #e2e8f0;margin:4px 0;"></div>
          <div class="pr"><span style="font-weight:700;">Balance</span><span style="font-weight:700;">$467.50</span></div>
        </div>
        <div class="total-bar"><div style="display:flex;justify-content:space-between;align-items:baseline;"><span style="font-weight:600;">Price:</span><span style="font-size:18px;font-weight:700;">$467.50</span></div></div>
      </div>
    </div>
  </div>

  <!-- PREVIEW MODE (hidden by default) -->
  <div id="preview" style="display:none;" class="grid-2">
    <div style="display:grid;grid-template-columns:1fr 240px;gap:10px;align-items:start;">
      <div class="card" style="overflow:hidden;">
        <div style="background:#1e293b;color:white;padding:8px 14px;display:flex;justify-content:space-between;font-size:12px;">
          <span style="font-weight:600;">Customer View</span>
          <div style="display:flex;gap:6px;"><button class="b" style="background:rgba(255,255,255,0.15);color:white;font-size:11px;">Copy Link</button><button class="b b-blue" style="font-size:11px;">Send</button></div>
        </div>
        <div style="padding:24px;max-width:600px;margin:0 auto;">
          <div id="ps-hero" style="background:linear-gradient(135deg,#1e40af,#3b82f6);border-radius:10px;padding:32px 20px;text-align:center;color:white;margin-bottom:14px;">
            <div style="font-size:11px;text-transform:uppercase;letter-spacing:0.1em;opacity:0.8;">Your Moving Estimate</div>
            <div style="font-size:28px;font-weight:700;margin:8px 0;">$425.00</div>
            <div style="font-size:13px;opacity:0.9;">Local Move &bull; 2 Movers &bull; 2 Hours</div>
          </div>
          <div id="ps-trust" style="display:flex;justify-content:center;gap:24px;padding:10px 0;margin-bottom:14px;">
            <div style="text-align:center;"><div style="font-size:16px;">&#9733;</div><div style="font-size:11px;color:#64748b;">5-Star</div></div>
            <div style="text-align:center;"><div style="font-size:16px;">&#128274;</div><div style="font-size:11px;color:#64748b;">Insured</div></div>
            <div style="text-align:center;"><div style="font-size:16px;">&#128666;</div><div style="font-size:11px;color:#64748b;">1000+ Moves</div></div>
          </div>
          <div id="ps-pricing" class="card cp" style="margin-bottom:14px;">
            <div style="font-weight:600;margin-bottom:6px;">Pricing</div>
            <div class="pr"><span>Moving (2x2hr x$150)</span><span>$300</span></div>
            <div class="pr"><span>Trip Fee</span><span>$125</span></div>
            <div style="border-top:1px solid #e2e8f0;margin:4px 0;"></div>
            <div class="pr"><span style="font-weight:700;">Total</span><span style="font-weight:700;">$425</span></div>
          </div>
          <div id="ps-approve" class="card cp" style="border-color:#16a34a;border-width:2px;text-align:center;">
            <div style="font-weight:600;margin-bottom:8px;">Ready to Book?</div>
            <div style="display:flex;gap:8px;justify-content:center;"><button class="b b-green" style="padding:8px 24px;">Approve & Sign</button><button class="b b-out">Changes</button></div>
            <div style="font-size:11px;color:#64748b;margin-top:6px;">Deposit: $100 due</div>
          </div>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;gap:10px;">
        <div class="card">
          <div style="padding:8px 10px;border-bottom:1px solid #e2e8f0;font-weight:600;">Sections</div>
          <div class="st"><span>Hero</span><div class="sw on" onclick="this.classList.toggle('on');document.getElementById('ps-hero').style.display=this.classList.contains('on')?'block':'none'"></div></div>
          <div class="st"><span>Trust Badges</span><div class="sw on" onclick="this.classList.toggle('on');document.getElementById('ps-trust').style.display=this.classList.contains('on')?'flex':'none'"></div></div>
          <div class="st"><span>Pricing</span><div class="sw on" onclick="this.classList.toggle('on');document.getElementById('ps-pricing').style.display=this.classList.contains('on')?'block':'none'"></div></div>
          <div class="st"><span>Approval</span><div class="sw on" onclick="this.classList.toggle('on');document.getElementById('ps-approve').style.display=this.classList.contains('on')?'block':'none'"></div></div>
          <div style="padding:8px 10px;border-top:1px solid #e2e8f0;"><button class="b b-blue" style="width:100%;justify-content:center;">Open Builder</button></div>
        </div>
        <div class="card cp">
          <div style="font-weight:600;margin-bottom:6px;">Settings</div>
          <div class="fi"><span class="fi-l">Deposit</span><select><option>$100</option></select></div>
          <div class="fi"><span class="fi-l">Template</span><select><option>Moving Default</option></select></div>
        </div>
        <div class="card cp">
          <div style="font-weight:600;margin-bottom:8px;">Send</div>
          <div style="display:flex;flex-direction:column;gap:4px;">
            <button class="b b-blue" style="width:100%;justify-content:center;">Email</button>
            <button class="b b-out" style="width:100%;justify-content:center;">Text</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div style="border:2px dashed #3b82f6;background:#eff6ff;border-radius:8px;padding:10px;text-align:center;margin-top:14px;">
    <b>Page 2: Estimate Detail</b> — Editor mode (build pricing) ↔ Customer Page (preview what they see). Toggle between them. Lifecycle bar shows progress. "Book" creates the job.
  </div>
</div>

<!-- ================================================================ -->
<!-- 3. CUSTOMER PAGE PREVIEW (standalone)                             -->
<!-- ================================================================ -->
<div class="view fade" id="v-est-preview">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
    <div style="display:flex;align-items:center;gap:6px;"><a href="#" onclick="event.preventDefault();go('est-detail')" style="color:#2563eb;text-decoration:none;">EST-001</a><span style="color:#cbd5e1;">/</span><span style="font-weight:600;">Customer Page</span></div>
  </div>
  <div style="text-align:center;padding:40px;background:white;border:1px solid #e2e8f0;border-radius:12px;">
    <div style="font-size:16px;font-weight:700;margin-bottom:8px;">This is shown on the Estimate Detail page</div>
    <div style="color:#64748b;margin-bottom:16px;">Click "Customer Page" toggle on the Estimate Detail to see the preview with section controls</div>
    <button class="b b-blue" onclick="go('est-detail')">Go to Estimate Detail</button>
  </div>
</div>

<!-- ================================================================ -->
<!-- 4. JOBS LIST                                                      -->
<!-- ================================================================ -->
<div class="view fade" id="v-jobs-list">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
    <div><div style="font-size:15px;font-weight:600;">Jobs</div><div style="color:#64748b;">All jobs for John — from estimates &amp; quick-booked</div></div>
    <div style="display:flex;gap:6px;">
      <button class="b b-out">+ Quick Book Job</button>
      <button class="b b-blue">+ Create Estimate</button>
    </div>
  </div>
  <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:14px;" class="grid-2">
    <div class="card cp"><div style="color:#64748b;">Total Jobs</div><div style="font-size:20px;font-weight:700;">3</div></div>
    <div class="card cp"><div style="color:#64748b;">Upcoming</div><div style="font-size:20px;font-weight:700;color:#2563eb;">2</div></div>
    <div class="card cp"><div style="color:#64748b;">Completed</div><div style="font-size:20px;font-weight:700;color:#16a34a;">1</div></div>
    <div class="card cp"><div style="color:#64748b;">Recurring</div><div style="font-size:20px;font-weight:700;color:#8b5cf6;">1</div></div>
  </div>
  <div class="card" style="overflow:hidden;">
    <table style="width:100%;border-collapse:collapse;">
      <thead><tr style="background:#f8fafc;border-bottom:1px solid #e2e8f0;">
        <th style="text-align:left;padding:8px 16px;color:#64748b;font-weight:500;">Job</th>
        <th style="text-align:left;padding:8px 16px;color:#64748b;font-weight:500;">Date</th>
        <th style="text-align:left;padding:8px 16px;color:#64748b;font-weight:500;">Type</th>
        <th style="text-align:left;padding:8px 16px;color:#64748b;font-weight:500;">Amount</th>
        <th style="text-align:left;padding:8px 16px;color:#64748b;font-weight:500;">Assigned</th>
        <th style="text-align:left;padding:8px 16px;color:#64748b;font-weight:500;">Source</th>
        <th style="text-align:left;padding:8px 16px;color:#64748b;font-weight:500;">Status</th>
        <th style="padding:8px 16px;"></th>
      </tr></thead>
      <tbody>
        <tr style="border-bottom:1px solid #f1f5f9;cursor:pointer;" onclick="go('job-est')" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">
          <td style="padding:10px 16px;font-weight:600;">EST-001-1</td>
          <td style="padding:10px 16px;">Feb 27</td>
          <td style="padding:10px 16px;">Local Move</td>
          <td style="padding:10px 16px;font-weight:600;">$425</td>
          <td style="padding:10px 16px;" class="assign-col-est1">
            <!-- Dynamic: changes based on mode -->
          </td>
          <td style="padding:10px 16px;"><span class="badge" style="background:#eff6ff;color:#2563eb;">EST-001</span></td>
          <td style="padding:10px 16px;"><span class="badge" style="background:#dbeafe;color:#1e40af;">Scheduled</span></td>
          <td style="padding:10px 16px;text-align:right;"><button class="b-ghost" onclick="event.stopPropagation();go('job-est')">View</button></td>
        </tr>
        <tr style="border-bottom:1px solid #f1f5f9;cursor:pointer;" onclick="go('job-recur')" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">
          <td style="padding:10px 16px;font-weight:600;">EST-002-1 <span class="badge" style="background:#f3e8ff;color:#7c3aed;">Recurring</span></td>
          <td style="padding:10px 16px;">Weekly</td>
          <td style="padding:10px 16px;">Cleaning</td>
          <td style="padding:10px 16px;font-weight:600;">$150/visit</td>
          <td style="padding:10px 16px;" class="assign-col-est2">
            <!-- Dynamic -->
          </td>
          <td style="padding:10px 16px;"><span class="badge" style="background:#eff6ff;color:#2563eb;">EST-002</span></td>
          <td style="padding:10px 16px;"><span class="badge" style="background:#dcfce7;color:#166534;">Active</span></td>
          <td style="padding:10px 16px;text-align:right;"><button class="b-ghost" onclick="event.stopPropagation();go('job-recur')">View</button></td>
        </tr>
        <tr style="cursor:pointer;" onclick="go('job-quick')" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">
          <td style="padding:10px 16px;font-weight:600;">JOB-042</td>
          <td style="padding:10px 16px;">Mar 5</td>
          <td style="padding:10px 16px;">Pest Spray</td>
          <td style="padding:10px 16px;font-weight:600;">$75</td>
          <td style="padding:10px 16px;" class="assign-col-job42">
            <!-- Dynamic -->
          </td>
          <td style="padding:10px 16px;"><span class="badge" style="background:#f8fafc;color:#64748b;">Quick Book</span></td>
          <td style="padding:10px 16px;"><span class="badge" style="background:#dbeafe;color:#1e40af;">Scheduled</span></td>
          <td style="padding:10px 16px;text-align:right;"><button class="b-ghost" onclick="event.stopPropagation();go('job-quick')">View</button></td>
        </tr>
      </tbody>
    </table>
  </div>
  <div style="border:2px dashed #16a34a;background:#f0fdf4;border-radius:8px;padding:10px;text-align:center;margin-top:14px;">
    <b>Page 4: Jobs List</b> — ALL jobs in one place. "Assigned" column adapts to company mode (shows crew name, tech name, or either). "Source" shows where it came from.
  </div>
</div>

<!-- ================================================================ -->
<!-- 5. JOB FROM ESTIMATE (unified view)                               -->
<!-- ================================================================ -->
<div class="view fade" id="v-job-est">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;flex-wrap:wrap;gap:8px;">
    <div style="display:flex;align-items:center;gap:6px;"><a href="#" onclick="event.preventDefault();go('est-list')" style="color:#2563eb;text-decoration:none;">Estimates</a><span style="color:#cbd5e1;">/</span><a href="#" onclick="event.preventDefault();go('est-detail')" style="color:#2563eb;text-decoration:none;">EST-001</a><span style="color:#cbd5e1;">/</span><span style="font-weight:600;">Job</span></div>
    <div class="lc">
      <div class="lc-d done">&#10003;</div><div class="lc-ln done"></div>
      <div class="lc-d done">&#10003;</div><div class="lc-ln done"></div>
      <div class="lc-d done">&#10003;</div><div class="lc-ln done"></div>
      <div class="lc-d on">4</div><div class="lc-ln off"></div>
      <div class="lc-d off">5</div><div class="lc-ln off"></div>
      <div class="lc-d off">6</div>
    </div>
    <div style="display:flex;gap:6px;align-items:center;">
      <div class="ico" title="Documents" onclick="openPanel('docs')"><svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg></div>
      <div class="ico" title="Activity" onclick="openPanel('activity')"><svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></div>
      <div class="ico" title="Payments" onclick="openPanel('pay')"><svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg></div>
      <button class="b b-out">Edit</button>
      <button class="b b-blue" onclick="openPanel('schedule')">Schedule Job</button>
    </div>
  </div>

  <!-- Job header -->
  <div class="card cp" style="margin-bottom:10px;">
    <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;">
      <div>
        <div style="display:flex;align-items:center;gap:6px;"><span style="font-size:16px;font-weight:700;">Job EST-001-1</span><span class="badge" style="background:#dbeafe;color:#1e40af;">Scheduled</span></div>
        <div style="color:#64748b;">Feb 27, 2026 at 8:00 AM &bull; Local Move &bull; 2-3 hrs</div>
      </div>
      <div style="background:#eff6ff;padding:6px 12px;border-radius:6px;">
        <span style="color:#64748b;">From:</span> <a href="#" onclick="event.preventDefault();go('est-detail')" style="color:#2563eb;font-weight:600;">EST-001</a> <span style="color:#64748b;">$425</span> <span class="badge" style="background:#dcfce7;color:#166534;">Approved</span>
      </div>
    </div>
  </div>

  <div class="grid-3" style="display:grid;grid-template-columns:220px 1fr 260px;gap:10px;align-items:start;">
    <!-- L -->
    <div style="display:flex;flex-direction:column;gap:10px;">
      <div class="card cp">
        <div style="font-weight:600;margin-bottom:6px;">Schedule</div>
        <div class="fi"><span class="fi-l">Date</span><span style="color:#2563eb;font-weight:500;">Feb 27</span></div>
        <div class="fi"><span class="fi-l">Time</span><span>8:00 AM</span></div>
        <div class="fi"><span class="fi-l">Duration</span><span>2-3 hrs</span></div>
        <div class="fi"><span class="fi-l">Status</span><select><option selected>Scheduled</option><option>In Progress</option><option>Completed</option></select></div>
      </div>

      <!-- ===== ASSIGNMENT CARD - ADAPTS TO MODE ===== -->
      <div class="card cp assign-card" id="assign-job-est">
        <!-- Content injected by JS based on mode -->
      </div>
    </div>
    <!-- C -->
    <div style="display:flex;flex-direction:column;gap:10px;">
      <div class="card cp">
        <div style="display:flex;justify-content:space-between;margin-bottom:6px;"><span style="font-weight:600;">Addresses</span><div style="display:flex;gap:6px;"><a href="#" style="color:#2563eb;font-size:12px;">Map</a><a href="#" style="color:#2563eb;font-size:12px;">Navigate</a></div></div>
        <div style="background:#e2e8f0;border-radius:6px;height:60px;display:flex;align-items:center;justify-content:center;margin-bottom:8px;cursor:pointer;position:relative;">
          <div style="font-size:11px;color:#64748b;">&#128205; 85015 &mdash;&mdash; &#128205; 85041</div>
          <div style="position:absolute;bottom:4px;right:6px;background:white;border-radius:4px;padding:2px 6px;font-size:10px;font-weight:600;color:#2563eb;">12.4 mi &bull; 18 min</div>
        </div>
        <div style="display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid #f1f5f9;"><span class="dot" style="background:#3b82f6;"></span><div><div style="font-weight:500;color:#2563eb;">Origin</div><div style="color:#64748b;">Phoenix, AZ 85015 &bull; Apt, 1st fl</div></div></div>
        <div style="display:flex;align-items:center;gap:8px;padding:6px 0;"><span class="dot" style="background:#16a34a;"></span><div><div style="font-weight:500;color:#2563eb;">Destination</div><div style="color:#64748b;">Phoenix, AZ 85041 &bull; Apt, 2nd fl</div></div></div>
      </div>
      <div class="card cp">
        <div style="display:flex;justify-content:space-between;margin-bottom:6px;"><span style="font-weight:600;">Line Items</span><span style="color:#64748b;font-size:11px;">from EST-001</span></div>
        <div class="pr"><span>Moving Services</span><span>$300</span></div>
        <div class="pr"><span>Trip Fee</span><span>$125</span></div>
        <div style="border-top:1px dashed #fde68a;margin:6px 0;"></div>
        <div class="pr"><label style="display:flex;align-items:center;gap:4px;"><input type="checkbox" checked style="accent-color:#f59e0b;"> <span style="font-size:12px;color:#92400e;">Supply Fee (10%)</span></label><span>$42.50</span></div>
        <div style="border-top:1px solid #e2e8f0;margin:4px 0;"></div>
        <div class="pr"><span style="font-weight:600;">Total</span><span style="font-weight:600;">$467.50</span></div>
        <div class="pr"><span style="color:#16a34a;">Deposit</span><span style="color:#16a34a;">-$100</span></div>
        <div class="pr"><span style="font-weight:700;">Due</span><span style="font-weight:700;color:#dc2626;">$367.50</span></div>
        <div style="border-top:1px dashed #e2e8f0;margin:6px 0;"></div>
        <div style="display:flex;gap:6px;justify-content:center;">
          <button class="b-ghost" style="font-size:11px;">+ Service</button>
          <button class="b-ghost" style="font-size:11px;">+ Material</button>
          <button class="b-ghost" style="font-size:11px;">+ Custom</button>
        </div>
      </div>
      <div class="card">
        <div class="tab-row"><div class="tab on">Crew Notes</div><div class="tab">Internal</div><div class="tab">Photos</div></div>
        <div style="padding:10px;background:#f8fafc;margin:10px;border-radius:6px;">2 bedroom apt, 1st to 2nd floor. Narrow stairs. Bring blankets + sliders.</div>
      </div>
    </div>
    <!-- R -->
    <div style="display:flex;flex-direction:column;gap:10px;">
      <div class="card cp">
        <div style="display:flex;justify-content:space-between;margin-bottom:8px;"><span style="font-weight:600;">Contracts</span><button class="b b-out" style="font-size:11px;">+ Create</button></div>
        <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;cursor:pointer;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">
          <div style="display:flex;justify-content:space-between;"><span style="font-weight:500;">Hourly Contract</span><span class="badge" style="background:#fef3c7;color:#92400e;">Sent</span></div>
          <div style="font-size:11px;color:#64748b;">Awaiting signature</div>
        </div>
      </div>
      <div class="card cp">
        <div style="font-weight:600;margin-bottom:6px;">Financial</div>
        <div class="fi"><span class="fi-l">Estimate</span><span>$467.50</span></div>
        <div class="fi"><span class="fi-l">Supply Fee</span><span style="color:#92400e;">incl.</span></div>
        <div class="fi"><span class="fi-l">Deposit</span><span style="color:#16a34a;">$100 paid</span></div>
        <div class="fi"><span class="fi-l">Balance</span><span style="color:#dc2626;font-weight:600;">$367.50</span></div>
        <div style="display:flex;gap:6px;margin-top:6px;">
          <button class="b b-green" style="flex:1;justify-content:center;" onclick="openPanel('pay')">Take Payment</button>
          <button class="b b-out" style="flex:1;justify-content:center;">Invoice</button>
        </div>
        <a href="#" style="display:block;text-align:center;font-size:11px;color:#2563eb;margin-top:6px;" onclick="event.preventDefault();openPanel('pay')">Payment History</a>
      </div>
      <div class="card cp">
        <div style="font-weight:600;margin-bottom:8px;">Timeline</div>
        <div class="tl"><div class="dot" style="background:#16a34a;margin-top:4px;"></div><div><div>Estimate created</div><div style="font-size:11px;color:#94a3b8;">Jan 15</div></div></div>
        <div class="tl"><div class="dot" style="background:#3b82f6;margin-top:4px;"></div><div><div>Page sent</div><div style="font-size:11px;color:#94a3b8;">Jan 15</div></div></div>
        <div class="tl"><div class="dot" style="background:#16a34a;margin-top:4px;"></div><div><div><b>Approved</b> + $100 deposit</div><div style="font-size:11px;color:#94a3b8;">Jan 16</div></div></div>
        <div class="tl"><div class="dot" style="background:#2563eb;margin-top:4px;"></div><div><div>Job scheduled Feb 27</div><div style="font-size:11px;color:#94a3b8;">Jan 16</div></div></div>
      </div>
    </div>
  </div>
  <div style="border:2px dashed #16a34a;background:#f0fdf4;border-radius:8px;padding:10px;text-align:center;margin-top:14px;">
    <b>Page 5: Job from Estimate</b> — Assignment card adapts to company mode. <b>Try toggling Individual / Crew / Both above!</b>
  </div>
</div>

<!-- ================================================================ -->
<!-- 6. JOB QUICK BOOKED (no estimate)                                 -->
<!-- ================================================================ -->
<div class="view fade" id="v-job-quick">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
    <div style="display:flex;align-items:center;gap:6px;"><a href="#" onclick="event.preventDefault();go('jobs-list')" style="color:#2563eb;text-decoration:none;">Jobs</a><span style="color:#cbd5e1;">/</span><span style="font-weight:600;">JOB-042</span></div>
    <div style="display:flex;gap:6px;align-items:center;">
      <div class="ico" title="Documents" onclick="openPanel('docs')"><svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg></div>
      <div class="ico" title="Activity" onclick="openPanel('activity')"><svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></div>
      <div class="ico" title="Payments" onclick="openPanel('pay')"><svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg></div>
      <button class="b b-out">Edit</button>
      <button class="b b-blue" onclick="openPanel('schedule')">Schedule Job</button>
    </div>
  </div>

  <div class="card cp" style="margin-bottom:10px;">
    <div style="display:flex;align-items:center;justify-content:space-between;">
      <div>
        <div style="display:flex;align-items:center;gap:6px;"><span style="font-size:16px;font-weight:700;">JOB-042 — Pest Spray</span><span class="badge" style="background:#dbeafe;color:#1e40af;">Scheduled</span></div>
        <div style="color:#64748b;">Mar 5, 2026 at 10:00 AM &bull; 30 min</div>
      </div>
      <span class="badge" style="background:#f8fafc;color:#64748b;font-size:12px;">Quick Booked — No Estimate</span>
    </div>
  </div>

  <div class="grid-3" style="display:grid;grid-template-columns:220px 1fr 260px;gap:10px;align-items:start;">
    <div style="display:flex;flex-direction:column;gap:10px;">
      <div class="card cp">
        <div style="font-weight:600;margin-bottom:6px;">Schedule</div>
        <div class="fi"><span class="fi-l">Date</span><span style="color:#2563eb;">Mar 5</span></div>
        <div class="fi"><span class="fi-l">Time</span><span>10:00 AM</span></div>
        <div class="fi"><span class="fi-l">Duration</span><span>30 min</span></div>
        <div class="fi"><span class="fi-l">Status</span><select><option selected>Scheduled</option></select></div>
      </div>

      <!-- ===== ASSIGNMENT CARD - ADAPTS TO MODE ===== -->
      <div class="card cp assign-card" id="assign-job-quick">
        <!-- Content injected by JS based on mode -->
      </div>

      <div class="card cp">
        <div style="display:flex;justify-content:space-between;"><span style="font-weight:600;">Make Recurring</span></div>
        <div style="margin-top:6px;border:1px dashed #e2e8f0;border-radius:6px;padding:10px;text-align:center;">
          <button class="b b-out" onclick="go('job-recur')">+ Set Up Recurring</button>
          <div style="font-size:11px;color:#94a3b8;margin-top:4px;">Monthly, weekly, bi-weekly...</div>
        </div>
      </div>
    </div>
    <div style="display:flex;flex-direction:column;gap:10px;">
      <div class="card cp">
        <div style="display:flex;justify-content:space-between;margin-bottom:6px;"><span style="font-weight:600;">Address</span><a href="#" style="color:#2563eb;font-size:12px;">Map</a></div>
        <div style="background:#e2e8f0;border-radius:6px;height:60px;display:flex;align-items:center;justify-content:center;margin-bottom:8px;cursor:pointer;">
          <div style="font-size:12px;color:#64748b;">&#128205; 4521 E Main St, Phoenix</div>
        </div>
        <div style="display:flex;align-items:center;gap:8px;"><span class="dot" style="background:#3b82f6;"></span><div><div>4521 E Main St, Phoenix AZ 85008</div><div style="color:#64748b;">House &bull; Backyard access from side gate</div></div></div>
      </div>
      <div class="card cp">
        <div style="display:flex;justify-content:space-between;margin-bottom:6px;"><span style="font-weight:600;">Service &amp; Pricing</span></div>
        <div class="pr"><span>Pest Spray — Interior + Exterior</span><span style="font-weight:600;">$75.00</span></div>
        <div style="border-top:1px dashed #fde68a;margin:6px 0;"></div>
        <div class="pr"><label style="display:flex;align-items:center;gap:4px;"><input type="checkbox" style="accent-color:#f59e0b;"> <span style="font-size:12px;color:#94a3b8;">Supply Fee (10%)</span></label><span style="color:#94a3b8;">—</span></div>
        <div style="border-top:1px solid #e2e8f0;margin:4px 0;"></div>
        <div class="pr"><span style="font-weight:700;">Total</span><span style="font-weight:700;">$75.00</span></div>
        <div style="border-top:1px dashed #e2e8f0;margin:6px 0;"></div>
        <div style="display:flex;gap:6px;justify-content:center;">
          <button class="b-ghost" style="font-size:11px;">+ Service</button>
          <button class="b-ghost" style="font-size:11px;">+ Material</button>
          <button class="b-ghost" style="font-size:11px;">+ Custom</button>
        </div>
      </div>
      <div class="card">
        <div class="tab-row"><div class="tab on">Notes</div><div class="tab">Photos</div></div>
        <div style="padding:10px;">
          <div style="background:#f8fafc;padding:8px;border-radius:6px;">Spray around perimeter and garage. Dog will be inside — customer aware. Use back gate, code 1234.</div>
        </div>
      </div>
    </div>
    <div style="display:flex;flex-direction:column;gap:10px;">
      <div class="card cp">
        <div style="font-weight:600;margin-bottom:6px;">Financial</div>
        <div class="fi"><span class="fi-l">Price</span><span>$75</span></div>
        <div class="fi"><span class="fi-l">Paid</span><span style="color:#94a3b8;">$0</span></div>
        <div class="fi"><span class="fi-l">Due</span><span style="font-weight:600;">$75</span></div>
        <div style="display:flex;gap:6px;margin-top:6px;">
          <button class="b b-green" style="flex:1;justify-content:center;" onclick="openPanel('pay')">Take Payment</button>
          <button class="b b-out" style="flex:1;justify-content:center;">Invoice</button>
        </div>
        <a href="#" style="display:block;text-align:center;font-size:11px;color:#2563eb;margin-top:6px;" onclick="event.preventDefault();openPanel('pay')">Payment History</a>
      </div>
      <div class="card cp">
        <div style="font-weight:600;margin-bottom:8px;">Timeline</div>
        <div class="tl"><div class="dot" style="background:#16a34a;margin-top:4px;"></div><div><div>Job quick-booked</div><div style="font-size:11px;color:#94a3b8;">Feb 28</div></div></div>
        <div class="tl" id="tl-dispatch-quick">
          <!-- Dynamic dispatch timeline entry -->
        </div>
      </div>
    </div>
  </div>
  <div style="border:2px dashed #f59e0b;background:#fffbeb;border-radius:8px;padding:10px;text-align:center;margin-top:14px;">
    <b>Page 6: Quick-Booked Job</b> — Assignment card adapts to company mode. <b>Try toggling Individual / Crew / Both above!</b>
  </div>
</div>

<!-- ================================================================ -->
<!-- 7. RECURRING JOB                                                  -->
<!-- ================================================================ -->
<div class="view fade" id="v-job-recur">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
    <div style="display:flex;align-items:center;gap:6px;"><a href="#" onclick="event.preventDefault();go('jobs-list')" style="color:#2563eb;text-decoration:none;">Jobs</a><span style="color:#cbd5e1;">/</span><span style="font-weight:600;">EST-002-1</span><span class="badge" style="background:#f3e8ff;color:#7c3aed;">Recurring</span></div>
    <div style="display:flex;gap:6px;align-items:center;">
      <div class="ico" title="Documents" onclick="openPanel('docs')"><svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg></div>
      <div class="ico" title="Activity" onclick="openPanel('activity')"><svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></div>
      <div class="ico" title="Payments" onclick="openPanel('pay')"><svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg></div>
      <button class="b b-out">Edit Template</button>
      <button class="b b-out">Pause</button>
    </div>
  </div>

  <div class="card cp" style="margin-bottom:10px;">
    <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;">
      <div>
        <div style="display:flex;align-items:center;gap:6px;"><span style="font-size:16px;font-weight:700;">Weekly Cleaning</span><span class="badge" style="background:#dcfce7;color:#166534;">Active</span></div>
        <div style="color:#64748b;">Every Monday at 9:00 AM &bull; $150/visit &bull; From <a href="#" onclick="event.preventDefault()" style="color:#2563eb;">EST-002</a></div>
      </div>
      <div style="display:flex;gap:12px;text-align:center;">
        <div><div style="font-size:18px;font-weight:700;">8</div><div style="font-size:11px;color:#64748b;">Completed</div></div>
        <div><div style="font-size:18px;font-weight:700;color:#2563eb;">4</div><div style="font-size:11px;color:#64748b;">Upcoming</div></div>
        <div><div style="font-size:18px;font-weight:700;color:#16a34a;">$1,200</div><div style="font-size:11px;color:#64748b;">Revenue</div></div>
      </div>
    </div>
  </div>

  <div style="display:grid;grid-template-columns:230px 1fr 280px;gap:10px;align-items:start;">
    <!-- LEFT COLUMN — Recurrence metadata -->
    <div style="display:flex;flex-direction:column;gap:10px;">
      <!-- Recurrence settings (compact) -->
      <div class="card cp">
        <div style="font-weight:600;margin-bottom:8px;font-size:13px;">Recurrence</div>
        <div class="fi"><span class="fi-l">Frequency</span><select style="font-size:12px;"><option selected>Weekly</option><option>Bi-weekly</option><option>Monthly</option></select></div>
        <div class="fi"><span class="fi-l">Day</span><select style="font-size:12px;"><option selected>Monday</option></select></div>
        <div class="fi"><span class="fi-l">Time</span><span style="font-size:12px;">9:00 AM</span></div>
        <div class="fi"><span class="fi-l">Window</span><span style="font-size:12px;color:#2563eb;">8 AM - 12 PM</span></div>
        <div class="fi"><span class="fi-l">Started</span><span style="font-size:12px;">Jan 6, 2026</span></div>
        <div class="fi"><span class="fi-l">Ends</span><select style="font-size:12px;"><option selected>No end date</option><option>After 12 visits</option><option>On date...</option></select></div>
        <!-- Assignment row adapts to mode -->
        <div class="fi" id="recur-assign-row"></div>
      </div>

      <!-- Documents (compact, fits left sidebar) -->
      <div class="card cp">
        <div style="display:flex;justify-content:space-between;margin-bottom:6px;"><span style="font-weight:600;font-size:13px;">Documents</span><button class="b-ghost" style="font-size:10px;color:#2563eb;" onclick="openPanel('docs')">All</button></div>
        <div style="border:1px solid #e2e8f0;border-radius:6px;overflow:hidden;">
          <div style="padding:5px 8px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;font-size:10px;"><span style="font-weight:500;">Service Agreement</span><span class="badge" style="background:#dcfce7;color:#166534;font-size:8px;">Signed</span></div>
          <div style="padding:5px 8px;display:flex;justify-content:space-between;font-size:10px;"><span style="font-weight:500;">Invoice #INV-055</span><span class="badge" style="background:#dcfce7;color:#166534;font-size:8px;">Paid</span></div>
        </div>
      </div>

      <!-- Actions (compact) -->
      <div class="card cp">
        <div style="font-weight:600;margin-bottom:6px;font-size:13px;">Actions</div>
        <div style="display:flex;flex-direction:column;gap:4px;">
          <button class="b b-out" style="width:100%;justify-content:center;font-size:11px;">Skip Next Visit</button>
          <button class="b b-out" style="width:100%;justify-content:center;font-size:11px;">Add Extra Visit</button>
          <button class="b b-out" style="width:100%;justify-content:center;font-size:11px;color:#dc2626;">Cancel Series</button>
        </div>
      </div>
    </div>

    <!-- CENTER COLUMN — Address, Notes, Instances -->
    <div style="display:flex;flex-direction:column;gap:10px;">
      <!-- Address -->
      <div class="card cp">
        <div style="display:flex;justify-content:space-between;margin-bottom:6px;"><span style="font-weight:600;">Address</span><a href="#" style="color:#2563eb;font-size:12px;">Map</a></div>
        <div style="background:#e2e8f0;border-radius:6px;height:50px;display:flex;align-items:center;justify-content:center;margin-bottom:6px;cursor:pointer;">
          <div style="font-size:12px;color:#64748b;">&#128205; 4521 E Main St, Phoenix</div>
        </div>
        <div style="display:flex;align-items:center;gap:8px;"><span class="dot" style="background:#3b82f6;"></span><div><div>4521 E Main St, Phoenix AZ 85008</div><div style="color:#64748b;">House &bull; Backyard access from side gate</div></div></div>
      </div>

      <!-- Notes -->
      <div class="card cp">
        <div style="font-weight:600;margin-bottom:6px;">Notes</div>
        <div style="background:#f8fafc;padding:8px;border-radius:6px;">Key under mat. Alarm code 5678. Focus on kitchen and bathrooms. Pets: 2 cats.</div>
      </div>

      <!-- Instance list -->
      <div class="card" style="overflow:hidden;">
        <div style="padding:8px 14px;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;">
          <span style="font-weight:600;">Instances</span>
          <div style="display:flex;gap:6px;"><button class="b b-out" style="font-size:11px;">Upcoming</button><button class="b-ghost" style="font-size:11px;">Completed</button></div>
        </div>
        <table style="width:100%;border-collapse:collapse;" id="recur-instances">
          <!-- Dynamic: instance rows with assignment column -->
        </table>
      </div>
    </div>

    <!-- RIGHT COLUMN — Pricing & Billing -->
    <div style="display:flex;flex-direction:column;gap:10px;">
      <!-- Line Items (per visit) -->
      <div class="card cp">
        <div style="display:flex;justify-content:space-between;margin-bottom:6px;"><span style="font-weight:600;">Service &amp; Pricing</span><span style="font-size:11px;color:#64748b;">per visit</span></div>
        <div class="pr"><span>Standard Cleaning (3 bed)</span><span style="font-weight:500;">$125</span></div>
        <div class="pr"><span>Fridge &amp; Oven Deep Clean</span><span style="font-weight:500;">$25</span></div>
        <div style="border-top:1px dashed #fde68a;margin:6px 0;"></div>
        <div class="pr"><label style="display:flex;align-items:center;gap:4px;"><input type="checkbox" checked style="accent-color:#f59e0b;"> <span style="font-size:12px;color:#92400e;">Supply Fee (10%)</span></label><span>$15</span></div>
        <div style="border-top:1px solid #e2e8f0;margin:4px 0;"></div>
        <div class="pr"><span style="font-weight:700;">Per Visit Total</span><span style="font-weight:700;">$165</span></div>
        <div style="border-top:1px dashed #e2e8f0;margin:6px 0;"></div>
        <div style="display:flex;gap:6px;justify-content:center;">
          <button class="b-ghost" style="font-size:11px;">+ Service</button>
          <button class="b-ghost" style="font-size:11px;">+ Material</button>
          <button class="b-ghost" style="font-size:11px;">+ Custom</button>
        </div>
        <div style="color:#64748b;font-size:10px;text-align:center;margin-top:4px;">Changes apply to all future visits</div>
      </div>

      <!-- Billing & Payment -->
      <div class="card cp">
        <div style="font-weight:600;margin-bottom:8px;">Billing &amp; Payment</div>
        <div class="fi"><span class="fi-l">Billing</span><select><option>Auto-charge after each visit</option><option>Invoice after each visit</option><option>Monthly invoice</option><option selected>Prepaid package</option></select></div>
        <div class="fi"><span class="fi-l">Method</span><span style="color:#2563eb;font-weight:500;">Visa ****4242</span></div>
        <div style="border-top:1px solid #e2e8f0;margin:6px 0;"></div>
        <div style="margin-top:8px;">
          <button class="b b-out" style="width:100%;justify-content:center;font-size:11px;" onclick="openPanel('pay')">View Payment History</button>
        </div>
      </div>

      <!-- Prepaid Package -->
      <div class="card" style="overflow:hidden;">
        <div style="background:#7c3aed;color:white;padding:8px 14px;display:flex;align-items:center;justify-content:space-between;">
          <span style="font-weight:600;font-size:13px;">Prepaid Package</span>
          <span style="background:rgba(255,255,255,0.2);padding:2px 8px;border-radius:9999px;font-size:11px;">Active</span>
        </div>
        <div style="padding:14px;">
          <!-- Package name & price -->
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
            <div>
              <div style="font-weight:600;font-size:13px;">10-Visit Cleaning Package</div>
              <div style="font-size:11px;color:#64748b;">Purchased Jan 6, 2026 &bull; $1,400</div>
            </div>
            <div style="text-align:right;">
              <div style="font-size:11px;color:#64748b;">Savings</div>
              <div style="font-size:12px;font-weight:600;color:#16a34a;">$250 (15%)</div>
            </div>
          </div>

          <!-- Progress bar -->
          <div style="margin-bottom:8px;">
            <div style="display:flex;justify-content:space-between;font-size:11px;margin-bottom:4px;">
              <span style="font-weight:600;">8 of 10 used</span>
              <span style="color:#7c3aed;font-weight:600;">2 remaining</span>
            </div>
            <div style="background:#e2e8f0;border-radius:9999px;height:8px;overflow:hidden;">
              <div style="background:linear-gradient(90deg,#7c3aed,#a78bfa);height:100%;width:80%;border-radius:9999px;transition:width 0.3s;"></div>
            </div>
          </div>

          <!-- Visit dots -->
          <div style="display:flex;gap:4px;justify-content:center;margin:10px 0;">
            <div style="width:22px;height:22px;border-radius:50%;background:#7c3aed;color:white;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:600;">&#10003;</div>
            <div style="width:22px;height:22px;border-radius:50%;background:#7c3aed;color:white;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:600;">&#10003;</div>
            <div style="width:22px;height:22px;border-radius:50%;background:#7c3aed;color:white;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:600;">&#10003;</div>
            <div style="width:22px;height:22px;border-radius:50%;background:#7c3aed;color:white;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:600;">&#10003;</div>
            <div style="width:22px;height:22px;border-radius:50%;background:#7c3aed;color:white;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:600;">&#10003;</div>
            <div style="width:22px;height:22px;border-radius:50%;background:#7c3aed;color:white;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:600;">&#10003;</div>
            <div style="width:22px;height:22px;border-radius:50%;background:#7c3aed;color:white;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:600;">&#10003;</div>
            <div style="width:22px;height:22px;border-radius:50%;background:#7c3aed;color:white;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:600;">&#10003;</div>
            <div style="width:22px;height:22px;border-radius:50%;background:#e2e8f0;color:#7c3aed;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;">9</div>
            <div style="width:22px;height:22px;border-radius:50%;background:#e2e8f0;color:#7c3aed;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;">10</div>
          </div>

          <!-- Auto-renew -->
          <div style="border-top:1px solid #e2e8f0;padding-top:8px;margin-top:4px;">
            <div style="display:flex;align-items:center;justify-content:space-between;">
              <div>
                <div style="font-size:12px;font-weight:500;">Auto-renew when complete</div>
                <div style="font-size:10px;color:#64748b;">Charges card on file for next 10 visits</div>
              </div>
              <div class="sw on" style="width:32px;height:18px;"></div>
            </div>
          </div>

          <!-- When package runs out alert (shows at 2 remaining) -->
          <div style="background:#fef3c7;border:1px solid #fde68a;border-radius:6px;padding:8px 10px;margin-top:8px;">
            <div style="font-size:11px;color:#92400e;font-weight:500;">&#9888; 2 visits remaining — auto-renew is ON</div>
          </div>
        </div>
      </div>

    </div>
  </div>
  <div style="border:2px dashed #8b5cf6;background:#f5f3ff;border-radius:8px;padding:10px;text-align:center;margin-top:14px;">
    <b>Page 7: Recurring Job</b> — Default assignment in template settings + per-instance override. <b>Try toggling Individual / Crew / Both above!</b>
  </div>
</div>

<!-- ================================================================ -->
<!-- 7B. JOB SCHEDULER — 3 OPTIONS COMPARISON                         -->
<!-- ================================================================ -->
<div class="view fade" id="v-scheduler">
  <div style="margin-bottom:16px;">
    <div style="font-size:18px;font-weight:700;margin-bottom:4px;">Job Scheduling — 3 Options</div>
    <div style="color:#64748b;font-size:13px;">What happens when you click "Schedule Job" or "Book Job"? Compare the three approaches below.</div>
  </div>

  <!-- ============ OPTION A: Schedule Modal with Mini Calendar ============ -->
  <div class="card" style="overflow:hidden;margin-bottom:16px;">
    <div style="background:#7c3aed;color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;">
      <div>
        <div style="font-weight:700;font-size:14px;">Option A: Schedule Modal (Inline)</div>
        <div style="font-size:11px;opacity:0.85;">Opens a modal right on the estimate/job — never leaves the page</div>
      </div>
      <span style="background:rgba(255,255,255,0.2);padding:3px 10px;border-radius:9999px;font-size:11px;font-weight:600;">Recommended</span>
    </div>
    <div style="padding:16px;">
      <!-- Simulated modal overlay -->
      <div style="background:#f8fafc;border:2px solid #e2e8f0;border-radius:12px;max-width:640px;margin:0 auto;overflow:hidden;box-shadow:0 8px 30px rgba(0,0,0,0.12);">
        <!-- Modal header -->
        <div style="padding:12px 16px;border-bottom:1px solid #e2e8f0;display:flex;align-items:center;justify-content:space-between;">
          <div>
            <div style="font-weight:700;font-size:14px;">Schedule Job</div>
            <div style="font-size:11px;color:#64748b;">EST-001 &bull; John &bull; Local Move</div>
          </div>
          <button style="background:none;border:none;font-size:18px;cursor:pointer;color:#94a3b8;">&times;</button>
        </div>
        <!-- Modal body: calendar + time slots -->
        <div style="display:grid;grid-template-columns:1fr 1fr;min-height:300px;">
          <!-- Left: Mini calendar -->
          <div style="padding:12px;border-right:1px solid #e2e8f0;">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
              <span style="font-weight:600;font-size:13px;">February 2026</span>
              <div style="display:flex;gap:4px;">
                <button style="background:#f1f5f9;border:none;border-radius:4px;padding:2px 6px;cursor:pointer;font-size:11px;">&larr;</button>
                <button style="background:#f1f5f9;border:none;border-radius:4px;padding:2px 6px;cursor:pointer;font-size:11px;">&rarr;</button>
              </div>
            </div>
            <!-- Day headers -->
            <div style="display:grid;grid-template-columns:repeat(7,1fr);text-align:center;font-size:10px;color:#94a3b8;margin-bottom:4px;">
              <div>Su</div><div>Mo</div><div>Tu</div><div>We</div><div>Th</div><div>Fr</div><div>Sa</div>
            </div>
            <!-- Calendar grid -->
            <div style="display:grid;grid-template-columns:repeat(7,1fr);text-align:center;gap:2px;font-size:12px;">
              <div style="padding:6px;color:#cbd5e1;">25</div>
              <div style="padding:6px;color:#cbd5e1;">26</div>
              <div style="padding:6px;color:#cbd5e1;">27</div>
              <div style="padding:6px;color:#cbd5e1;">28</div>
              <div style="padding:6px;color:#cbd5e1;">29</div>
              <div style="padding:6px;color:#cbd5e1;">30</div>
              <div style="padding:6px;color:#cbd5e1;">31</div>
              <!-- Week 1 -->
              <div style="padding:6px;">1</div>
              <div style="padding:6px;">2</div>
              <div style="padding:6px;">3</div>
              <div style="padding:6px;">4</div>
              <div style="padding:6px;">5</div>
              <div style="padding:6px;">6</div>
              <div style="padding:6px;">7</div>
              <!-- Week 2 -->
              <div style="padding:6px;">8</div>
              <div style="padding:6px;">9</div>
              <div style="padding:6px;position:relative;">10<div style="position:absolute;bottom:2px;left:50%;transform:translateX(-50%);width:4px;height:4px;border-radius:50%;background:#f59e0b;"></div></div>
              <div style="padding:6px;position:relative;">11<div style="position:absolute;bottom:2px;left:50%;transform:translateX(-50%);width:4px;height:4px;border-radius:50%;background:#f59e0b;"></div></div>
              <div style="padding:6px;position:relative;">12<div style="position:absolute;bottom:2px;left:50%;transform:translateX(-50%);width:4px;height:4px;border-radius:50%;background:#ef4444;"></div></div>
              <div style="padding:6px;position:relative;">13<div style="position:absolute;bottom:2px;left:50%;transform:translateX(-50%);width:4px;height:4px;border-radius:50%;background:#22c55e;"></div></div>
              <div style="padding:6px;">14</div>
              <!-- Week 3 -->
              <div style="padding:6px;">15</div>
              <div style="padding:6px;position:relative;">16<div style="position:absolute;bottom:2px;left:50%;transform:translateX(-50%);width:4px;height:4px;border-radius:50%;background:#22c55e;"></div></div>
              <div style="padding:6px;position:relative;">17<div style="position:absolute;bottom:2px;left:50%;transform:translateX(-50%);width:4px;height:4px;border-radius:50%;background:#22c55e;"></div></div>
              <div style="padding:6px;position:relative;">18<div style="position:absolute;bottom:2px;left:50%;transform:translateX(-50%);width:4px;height:4px;border-radius:50%;background:#22c55e;"></div></div>
              <div style="padding:6px;position:relative;">19<div style="position:absolute;bottom:2px;left:50%;transform:translateX(-50%);width:4px;height:4px;border-radius:50%;background:#f59e0b;"></div></div>
              <div style="padding:6px;position:relative;">20<div style="position:absolute;bottom:2px;left:50%;transform:translateX(-50%);width:4px;height:4px;border-radius:50%;background:#22c55e;"></div></div>
              <div style="padding:6px;">21</div>
              <!-- Week 4 -->
              <div style="padding:6px;">22</div>
              <div style="padding:6px;position:relative;">23<div style="position:absolute;bottom:2px;left:50%;transform:translateX(-50%);width:4px;height:4px;border-radius:50%;background:#22c55e;"></div></div>
              <div style="padding:6px;position:relative;">24<div style="position:absolute;bottom:2px;left:50%;transform:translateX(-50%);width:4px;height:4px;border-radius:50%;background:#22c55e;"></div></div>
              <div style="padding:6px;">25</div>
              <div style="padding:6px;">26</div>
              <div style="padding:6px;background:#2563eb;color:white;border-radius:6px;font-weight:600;cursor:pointer;">27</div>
              <div style="padding:6px;">28</div>
            </div>
            <!-- Legend -->
            <div style="display:flex;gap:10px;margin-top:8px;font-size:10px;color:#64748b;">
              <div style="display:flex;align-items:center;gap:3px;"><div style="width:6px;height:6px;border-radius:50%;background:#22c55e;"></div> Open</div>
              <div style="display:flex;align-items:center;gap:3px;"><div style="width:6px;height:6px;border-radius:50%;background:#f59e0b;"></div> Partial</div>
              <div style="display:flex;align-items:center;gap:3px;"><div style="width:6px;height:6px;border-radius:50%;background:#ef4444;"></div> Full</div>
            </div>
          </div>
          <!-- Right: Time slots for selected day -->
          <div style="padding:12px;">
            <div style="font-weight:600;font-size:13px;margin-bottom:4px;">Friday, Feb 27</div>
            <div style="font-size:11px;color:#64748b;margin-bottom:10px;">3 techs available &bull; 1 crew available</div>
            <!-- Time slots -->
            <div style="display:flex;flex-direction:column;gap:4px;">
              <div style="padding:8px 10px;border:1px solid #e2e8f0;border-radius:6px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;background:#f0fdf4;border-color:#86efac;" >
                <div>
                  <div style="font-size:12px;font-weight:600;">8:00 AM - 12:00 PM</div>
                  <div style="font-size:10px;color:#64748b;">Mike R., Alex T. available</div>
                </div>
                <span style="background:#dcfce7;color:#166534;padding:2px 8px;border-radius:9999px;font-size:10px;font-weight:600;">Open</span>
              </div>
              <div style="padding:8px 10px;border:1px solid #fde68a;border-radius:6px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;background:#fffbeb;">
                <div>
                  <div style="font-size:12px;font-weight:600;">10:00 AM - 2:00 PM</div>
                  <div style="font-size:10px;color:#64748b;">Mike R. available (Alex on JOB-044)</div>
                </div>
                <span style="background:#fef3c7;color:#92400e;padding:2px 8px;border-radius:9999px;font-size:10px;font-weight:600;">Partial</span>
              </div>
              <div style="padding:8px 10px;border:2px solid #2563eb;border-radius:6px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;background:#eff6ff;">
                <div>
                  <div style="font-size:12px;font-weight:600;color:#2563eb;">1:00 PM - 5:00 PM</div>
                  <div style="font-size:10px;color:#64748b;">Mike R., Alex T., Crew A available</div>
                </div>
                <span style="background:#dbeafe;color:#1e40af;padding:2px 8px;border-radius:9999px;font-size:10px;font-weight:600;">Selected</span>
              </div>
              <div style="padding:8px 10px;border:1px solid #e2e8f0;border-radius:6px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;">
                <div>
                  <div style="font-size:12px;font-weight:600;">3:00 PM - 7:00 PM</div>
                  <div style="font-size:10px;color:#64748b;">Alex T. available</div>
                </div>
                <span style="background:#dcfce7;color:#166534;padding:2px 8px;border-radius:9999px;font-size:10px;font-weight:600;">Open</span>
              </div>
            </div>
            <!-- Assign dropdown -->
            <div style="margin-top:10px;padding-top:10px;border-top:1px solid #e2e8f0;">
              <div style="font-size:11px;color:#64748b;margin-bottom:4px;">Assign to:</div>
              <select style="width:100%;padding:6px 8px;border:1px solid #e2e8f0;border-radius:6px;font-size:12px;">
                <option>Mike R.</option>
                <option>Alex T.</option>
                <option>Crew A (Mike, Alex, Sam)</option>
              </select>
            </div>
          </div>
        </div>
        <!-- Modal footer -->
        <div style="padding:10px 16px;border-top:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center;background:white;">
          <a href="#" style="font-size:12px;color:#2563eb;text-decoration:none;" onclick="event.preventDefault()">Open Full Calendar &rarr;</a>
          <div style="display:flex;gap:6px;">
            <button class="b b-out">Cancel</button>
            <button class="b b-blue">Confirm &mdash; Feb 27, 1:00 PM</button>
          </div>
        </div>
      </div>
      <!-- Pros/cons -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:14px;max-width:640px;margin-left:auto;margin-right:auto;">
        <div>
          <div style="font-weight:600;font-size:12px;color:#16a34a;margin-bottom:4px;">Pros</div>
          <ul style="font-size:11px;color:#475569;margin:0;padding-left:16px;line-height:1.6;">
            <li>Never leaves the estimate/job page</li>
            <li>See availability at a glance (color dots)</li>
            <li>Pick date + time + tech in one flow</li>
            <li>Quick — 3 clicks to schedule</li>
            <li>"Open Full Calendar" link for more detail</li>
          </ul>
        </div>
        <div>
          <div style="font-weight:600;font-size:12px;color:#dc2626;margin-bottom:4px;">Cons</div>
          <ul style="font-size:11px;color:#475569;margin:0;padding-left:16px;line-height:1.6;">
            <li>Limited view — can't see full day layout</li>
            <li>Small screen real estate for complex schedules</li>
            <li>Can't drag/rearrange jobs</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- ============ OPTION B: Schedule Slide Panel ============ -->
  <div class="card" style="overflow:hidden;margin-bottom:16px;">
    <div style="background:#2563eb;color:white;padding:10px 16px;">
      <div style="font-weight:700;font-size:14px;">Option B: Schedule Slide Panel</div>
      <div style="font-size:11px;opacity:0.85;">Opens from the right side (like Payments panel) — stays in context</div>
    </div>
    <div style="padding:16px;">
      <!-- Simulated slide panel -->
      <div style="display:grid;grid-template-columns:1fr 320px;gap:0;max-width:900px;margin:0 auto;border:2px solid #e2e8f0;border-radius:12px;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,0.08);">
        <!-- Left: faded estimate page -->
        <div style="background:#f8fafc;padding:16px;opacity:0.5;">
          <div style="font-size:12px;font-weight:600;color:#94a3b8;margin-bottom:8px;">← Estimate detail (dimmed)</div>
          <div style="background:white;border-radius:6px;padding:10px;border:1px solid #e2e8f0;">
            <div style="height:8px;background:#e2e8f0;border-radius:4px;margin-bottom:6px;width:60%;"></div>
            <div style="height:8px;background:#e2e8f0;border-radius:4px;margin-bottom:6px;width:80%;"></div>
            <div style="height:8px;background:#e2e8f0;border-radius:4px;width:40%;"></div>
          </div>
          <div style="background:white;border-radius:6px;padding:10px;border:1px solid #e2e8f0;margin-top:8px;">
            <div style="height:8px;background:#e2e8f0;border-radius:4px;margin-bottom:6px;width:70%;"></div>
            <div style="height:8px;background:#e2e8f0;border-radius:4px;width:50%;"></div>
          </div>
        </div>
        <!-- Right: slide panel -->
        <div style="background:white;border-left:2px solid #2563eb;padding:0;">
          <div style="background:#1e293b;color:white;padding:10px 14px;display:flex;align-items:center;justify-content:space-between;">
            <span style="font-weight:600;font-size:13px;">Schedule Job</span>
            <button style="background:none;border:none;color:white;font-size:16px;cursor:pointer;">&times;</button>
          </div>
          <div style="padding:12px;">
            <!-- Mini month calendar -->
            <div style="display:grid;grid-template-columns:repeat(7,1fr);text-align:center;font-size:9px;color:#94a3b8;margin-bottom:2px;">
              <div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div>
            </div>
            <div style="display:grid;grid-template-columns:repeat(7,1fr);text-align:center;gap:1px;font-size:10px;margin-bottom:10px;">
              <div style="padding:4px;color:#cbd5e1;">25</div><div style="padding:4px;color:#cbd5e1;">26</div><div style="padding:4px;color:#cbd5e1;">27</div><div style="padding:4px;color:#cbd5e1;">28</div><div style="padding:4px;color:#cbd5e1;">29</div><div style="padding:4px;color:#cbd5e1;">30</div><div style="padding:4px;color:#cbd5e1;">31</div>
              <div style="padding:4px;">1</div><div style="padding:4px;">2</div><div style="padding:4px;">3</div><div style="padding:4px;">4</div><div style="padding:4px;">5</div><div style="padding:4px;">6</div><div style="padding:4px;">7</div>
              <div style="padding:4px;">8</div><div style="padding:4px;">9</div><div style="padding:4px;">10</div><div style="padding:4px;">11</div><div style="padding:4px;">12</div><div style="padding:4px;">13</div><div style="padding:4px;">14</div>
              <div style="padding:4px;">15</div><div style="padding:4px;">16</div><div style="padding:4px;">17</div><div style="padding:4px;">18</div><div style="padding:4px;">19</div><div style="padding:4px;">20</div><div style="padding:4px;">21</div>
              <div style="padding:4px;">22</div><div style="padding:4px;">23</div><div style="padding:4px;">24</div><div style="padding:4px;">25</div><div style="padding:4px;">26</div><div style="padding:4px;background:#2563eb;color:white;border-radius:4px;font-weight:700;">27</div><div style="padding:4px;">28</div>
            </div>
            <!-- Day detail -->
            <div style="font-weight:600;font-size:12px;margin-bottom:6px;">Feb 27 — Available Slots</div>
            <!-- Compact time slots -->
            <div style="display:flex;flex-direction:column;gap:3px;margin-bottom:10px;">
              <div style="padding:6px 8px;background:#f0fdf4;border:1px solid #86efac;border-radius:4px;font-size:11px;display:flex;justify-content:space-between;cursor:pointer;">
                <span>8 AM - 12 PM</span><span style="color:#166534;font-weight:600;">3 avail</span>
              </div>
              <div style="padding:6px 8px;background:#fffbeb;border:1px solid #fde68a;border-radius:4px;font-size:11px;display:flex;justify-content:space-between;cursor:pointer;">
                <span>10 AM - 2 PM</span><span style="color:#92400e;font-weight:600;">1 avail</span>
              </div>
              <div style="padding:6px 8px;background:#eff6ff;border:2px solid #2563eb;border-radius:4px;font-size:11px;display:flex;justify-content:space-between;cursor:pointer;font-weight:600;">
                <span style="color:#2563eb;">1 PM - 5 PM</span><span style="color:#1e40af;">Selected</span>
              </div>
            </div>
            <!-- Assign -->
            <div style="font-size:11px;color:#64748b;margin-bottom:3px;">Assign to:</div>
            <select style="width:100%;padding:5px;border:1px solid #e2e8f0;border-radius:4px;font-size:11px;margin-bottom:8px;">
              <option>Mike R.</option><option>Crew A</option>
            </select>
            <!-- Arrival window -->
            <div style="font-size:11px;color:#64748b;margin-bottom:3px;">Arrival Window:</div>
            <select style="width:100%;padding:5px;border:1px solid #e2e8f0;border-radius:4px;font-size:11px;margin-bottom:12px;">
              <option>Morning (8 AM - 12 PM)</option><option>Afternoon (1 PM - 5 PM)</option>
            </select>
            <button class="b b-blue" style="width:100%;justify-content:center;">Confirm Schedule</button>
            <a href="#" style="display:block;text-align:center;font-size:11px;color:#2563eb;margin-top:6px;" onclick="event.preventDefault()">Open Full Calendar &rarr;</a>
          </div>
        </div>
      </div>
      <!-- Pros/cons -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:14px;max-width:640px;margin-left:auto;margin-right:auto;">
        <div>
          <div style="font-weight:600;font-size:12px;color:#16a34a;margin-bottom:4px;">Pros</div>
          <ul style="font-size:11px;color:#475569;margin:0;padding-left:16px;line-height:1.6;">
            <li>Consistent pattern (same as Payments panel)</li>
            <li>Stays in context — see estimate while scheduling</li>
            <li>Compact, mobile-friendly</li>
          </ul>
        </div>
        <div>
          <div style="font-weight:600;font-size:12px;color:#dc2626;margin-bottom:4px;">Cons</div>
          <ul style="font-size:11px;color:#475569;margin:0;padding-left:16px;line-height:1.6;">
            <li>Very narrow — calendar is cramped</li>
            <li>Hard to see full tech/crew schedules</li>
            <li>Same "small viewport" problem as Option A</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- ============ OPTION C: Full Calendar Page ============ -->
  <div class="card" style="overflow:hidden;margin-bottom:16px;">
    <div style="background:#16a34a;color:white;padding:10px 16px;">
      <div style="font-weight:700;font-size:14px;">Option C: Full Calendar Page</div>
      <div style="font-size:11px;opacity:0.85;">Navigate to /calendar — full week/day view with all techs and jobs visible</div>
    </div>
    <div style="padding:16px;">
      <!-- Simulated calendar page -->
      <div style="border:2px solid #e2e8f0;border-radius:12px;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,0.08);">
        <!-- Calendar header -->
        <div style="padding:10px 16px;border-bottom:1px solid #e2e8f0;display:flex;align-items:center;justify-content:space-between;background:white;">
          <div style="display:flex;align-items:center;gap:10px;">
            <span style="font-weight:700;font-size:14px;">Schedule — Week of Feb 23, 2026</span>
            <div style="display:flex;gap:2px;">
              <button style="background:#f1f5f9;border:1px solid #e2e8f0;border-radius:4px;padding:3px 8px;font-size:11px;cursor:pointer;">Day</button>
              <button style="background:#2563eb;color:white;border:none;border-radius:4px;padding:3px 8px;font-size:11px;cursor:pointer;font-weight:600;">Week</button>
              <button style="background:#f1f5f9;border:1px solid #e2e8f0;border-radius:4px;padding:3px 8px;font-size:11px;cursor:pointer;">Month</button>
            </div>
          </div>
          <div style="display:flex;gap:6px;align-items:center;">
            <button class="b b-out" style="font-size:11px;">&larr;</button>
            <button class="b b-out" style="font-size:11px;">Today</button>
            <button class="b b-out" style="font-size:11px;">&rarr;</button>
          </div>
        </div>
        <!-- Unscheduled jobs sidebar + calendar grid -->
        <div style="display:grid;grid-template-columns:180px 1fr;">
          <!-- Unscheduled sidebar -->
          <div style="background:#fefce8;border-right:1px solid #e2e8f0;padding:8px;">
            <div style="font-weight:600;font-size:11px;color:#92400e;margin-bottom:6px;">Unscheduled (3)</div>
            <div style="background:white;border:1px solid #fde68a;border-radius:6px;padding:6px 8px;margin-bottom:4px;cursor:grab;font-size:11px;">
              <div style="font-weight:600;">EST-001-1</div>
              <div style="color:#64748b;font-size:10px;">John &bull; Local Move</div>
              <div style="color:#64748b;font-size:10px;">~3 hrs &bull; 2 team</div>
            </div>
            <div style="background:white;border:1px solid #fde68a;border-radius:6px;padding:6px 8px;margin-bottom:4px;cursor:grab;font-size:11px;">
              <div style="font-weight:600;">JOB-048</div>
              <div style="color:#64748b;font-size:10px;">Sarah M. &bull; Deep Clean</div>
              <div style="color:#64748b;font-size:10px;">~2 hrs &bull; 1 team</div>
            </div>
            <div style="background:white;border:1px solid #fde68a;border-radius:6px;padding:6px 8px;cursor:grab;font-size:11px;">
              <div style="font-weight:600;">JOB-049</div>
              <div style="color:#64748b;font-size:10px;">Tom K. &bull; HVAC Repair</div>
              <div style="color:#64748b;font-size:10px;">~1 hr &bull; 1 tech</div>
            </div>
          </div>
          <!-- Calendar grid -->
          <div style="overflow-x:auto;">
            <table style="width:100%;border-collapse:collapse;min-width:600px;">
              <thead>
                <tr style="border-bottom:1px solid #e2e8f0;">
                  <th style="padding:6px 4px;font-size:10px;color:#94a3b8;font-weight:500;width:50px;"></th>
                  <th style="padding:6px 4px;font-size:11px;font-weight:600;text-align:center;">Mon 23</th>
                  <th style="padding:6px 4px;font-size:11px;font-weight:600;text-align:center;">Tue 24</th>
                  <th style="padding:6px 4px;font-size:11px;font-weight:600;text-align:center;">Wed 25</th>
                  <th style="padding:6px 4px;font-size:11px;font-weight:600;text-align:center;">Thu 26</th>
                  <th style="padding:6px 4px;font-size:11px;font-weight:600;text-align:center;background:#eff6ff;">Fri 27</th>
                  <th style="padding:6px 4px;font-size:11px;font-weight:600;text-align:center;">Sat 28</th>
                </tr>
              </thead>
              <tbody>
                <!-- 8 AM row -->
                <tr style="border-bottom:1px solid #f1f5f9;">
                  <td style="padding:4px;font-size:10px;color:#94a3b8;text-align:right;vertical-align:top;">8 AM</td>
                  <td style="padding:2px;vertical-align:top;"><div style="background:#dbeafe;border-left:3px solid #2563eb;border-radius:4px;padding:3px 5px;font-size:9px;margin-bottom:2px;"><b>JOB-042</b><br>Move — Mike</div></td>
                  <td style="padding:2px;vertical-align:top;"><div style="background:#dcfce7;border-left:3px solid #16a34a;border-radius:4px;padding:3px 5px;font-size:9px;"><b>JOB-043</b><br>Clean — Alex</div></td>
                  <td style="padding:2px;"></td>
                  <td style="padding:2px;vertical-align:top;"><div style="background:#fef3c7;border-left:3px solid #f59e0b;border-radius:4px;padding:3px 5px;font-size:9px;"><b>JOB-045</b><br>HVAC — Sam</div></td>
                  <td style="padding:2px;background:#fafafe;"></td>
                  <td style="padding:2px;"></td>
                </tr>
                <!-- 10 AM row -->
                <tr style="border-bottom:1px solid #f1f5f9;">
                  <td style="padding:4px;font-size:10px;color:#94a3b8;text-align:right;vertical-align:top;">10 AM</td>
                  <td style="padding:2px;vertical-align:top;"><div style="background:#dbeafe;border-left:3px solid #2563eb;border-radius:4px;padding:3px 5px;font-size:9px;opacity:0.6;"><i>(continued)</i></div></td>
                  <td style="padding:2px;"></td>
                  <td style="padding:2px;vertical-align:top;"><div style="background:#e0e7ff;border-left:3px solid #6366f1;border-radius:4px;padding:3px 5px;font-size:9px;"><b>JOB-044</b><br>Move — Crew A</div></td>
                  <td style="padding:2px;"></td>
                  <td style="padding:2px;background:#fafafe;"></td>
                  <td style="padding:2px;"></td>
                </tr>
                <!-- 12 PM row -->
                <tr style="border-bottom:1px solid #f1f5f9;">
                  <td style="padding:4px;font-size:10px;color:#94a3b8;text-align:right;vertical-align:top;">12 PM</td>
                  <td style="padding:2px;"></td>
                  <td style="padding:2px;"></td>
                  <td style="padding:2px;vertical-align:top;"><div style="background:#e0e7ff;border-left:3px solid #6366f1;border-radius:4px;padding:3px 5px;font-size:9px;opacity:0.6;"><i>(continued)</i></div></td>
                  <td style="padding:2px;"></td>
                  <td style="padding:2px;background:#fafafe;"></td>
                  <td style="padding:2px;"></td>
                </tr>
                <!-- 2 PM row -->
                <tr style="border-bottom:1px solid #f1f5f9;">
                  <td style="padding:4px;font-size:10px;color:#94a3b8;text-align:right;vertical-align:top;">2 PM</td>
                  <td style="padding:2px;vertical-align:top;"><div style="background:#dcfce7;border-left:3px solid #16a34a;border-radius:4px;padding:3px 5px;font-size:9px;"><b>JOB-046</b><br>Clean — Alex</div></td>
                  <td style="padding:2px;vertical-align:top;"><div style="background:#fef3c7;border-left:3px solid #f59e0b;border-radius:4px;padding:3px 5px;font-size:9px;"><b>JOB-047</b><br>Pest — Sam</div></td>
                  <td style="padding:2px;"></td>
                  <td style="padding:2px;"></td>
                  <td style="padding:2px;background:#fafafe;vertical-align:top;"><div style="background:white;border:2px dashed #2563eb;border-radius:4px;padding:6px 5px;font-size:9px;text-align:center;color:#2563eb;font-weight:600;">Drop job here</div></td>
                  <td style="padding:2px;"></td>
                </tr>
                <!-- 4 PM row -->
                <tr>
                  <td style="padding:4px;font-size:10px;color:#94a3b8;text-align:right;vertical-align:top;">4 PM</td>
                  <td style="padding:2px;"></td>
                  <td style="padding:2px;"></td>
                  <td style="padding:2px;"></td>
                  <td style="padding:2px;"></td>
                  <td style="padding:2px;background:#fafafe;"></td>
                  <td style="padding:2px;"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <!-- Pros/cons -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:14px;max-width:640px;margin-left:auto;margin-right:auto;">
        <div>
          <div style="font-weight:600;font-size:12px;color:#16a34a;margin-bottom:4px;">Pros</div>
          <ul style="font-size:11px;color:#475569;margin:0;padding-left:16px;line-height:1.6;">
            <li>Full visibility — see entire week at a glance</li>
            <li>Drag unscheduled jobs onto time slots</li>
            <li>See all techs/crews and their workload</li>
            <li>Day/Week/Month views</li>
            <li>Best for operations managers doing daily planning</li>
          </ul>
        </div>
        <div>
          <div style="font-weight:600;font-size:12px;color:#dc2626;margin-bottom:4px;">Cons</div>
          <ul style="font-size:11px;color:#475569;margin:0;padding-left:16px;line-height:1.6;">
            <li>Leaves the estimate/job page — context switch</li>
            <li>More complex to build (drag & drop, week rendering)</li>
            <li>Overkill for scheduling a single job</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- ============ RECOMMENDATION ============ -->
  <div class="card" style="overflow:hidden;">
    <div style="background:#0f172a;color:white;padding:10px 16px;">
      <div style="font-weight:700;font-size:14px;">Suggested Approach: A + C Combined</div>
    </div>
    <div style="padding:16px;">
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;text-align:center;">
        <div style="background:#f5f3ff;border:2px solid #7c3aed;border-radius:8px;padding:12px;">
          <div style="font-size:24px;margin-bottom:4px;">1&#xFE0F;&#x20E3;</div>
          <div style="font-weight:700;font-size:12px;margin-bottom:4px;">Click "Schedule Job"</div>
          <div style="font-size:11px;color:#64748b;">On estimate or job detail, click Schedule button</div>
        </div>
        <div style="background:#eff6ff;border:2px solid #2563eb;border-radius:8px;padding:12px;">
          <div style="font-size:24px;margin-bottom:4px;">2&#xFE0F;&#x20E3;</div>
          <div style="font-weight:700;font-size:12px;margin-bottom:4px;">Mini Calendar Modal (A)</div>
          <div style="font-size:11px;color:#64748b;">Quick glimpse — pick date, see availability dots, choose time slot, assign tech</div>
        </div>
        <div style="background:#f0fdf4;border:2px solid #16a34a;border-radius:8px;padding:12px;">
          <div style="font-size:24px;margin-bottom:4px;">3&#xFE0F;&#x20E3;</div>
          <div style="font-weight:700;font-size:12px;margin-bottom:4px;">Full Calendar (C)</div>
          <div style="font-size:11px;color:#64748b;">"Open Full Calendar" link → week view with drag & drop for complex scheduling</div>
        </div>
      </div>
      <div style="margin-top:12px;background:#f8fafc;border-radius:8px;padding:10px 14px;font-size:12px;color:#475569;">
        <b>Why both:</b> Option A handles 80% of scheduling (estimator books a single job quickly). Option C handles the other 20% (operations manager plans the whole week, rearranges jobs, balances workloads). The modal has an "Open Full Calendar" link connecting the two. Build A first, C later.
      </div>
    </div>
  </div>

  <div style="border:2px dashed #8b5cf6;background:#f5f3ff;border-radius:8px;padding:10px;text-align:center;margin-top:14px;">
    <b>Job Scheduler</b> — Compare all three options. Recommendation: build <b>Option A (modal)</b> first for quick scheduling, then <b>Option C (calendar page)</b> for full planning view.
  </div>
</div>

<!-- ================================================================ -->
<!-- 8. DISPATCH BOARD                                                 -->
<!-- ================================================================ -->
<div class="view fade" id="v-dispatch">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
    <div style="font-size:15px;font-weight:600;">Dispatch Board — Feb 27, 2026</div>
    <div style="display:flex;gap:6px;">
      <button class="b b-out">&larr; Feb 26</button>
      <button class="b b-out">Today</button>
      <button class="b b-out">Feb 28 &rarr;</button>
    </div>
  </div>
  <div id="dispatch-board" class="grid-3">
    <!-- Dynamic: columns change based on mode -->
  </div>
  <div style="border:2px dashed #f59e0b;background:#fffbeb;border-radius:8px;padding:10px;text-align:center;margin-top:14px;">
    <b>Page 8: Dispatch Board</b> — Columns adapt to company mode. Individual = tech columns. Crew = crew columns. Both = mixed. <b>Try toggling above!</b>
  </div>
</div>

<!-- ================================================================ -->
<!-- 9. PAYMENTS FLOW                                                   -->
<!-- ================================================================ -->
<div class="view fade" id="v-payments">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
    <div><div style="font-size:15px;font-weight:600;">Payment Flow</div><div style="color:#64748b;">How payments work across the system — 4 trigger points</div></div>
  </div>

  <!-- Payment contexts grid -->
  <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin-bottom:16px;" class="grid-2">

    <!-- Context 1: Estimate Approval Deposit -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#16a34a;color:white;padding:8px 14px;font-weight:600;font-size:12px;display:flex;justify-content:space-between;">
        <span>1. Estimate Approval — Deposit</span>
        <span class="badge" style="background:rgba(255,255,255,0.2);color:white;">Customer-Facing</span>
      </div>
      <div style="padding:14px;">
        <div style="color:#64748b;font-size:11px;margin-bottom:10px;">Triggered when customer clicks "Approve & Sign" on the estimate page</div>
        <!-- Mini payment modal -->
        <div style="border:2px solid #e2e8f0;border-radius:10px;overflow:hidden;max-width:340px;margin:0 auto;">
          <div style="background:#1e293b;color:white;padding:10px 14px;display:flex;justify-content:space-between;align-items:center;">
            <span style="font-weight:600;">Pay Deposit</span>
            <span style="font-size:11px;opacity:0.7;">x</span>
          </div>
          <div style="padding:14px;">
            <div style="text-align:center;margin-bottom:12px;">
              <div style="font-size:11px;color:#64748b;">Deposit Required</div>
              <div style="font-size:28px;font-weight:700;color:#16a34a;">$100.00</div>
              <div style="font-size:11px;color:#64748b;">of $425.00 total</div>
            </div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;padding:10px;margin-bottom:8px;">
              <div style="font-size:11px;color:#64748b;margin-bottom:4px;">Card Number</div>
              <div style="font-size:13px;color:#94a3b8;">4242 4242 4242 4242</div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px;">
              <div style="border:1px solid #e2e8f0;border-radius:6px;padding:10px;">
                <div style="font-size:11px;color:#64748b;">Expiry</div>
                <div style="font-size:13px;color:#94a3b8;">12/28</div>
              </div>
              <div style="border:1px solid #e2e8f0;border-radius:6px;padding:10px;">
                <div style="font-size:11px;color:#64748b;">CVC</div>
                <div style="font-size:13px;color:#94a3b8;">***</div>
              </div>
            </div>
            <button class="b b-green" style="width:100%;justify-content:center;padding:10px;">Pay $100.00</button>
            <div style="text-align:center;margin-top:8px;display:flex;align-items:center;justify-content:center;gap:4px;">
              <span style="font-size:14px;">&#128274;</span>
              <span style="font-size:10px;color:#94a3b8;">Secured by Stripe</span>
            </div>
          </div>
        </div>
        <div style="margin-top:10px;font-size:11px;color:#64748b;">
          <b>After payment:</b> Estimate status → Approved, deposit recorded, job auto-created (optional), receipt emailed
        </div>
      </div>
    </div>

    <!-- Context 2: Admin "Take Payment" -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#2563eb;color:white;padding:8px 14px;font-weight:600;font-size:12px;display:flex;justify-content:space-between;">
        <span>2. Admin — Take Payment</span>
        <span class="badge" style="background:rgba(255,255,255,0.2);color:white;">Admin Dashboard</span>
      </div>
      <div style="padding:14px;">
        <div style="color:#64748b;font-size:11px;margin-bottom:10px;">Triggered from "Take Payment" button on Job Detail or Estimate Detail</div>
        <!-- Mini payment modal -->
        <div style="border:2px solid #e2e8f0;border-radius:10px;overflow:hidden;max-width:340px;margin:0 auto;">
          <div style="background:#1e293b;color:white;padding:10px 14px;display:flex;justify-content:space-between;align-items:center;">
            <span style="font-weight:600;">Record Payment</span>
            <span style="font-size:11px;opacity:0.7;">x</span>
          </div>
          <div style="padding:14px;">
            <div class="fi"><span class="fi-l">Customer</span><span style="font-weight:600;">John</span></div>
            <div class="fi"><span class="fi-l">Job</span><span style="color:#2563eb;">EST-001-1</span></div>
            <div class="fi"><span class="fi-l">Balance Due</span><span style="font-weight:700;color:#dc2626;">$325.00</span></div>
            <div style="border-top:1px solid #e2e8f0;margin:8px 0;"></div>
            <div style="margin-bottom:8px;">
              <div style="font-size:11px;color:#64748b;margin-bottom:4px;">Amount</div>
              <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;font-size:16px;font-weight:700;">$325.00</div>
            </div>
            <div style="margin-bottom:10px;">
              <div style="font-size:11px;color:#64748b;margin-bottom:4px;">Payment Method</div>
              <div class="tog" style="width:100%;">
                <button class="tog-b on" style="flex:1;text-align:center;">Card</button>
                <button class="tog-b" style="flex:1;text-align:center;">Cash</button>
                <button class="tog-b" style="flex:1;text-align:center;">Check</button>
                <button class="tog-b" style="flex:1;text-align:center;">Other</button>
              </div>
            </div>
            <button class="b b-blue" style="width:100%;justify-content:center;padding:10px;">Record $325.00</button>
          </div>
        </div>
        <div style="margin-top:10px;font-size:11px;color:#64748b;">
          <b>Methods:</b> Charge card on file, enter new card, or record cash/check/other. Amount can be partial or full balance.
        </div>
      </div>
    </div>

    <!-- Context 3: Invoice Payment -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#8b5cf6;color:white;padding:8px 14px;font-weight:600;font-size:12px;display:flex;justify-content:space-between;">
        <span>3. Invoice — Customer Pays Online</span>
        <span class="badge" style="background:rgba(255,255,255,0.2);color:white;">Customer-Facing</span>
      </div>
      <div style="padding:14px;">
        <div style="color:#64748b;font-size:11px;margin-bottom:10px;">Triggered when customer opens invoice email link and clicks "Pay Now"</div>
        <div style="border:2px solid #e2e8f0;border-radius:10px;overflow:hidden;max-width:340px;margin:0 auto;">
          <div style="background:linear-gradient(135deg,#1e40af,#3b82f6);color:white;padding:16px;text-align:center;">
            <div style="font-size:11px;opacity:0.8;text-transform:uppercase;">Invoice #INV-0042</div>
            <div style="font-size:28px;font-weight:700;margin:4px 0;">$325.00</div>
            <div style="font-size:12px;opacity:0.8;">Due: Mar 15, 2026</div>
          </div>
          <div style="padding:14px;">
            <div class="pr" style="font-size:12px;"><span>Local Move — Feb 27</span><span>$425.00</span></div>
            <div class="pr" style="font-size:12px;color:#16a34a;"><span>Deposit Paid</span><span>-$100.00</span></div>
            <div style="border-top:1px solid #e2e8f0;margin:6px 0;"></div>
            <div class="pr" style="font-weight:700;"><span>Amount Due</span><span>$325.00</span></div>
            <button class="b b-blue" style="width:100%;justify-content:center;padding:10px;margin-top:10px;">Pay $325.00</button>
            <div style="text-align:center;margin-top:8px;">
              <span style="font-size:10px;color:#94a3b8;">&#128274; Secured by Stripe &bull; <a href="#" style="color:#2563eb;">Download PDF</a></span>
            </div>
          </div>
        </div>
        <div style="margin-top:10px;font-size:11px;color:#64748b;">
          <b>After payment:</b> Invoice status → Paid, receipt emailed, job marked as paid, notification to admin
        </div>
      </div>
    </div>

    <!-- Context 4: Recurring Auto-Charge -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#f59e0b;color:white;padding:8px 14px;font-weight:600;font-size:12px;display:flex;justify-content:space-between;">
        <span>4. Recurring — Auto-Charge</span>
        <span class="badge" style="background:rgba(255,255,255,0.2);color:white;">Automatic</span>
      </div>
      <div style="padding:14px;">
        <div style="color:#64748b;font-size:11px;margin-bottom:10px;">Triggered automatically after each recurring service is completed</div>
        <div style="border:2px solid #e2e8f0;border-radius:10px;overflow:hidden;max-width:340px;margin:0 auto;">
          <div style="background:#fffbeb;padding:10px 14px;border-bottom:1px solid #fde68a;">
            <div style="font-weight:600;color:#92400e;font-size:12px;">Auto-Charge Settings</div>
          </div>
          <div style="padding:14px;">
            <div class="fi"><span class="fi-l">Service</span><span>Weekly Cleaning</span></div>
            <div class="fi"><span class="fi-l">Amount</span><span style="font-weight:600;">$150/visit</span></div>
            <div class="fi"><span class="fi-l">Card on File</span><span style="color:#2563eb;">Visa ****4242</span></div>
            <div class="fi"><span class="fi-l">Auto-Charge</span>
              <div class="sw on" style="display:inline-block;"></div>
            </div>
            <div style="border-top:1px solid #e2e8f0;margin:8px 0;"></div>
            <div style="font-size:11px;font-weight:600;margin-bottom:6px;">Recent Charges</div>
            <div class="pr" style="font-size:12px;"><span>Feb 10 — Visit #8</span><span style="color:#16a34a;">$150 &#10003;</span></div>
            <div class="pr" style="font-size:12px;"><span>Feb 3 — Visit #7</span><span style="color:#16a34a;">$150 &#10003;</span></div>
            <div class="pr" style="font-size:12px;"><span>Jan 27 — Visit #6</span><span style="color:#16a34a;">$150 &#10003;</span></div>
            <div class="pr" style="font-size:12px;color:#dc2626;"><span>Jan 20 — Visit #5</span><span>$150 Failed &#10007;</span></div>
          </div>
        </div>
        <div style="margin-top:10px;font-size:11px;color:#64748b;">
          <b>On failure:</b> Retry in 3 days, notify admin, notify customer. After 3 fails, pause auto-charge and flag account.
        </div>
      </div>
    </div>
  </div>

  <!-- Payment records table -->
  <div class="card" style="overflow:hidden;">
    <div style="padding:10px 14px;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;">
      <span style="font-weight:600;">Payment History — John</span>
      <div style="display:flex;gap:6px;">
        <button class="b b-out" style="font-size:11px;">Export</button>
        <button class="b b-blue" style="font-size:11px;">+ Take Payment</button>
      </div>
    </div>
    <table style="width:100%;border-collapse:collapse;">
      <thead><tr style="background:#f8fafc;border-bottom:1px solid #e2e8f0;">
        <th style="text-align:left;padding:8px 14px;color:#64748b;font-weight:500;font-size:12px;">Date</th>
        <th style="text-align:left;padding:8px 14px;color:#64748b;font-weight:500;font-size:12px;">Description</th>
        <th style="text-align:left;padding:8px 14px;color:#64748b;font-weight:500;font-size:12px;">Method</th>
        <th style="text-align:left;padding:8px 14px;color:#64748b;font-weight:500;font-size:12px;">Amount</th>
        <th style="text-align:left;padding:8px 14px;color:#64748b;font-weight:500;font-size:12px;">Status</th>
      </tr></thead>
      <tbody>
        <tr style="border-bottom:1px solid #f1f5f9;">
          <td style="padding:8px 14px;">Feb 10</td>
          <td style="padding:8px 14px;">Cleaning — Visit #8 <span class="badge" style="background:#f3e8ff;color:#7c3aed;">Auto</span></td>
          <td style="padding:8px 14px;">Visa ****4242</td>
          <td style="padding:8px 14px;font-weight:600;">$150.00</td>
          <td style="padding:8px 14px;"><span class="badge" style="background:#dcfce7;color:#166534;">Paid</span></td>
        </tr>
        <tr style="border-bottom:1px solid #f1f5f9;">
          <td style="padding:8px 14px;">Jan 16</td>
          <td style="padding:8px 14px;">EST-001 Deposit</td>
          <td style="padding:8px 14px;">Visa ****4242</td>
          <td style="padding:8px 14px;font-weight:600;">$100.00</td>
          <td style="padding:8px 14px;"><span class="badge" style="background:#dcfce7;color:#166534;">Paid</span></td>
        </tr>
        <tr style="border-bottom:1px solid #f1f5f9;">
          <td style="padding:8px 14px;">Jan 20</td>
          <td style="padding:8px 14px;">Cleaning — Visit #5 <span class="badge" style="background:#f3e8ff;color:#7c3aed;">Auto</span></td>
          <td style="padding:8px 14px;">Visa ****4242</td>
          <td style="padding:8px 14px;font-weight:600;">$150.00</td>
          <td style="padding:8px 14px;"><span class="badge" style="background:#fef2f2;color:#dc2626;">Failed</span></td>
        </tr>
        <tr>
          <td style="padding:8px 14px;">Jan 22</td>
          <td style="padding:8px 14px;">Cleaning — Visit #5 (retry)</td>
          <td style="padding:8px 14px;">Cash</td>
          <td style="padding:8px 14px;font-weight:600;">$150.00</td>
          <td style="padding:8px 14px;"><span class="badge" style="background:#dcfce7;color:#166534;">Paid</span></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div style="border:2px dashed #16a34a;background:#f0fdf4;border-radius:8px;padding:10px;text-align:center;margin-top:14px;">
    <b>Page 9: Payments</b> — 4 payment contexts: deposit on approval (customer), admin take-payment (phone/in-person), invoice link (customer), recurring auto-charge. All share a reusable PaymentModal. Payment history tracks every transaction.
  </div>
</div>

<!-- ================================================================ -->
<!-- 10. CUSTOMER PORTAL                                                -->
<!-- ================================================================ -->
<div class="view fade" id="v-portal">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
    <div><div style="font-size:15px;font-weight:600;">Customer Portal</div><div style="color:#64748b;">What John sees when they log into their portal</div></div>
    <span class="badge" style="background:#dbeafe;color:#1e40af;padding:4px 10px;font-size:12px;">portal.yourcompany.com</span>
  </div>

  <!-- Portal login context -->
  <div style="display:grid;grid-template-columns:280px 1fr;gap:14px;align-items:start;" class="grid-2">
    <!-- Portal Sidebar -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#1e293b;color:white;padding:14px;text-align:center;">
        <div style="width:48px;height:48px;border-radius:50%;background:#2563eb;color:white;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:18px;margin:0 auto 8px;">J</div>
        <div style="font-weight:600;">John Smith</div>
        <div style="font-size:11px;opacity:0.7;">teachout05@gmail.com</div>
      </div>
      <div style="padding:4px;">
        <div style="padding:10px 14px;background:#eff6ff;border-radius:6px;font-weight:600;color:#2563eb;cursor:pointer;margin:2px;">Dashboard</div>
        <div style="padding:10px 14px;cursor:pointer;color:#64748b;margin:2px;border-radius:6px;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">My Estimates</div>
        <div style="padding:10px 14px;cursor:pointer;color:#64748b;margin:2px;border-radius:6px;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">My Jobs</div>
        <div style="padding:10px 14px;cursor:pointer;color:#64748b;margin:2px;border-radius:6px;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">Invoices & Payments</div>
        <div style="padding:10px 14px;cursor:pointer;color:#64748b;margin:2px;border-radius:6px;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">Contracts</div>
        <div style="padding:10px 14px;cursor:pointer;color:#64748b;margin:2px;border-radius:6px;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">Documents</div>
        <div style="padding:10px 14px;cursor:pointer;color:#64748b;margin:2px;border-radius:6px;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">Messages</div>
        <div style="padding:10px 14px;cursor:pointer;color:#64748b;margin:2px;border-radius:6px;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">Settings</div>
      </div>
    </div>

    <!-- Portal Main Content -->
    <div style="display:flex;flex-direction:column;gap:12px;">
      <!-- Welcome banner -->
      <div class="card" style="overflow:hidden;">
        <div style="background:linear-gradient(135deg,#1e40af,#3b82f6);padding:20px;color:white;">
          <div style="font-size:16px;font-weight:700;">Welcome back, John</div>
          <div style="font-size:12px;opacity:0.8;margin-top:4px;">You have 1 pending estimate and 2 upcoming appointments</div>
        </div>
      </div>

      <!-- Action items -->
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;" class="grid-3">
        <!-- Pending estimate -->
        <div class="card cp" style="border-left:3px solid #f59e0b;">
          <div style="font-size:11px;color:#64748b;text-transform:uppercase;font-weight:600;">Needs Attention</div>
          <div style="font-weight:600;margin:4px 0;">Estimate EST-001</div>
          <div style="font-size:12px;color:#64748b;">Local Move &bull; $425</div>
          <div style="margin-top:8px;display:flex;gap:6px;">
            <button class="b b-green" style="font-size:11px;" onclick="go('est-preview')">Review & Approve</button>
            <button class="b b-out" style="font-size:11px;">Request Changes</button>
          </div>
        </div>
        <!-- Upcoming job -->
        <div class="card cp" style="border-left:3px solid #2563eb;">
          <div style="font-size:11px;color:#64748b;text-transform:uppercase;font-weight:600;">Next Appointment</div>
          <div style="font-weight:600;margin:4px 0;">Weekly Cleaning</div>
          <div style="font-size:12px;color:#64748b;">Mon, Feb 17 at 9:00 AM</div>
          <div style="margin-top:8px;">
            <button class="b b-out" style="font-size:11px;">Reschedule</button>
          </div>
        </div>
        <!-- Payment due -->
        <div class="card cp" style="border-left:3px solid #dc2626;">
          <div style="font-size:11px;color:#64748b;text-transform:uppercase;font-weight:600;">Payment Due</div>
          <div style="font-weight:600;margin:4px 0;">Invoice #INV-0042</div>
          <div style="font-size:12px;color:#64748b;">$325.00 &bull; Due Mar 15</div>
          <div style="margin-top:8px;">
            <button class="b b-green" style="font-size:11px;" onclick="go('payments')">Pay Now</button>
          </div>
        </div>
      </div>

      <!-- My Estimates -->
      <div class="card" style="overflow:hidden;">
        <div style="padding:10px 14px;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;">
          <span style="font-weight:600;">My Estimates</span>
          <button class="b-ghost" style="font-size:11px;">View All</button>
        </div>
        <table style="width:100%;border-collapse:collapse;">
          <tbody>
            <tr style="border-bottom:1px solid #f1f5f9;cursor:pointer;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">
              <td style="padding:10px 14px;">
                <div style="font-weight:600;">EST-001 — Local Move</div>
                <div style="font-size:11px;color:#64748b;">Jan 15, 2026 &bull; Phoenix AZ</div>
              </td>
              <td style="padding:10px 14px;font-weight:600;text-align:right;">$425.00</td>
              <td style="padding:10px 14px;text-align:right;"><span class="badge" style="background:#fef3c7;color:#92400e;">Awaiting Approval</span></td>
              <td style="padding:10px 14px;text-align:right;"><button class="b b-green" style="font-size:11px;">Review</button></td>
            </tr>
            <tr style="cursor:pointer;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">
              <td style="padding:10px 14px;">
                <div style="font-weight:600;">EST-002 — Weekly Cleaning</div>
                <div style="font-size:11px;color:#64748b;">Jan 20, 2026 &bull; Phoenix AZ</div>
              </td>
              <td style="padding:10px 14px;font-weight:600;text-align:right;">$150/visit</td>
              <td style="padding:10px 14px;text-align:right;"><span class="badge" style="background:#dcfce7;color:#166534;">Approved</span></td>
              <td style="padding:10px 14px;text-align:right;"><button class="b b-out" style="font-size:11px;">View</button></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Upcoming Jobs -->
      <div class="card" style="overflow:hidden;">
        <div style="padding:10px 14px;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;">
          <span style="font-weight:600;">Upcoming Appointments</span>
          <button class="b-ghost" style="font-size:11px;">View All</button>
        </div>
        <table style="width:100%;border-collapse:collapse;">
          <tbody>
            <tr style="border-bottom:1px solid #f1f5f9;">
              <td style="padding:10px 14px;">
                <div style="font-weight:600;">Weekly Cleaning</div>
                <div style="font-size:11px;color:#64748b;">Mon, Feb 17 at 9:00 AM</div>
              </td>
              <td style="padding:10px 14px;text-align:right;"><span class="badge" style="background:#f3e8ff;color:#7c3aed;">Recurring</span></td>
              <td style="padding:10px 14px;text-align:right;font-size:12px;color:#64748b;">Sarah's Team</td>
            </tr>
            <tr style="border-bottom:1px solid #f1f5f9;">
              <td style="padding:10px 14px;">
                <div style="font-weight:600;">Local Move</div>
                <div style="font-size:11px;color:#64748b;">Thu, Feb 27 at 8:00 AM</div>
              </td>
              <td style="padding:10px 14px;text-align:right;"><span class="badge" style="background:#dbeafe;color:#1e40af;">Scheduled</span></td>
              <td style="padding:10px 14px;text-align:right;font-size:12px;color:#64748b;">Crew A</td>
            </tr>
            <tr>
              <td style="padding:10px 14px;">
                <div style="font-weight:600;">Pest Spray</div>
                <div style="font-size:11px;color:#64748b;">Wed, Mar 5 at 10:00 AM</div>
              </td>
              <td style="padding:10px 14px;text-align:right;"><span class="badge" style="background:#dbeafe;color:#1e40af;">Scheduled</span></td>
              <td style="padding:10px 14px;text-align:right;font-size:12px;color:#64748b;">Alex P.</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Payment Summary -->
      <div class="card" style="overflow:hidden;">
        <div style="padding:10px 14px;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;">
          <span style="font-weight:600;">Billing</span>
          <button class="b-ghost" style="font-size:11px;">Payment Methods</button>
        </div>
        <div style="padding:14px;display:grid;grid-template-columns:repeat(3,1fr);gap:10px;text-align:center;" class="grid-3">
          <div>
            <div style="font-size:11px;color:#64748b;">Total Spent</div>
            <div style="font-size:20px;font-weight:700;">$1,050</div>
          </div>
          <div>
            <div style="font-size:11px;color:#64748b;">Outstanding</div>
            <div style="font-size:20px;font-weight:700;color:#dc2626;">$325</div>
          </div>
          <div>
            <div style="font-size:11px;color:#64748b;">Card on File</div>
            <div style="font-size:13px;font-weight:600;margin-top:4px;">Visa ****4242</div>
          </div>
        </div>
      </div>

      <!-- Contracts -->
      <div class="card" style="overflow:hidden;">
        <div style="padding:10px 14px;border-bottom:1px solid #e2e8f0;"><span style="font-weight:600;">Contracts</span></div>
        <div style="padding:10px 14px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #f1f5f9;">
          <div>
            <div style="font-weight:500;">Hourly Moving Contract</div>
            <div style="font-size:11px;color:#64748b;">For Job EST-001-1 &bull; Sent Jan 16</div>
          </div>
          <div style="display:flex;align-items:center;gap:8px;">
            <span class="badge" style="background:#fef3c7;color:#92400e;">Awaiting Signature</span>
            <button class="b b-green" style="font-size:11px;">Sign Now</button>
          </div>
        </div>
        <div style="padding:10px 14px;display:flex;align-items:center;justify-content:space-between;">
          <div>
            <div style="font-weight:500;">Recurring Service Agreement</div>
            <div style="font-size:11px;color:#64748b;">Weekly Cleaning &bull; Signed Jan 20</div>
          </div>
          <div style="display:flex;align-items:center;gap:8px;">
            <span class="badge" style="background:#dcfce7;color:#166534;">Signed</span>
            <button class="b b-out" style="font-size:11px;">View</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div style="border:2px dashed #8b5cf6;background:#f5f3ff;border-radius:8px;padding:10px;text-align:center;margin-top:14px;">
    <b>Page 10: Customer Portal</b> — Unified view where customers see everything: pending estimates to approve, upcoming jobs, invoices to pay, contracts to sign, payment history. Lives at a public URL (portal.yourcompany.com/[token] or with login). Aggregates all existing public pages into one place.
  </div>
</div>

<!-- ================================================================ -->
<!-- THINGS NEEDED                                                      -->
<!-- ================================================================ -->
<div class="view fade" id="v-needed">
  <div style="text-align:center;margin-bottom:20px;">
    <div style="font-size:18px;font-weight:700;">Things Needed</div>
    <div style="color:#64748b;">Features to add — mapped to where they go in the system</div>
  </div>

  <div style="display:flex;flex-direction:column;gap:16px;max-width:900px;margin:0 auto;">

    <!-- 1. Auto-Fees -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#1e293b;color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;">
        <span style="font-weight:700;">1. Auto-Fees (Supply Fee, Trip Fee)</span>
        <span class="badge" style="background:#fef3c7;color:#92400e;">Settings + Estimate + Job</span>
      </div>
      <div style="padding:16px;">
        <div style="margin-bottom:12px;color:#64748b;font-size:12px;">Company-defined percentage or fixed fees. Two-level control: settings enables it globally, estimate/job toggles it per quote.</div>

        <!-- Where it goes -->
        <div style="font-weight:600;font-size:12px;margin-bottom:8px;color:#64748b;text-transform:uppercase;">Where It Goes</div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:14px;">
          <div style="border:2px solid #f59e0b;border-radius:8px;padding:10px;background:#fffbeb;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">Settings Page</div>
            <div style="font-size:11px;color:#64748b;">/settings/estimate-builder</div>
            <div style="margin-top:8px;border:1px solid #e2e8f0;border-radius:6px;padding:8px;background:white;">
              <div class="st"><span style="font-size:12px;">Supply Fee (10%)</span><div class="sw on"></div></div>
              <div class="st"><span style="font-size:12px;">Trip Fee ($125)</span><div class="sw"></div></div>
              <div class="st"><span style="font-size:12px;">CC Processing (2.9%)</span><div class="sw on"></div></div>
              <div style="font-size:10px;color:#64748b;padding:4px 10px;">&#8593; Applied at payment time, not on estimate</div>
            </div>
          </div>
          <div style="border:2px solid #3b82f6;border-radius:8px;padding:10px;background:#eff6ff;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">Estimate Detail</div>
            <div style="font-size:11px;color:#64748b;">Right column &rarr; Pricing Card</div>
            <div style="margin-top:8px;border:1px solid #e2e8f0;border-radius:6px;padding:8px;background:white;">
              <div class="pr"><span style="font-size:12px;">Services</span><span style="font-size:12px;">$300</span></div>
              <div class="pr"><span style="font-size:12px;color:#f59e0b;">&#9745; Supply Fee (10%)</span><span style="font-size:12px;">$30</span></div>
              <div class="pr"><span style="font-size:12px;color:#94a3b8;">&#9744; Trip Fee</span><span style="font-size:12px;color:#94a3b8;">OFF</span></div>
              <div style="border-top:1px solid #e2e8f0;margin:4px 0;"></div>
              <div class="pr"><span style="font-size:12px;font-weight:700;">Total</span><span style="font-size:12px;font-weight:700;">$330</span></div>
            </div>
          </div>
          <div style="border:2px solid #16a34a;border-radius:8px;padding:10px;background:#f0fdf4;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">Job Detail</div>
            <div style="font-size:11px;color:#64748b;">Right column &rarr; Financial Card</div>
            <div style="margin-top:8px;border:1px solid #e2e8f0;border-radius:6px;padding:8px;background:white;">
              <div class="pr"><span style="font-size:12px;">Services</span><span style="font-size:12px;">$300</span></div>
              <div class="pr"><span style="font-size:12px;color:#f59e0b;">&#9745; Supply Fee (10%)</span><span style="font-size:12px;">$30</span></div>
              <div style="border-top:1px solid #e2e8f0;margin:4px 0;"></div>
              <div class="pr"><span style="font-size:12px;font-weight:700;">Total</span><span style="font-size:12px;font-weight:700;">$330</span></div>
            </div>
          </div>
        </div>

        <div style="background:#f8fafc;border-radius:6px;padding:8px 12px;font-size:11px;color:#64748b;">
          <b>Hourly jobs:</b> Show "10%" label only (total unknown until job complete). Once hours logged, calculate actual amount.
          <br><b>CC fee:</b> NOT on estimates/jobs. Auto-added in the <b>payment slide panel</b> when customer pays by card. Settings toggle enables it.
        </div>
      </div>
    </div>

    <!-- 2. Line Items on Jobs -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#1e293b;color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;">
        <span style="font-weight:700;">2. Line Items on Jobs</span>
        <span class="badge" style="background:#dcfce7;color:#166534;">Job Detail</span>
      </div>
      <div style="padding:16px;">
        <div style="margin-bottom:12px;color:#64748b;font-size:12px;">Jobs need the same ServicePicker / MaterialsPicker that estimates have. Quick-booked jobs need full entry. Jobs from estimates can add more services.</div>

        <div style="font-weight:600;font-size:12px;margin-bottom:8px;color:#64748b;text-transform:uppercase;">Where It Goes</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
          <div style="border:2px solid #3b82f6;border-radius:8px;padding:10px;background:#eff6ff;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">Job from Estimate (Page 5)</div>
            <div style="font-size:11px;color:#64748b;">Center column &rarr; Line Items card</div>
            <div style="margin-top:8px;border:1px solid #e2e8f0;border-radius:6px;padding:8px;background:white;">
              <div class="pr"><span style="font-size:12px;">Moving Services</span><span style="font-size:12px;">$300</span></div>
              <div class="pr"><span style="font-size:12px;">Trip Fee</span><span style="font-size:12px;">$125</span></div>
              <div style="border-top:1px dashed #e2e8f0;margin:6px 0;"></div>
              <div style="text-align:center;"><button class="b-ghost" style="font-size:11px;color:#2563eb;">+ Add Service &nbsp; + Add Material &nbsp; + Custom</button></div>
            </div>
          </div>
          <div style="border:2px solid #f59e0b;border-radius:8px;padding:10px;background:#fffbeb;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">Quick-Booked Job (Page 6)</div>
            <div style="font-size:11px;color:#64748b;">Center column &rarr; Service &amp; Pricing card</div>
            <div style="margin-top:8px;border:1px solid #e2e8f0;border-radius:6px;padding:8px;background:white;">
              <div class="pr"><span style="font-size:12px;">Pest Spray</span><span style="font-size:12px;">$75</span></div>
              <div style="border-top:1px dashed #e2e8f0;margin:6px 0;"></div>
              <div style="text-align:center;"><button class="b-ghost" style="font-size:11px;color:#2563eb;">+ Add Service &nbsp; + Add Material &nbsp; + Custom</button></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 3. Map on Addresses -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#1e293b;color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;">
        <span style="font-weight:700;">3. Map on Addresses</span>
        <span class="badge" style="background:#dbeafe;color:#1e40af;">Estimate + Job Detail</span>
      </div>
      <div style="padding:16px;">
        <div style="margin-bottom:12px;color:#64748b;font-size:12px;">Clickable map on the Stops/Addresses card. Shows single pin or route with distance depending on addresses.</div>

        <div style="font-weight:600;font-size:12px;margin-bottom:8px;color:#64748b;text-transform:uppercase;">Where It Goes</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
          <div style="border:2px solid #3b82f6;border-radius:8px;padding:10px;background:#eff6ff;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">Single Address (Pest, HVAC, Cleaning)</div>
            <div style="margin-top:8px;border:1px solid #e2e8f0;border-radius:8px;overflow:hidden;background:white;">
              <div style="background:#e2e8f0;height:80px;display:flex;align-items:center;justify-content:center;color:#94a3b8;font-size:11px;">
                <div style="text-align:center;">
                  <div style="font-size:20px;">&#128205;</div>
                  <div>Map — 1 pin</div>
                </div>
              </div>
              <div style="padding:8px;font-size:11px;"><span class="dot" style="background:#3b82f6;display:inline-block;"></span> 4521 E Main St, Phoenix AZ</div>
            </div>
          </div>
          <div style="border:2px solid #16a34a;border-radius:8px;padding:10px;background:#f0fdf4;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">To &amp; From (Moving, Delivery)</div>
            <div style="margin-top:8px;border:1px solid #e2e8f0;border-radius:8px;overflow:hidden;background:white;">
              <div style="background:#e2e8f0;height:80px;display:flex;align-items:center;justify-content:center;color:#94a3b8;font-size:11px;">
                <div style="text-align:center;">
                  <div style="font-size:16px;">&#128205; &mdash;&mdash;&mdash; &#128205;</div>
                  <div>Map — route + distance</div>
                </div>
              </div>
              <div style="padding:8px;font-size:11px;">
                <div><span class="dot" style="background:#3b82f6;display:inline-block;"></span> Phoenix 85015 &rarr; <span class="dot" style="background:#16a34a;display:inline-block;"></span> Phoenix 85041</div>
                <div style="color:#2563eb;font-weight:600;margin-top:2px;">12.4 mi &bull; 18 min drive</div>
              </div>
            </div>
          </div>
        </div>
        <div style="background:#f8fafc;border-radius:6px;padding:8px 12px;font-size:11px;color:#64748b;margin-top:10px;">
          Shows on: <b>Estimate Detail</b> (center column, Stops card) and <b>Job Detail</b> (center column, Addresses card). "Navigate" link opens Google Maps.
        </div>
      </div>
    </div>

    <!-- 4. Hourly Rate Display -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#1e293b;color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;">
        <span style="font-weight:700;">4. Hourly Rate Display Options</span>
        <span class="badge" style="background:#f3e8ff;color:#7c3aed;">Estimate Detail + Customer Page</span>
      </div>
      <div style="padding:16px;">
        <div style="margin-bottom:12px;color:#64748b;font-size:12px;">For hourly pricing, control what the customer sees. Some businesses show only the rate, others show an estimated range.</div>

        <div style="font-weight:600;font-size:12px;margin-bottom:8px;color:#64748b;text-transform:uppercase;">Where It Goes</div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;">
          <div style="border:1px solid #e2e8f0;border-radius:8px;padding:10px;">
            <div style="font-weight:600;font-size:11px;margin-bottom:6px;color:#7c3aed;">Option A: Rate Only</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;padding:10px;background:white;">
              <div style="font-size:24px;font-weight:700;text-align:center;">$150<span style="font-size:13px;color:#64748b;">/hr</span></div>
              <div style="text-align:center;font-size:11px;color:#64748b;">Hourly Rate</div>
            </div>
            <div style="font-size:10px;color:#64748b;margin-top:4px;">No hours shown. No total.</div>
          </div>
          <div style="border:2px solid #7c3aed;border-radius:8px;padding:10px;background:#faf5ff;">
            <div style="font-weight:600;font-size:11px;margin-bottom:6px;color:#7c3aed;">Option B: Rate + Range</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;padding:10px;background:white;">
              <div style="font-size:24px;font-weight:700;text-align:center;">$150<span style="font-size:13px;color:#64748b;">/hr</span></div>
              <div style="text-align:center;font-size:11px;color:#64748b;">Est. 6-8 hours</div>
              <div style="text-align:center;font-size:12px;color:#2563eb;font-weight:600;">$900 — $1,200</div>
            </div>
            <div style="font-size:10px;color:#64748b;margin-top:4px;">Shows estimated range.</div>
          </div>
          <div style="border:1px solid #e2e8f0;border-radius:8px;padding:10px;">
            <div style="font-weight:600;font-size:11px;margin-bottom:6px;color:#7c3aed;">Option C: Fixed Total</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;padding:10px;background:white;">
              <div style="font-size:24px;font-weight:700;text-align:center;">$425</div>
              <div style="text-align:center;font-size:11px;color:#64748b;">Flat Rate</div>
            </div>
            <div style="font-size:10px;color:#64748b;margin-top:4px;">Flat/per-service pricing.</div>
          </div>
        </div>
        <div style="background:#f8fafc;border-radius:6px;padding:8px 12px;font-size:11px;color:#64748b;margin-top:10px;">
          Shows on: <b>Estimate Detail</b> (right column, Pricing Card total-bar) and <b>Customer Page</b> (pricing section). Toggle per estimate: "Show estimated hours" ON/OFF.
        </div>
      </div>
    </div>

    <!-- 5. Payments -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#1e293b;color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;">
        <span style="font-weight:700;">5. Payments (Build from Mockup)</span>
        <span class="badge" style="background:#dcfce7;color:#166534;">Mockup Done</span>
      </div>
      <div style="padding:16px;">
        <div style="margin-bottom:12px;color:#64748b;font-size:12px;">Slide panel from right side. Already mocked up in this prototype. Needs actual code implementation.</div>

        <div style="font-weight:600;font-size:12px;margin-bottom:8px;color:#64748b;text-transform:uppercase;">Where It Goes</div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;">
          <div style="border:1px solid #e2e8f0;border-radius:8px;padding:10px;text-align:center;">
            <div style="font-size:20px;margin-bottom:4px;">&#128179;</div>
            <div style="font-weight:600;font-size:11px;">Estimate Detail</div>
            <div style="font-size:10px;color:#64748b;">Header icon + Pricing card link</div>
          </div>
          <div style="border:1px solid #e2e8f0;border-radius:8px;padding:10px;text-align:center;">
            <div style="font-size:20px;margin-bottom:4px;">&#128179;</div>
            <div style="font-weight:600;font-size:11px;">Job Detail</div>
            <div style="font-size:10px;color:#64748b;">Header icon + Financial card button</div>
          </div>
          <div style="border:1px solid #e2e8f0;border-radius:8px;padding:10px;text-align:center;">
            <div style="font-size:20px;margin-bottom:4px;">&#128241;</div>
            <div style="font-weight:600;font-size:11px;">Tech Portal</div>
            <div style="font-size:10px;color:#64748b;">Step-by-step flow (separate)</div>
          </div>
        </div>
        <div style="background:#f8fafc;border-radius:6px;padding:8px 12px;font-size:11px;color:#64748b;margin-top:10px;">
          Panel shows: balance due, existing payments, collect via card/cash/check, send payment link. CC processing fee auto-added when card selected.
        </div>
      </div>
    </div>

    <!-- 6. Job Photos -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#1e293b;color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;">
        <span style="font-weight:700;">6. Job Photos</span>
        <span class="badge" style="background:#dcfce7;color:#166534;">Job Detail</span>
      </div>
      <div style="padding:16px;">
        <div style="margin-bottom:12px;color:#64748b;font-size:12px;">Photos directly on the job detail page. Before/after photos, site conditions, completed work. Currently only reachable through customer &rarr; jobs tab — needs to be on the job itself.</div>

        <div style="font-weight:600;font-size:12px;margin-bottom:8px;color:#64748b;text-transform:uppercase;">Where It Goes</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
          <div style="border:2px solid #3b82f6;border-radius:8px;padding:10px;background:#eff6ff;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">Job Detail — Center Column</div>
            <div style="font-size:11px;color:#64748b;">Below Notes card or as a tab</div>
            <div style="margin-top:8px;border:1px solid #e2e8f0;border-radius:6px;padding:8px;background:white;">
              <div style="display:flex;justify-content:space-between;margin-bottom:6px;"><span style="font-weight:600;font-size:12px;">Photos</span><span style="font-size:11px;color:#2563eb;">+ Upload</span></div>
              <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:4px;">
                <div style="background:#e2e8f0;border-radius:4px;height:40px;display:flex;align-items:center;justify-content:center;font-size:9px;color:#94a3b8;">Before</div>
                <div style="background:#e2e8f0;border-radius:4px;height:40px;display:flex;align-items:center;justify-content:center;font-size:9px;color:#94a3b8;">During</div>
                <div style="background:#e2e8f0;border-radius:4px;height:40px;display:flex;align-items:center;justify-content:center;font-size:9px;color:#94a3b8;">After</div>
              </div>
              <div style="font-size:10px;color:#64748b;margin-top:4px;">3 photos &bull; Uploaded by Mike T.</div>
            </div>
          </div>
          <div style="border:2px solid #f59e0b;border-radius:8px;padding:10px;background:#fffbeb;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">Tech Portal — Job View</div>
            <div style="font-size:11px;color:#64748b;">Techs upload from phone on-site</div>
            <div style="margin-top:8px;border:1px solid #e2e8f0;border-radius:6px;padding:8px;background:white;">
              <div style="display:flex;flex-direction:column;gap:6px;align-items:center;">
                <div style="width:100%;background:#e2e8f0;border-radius:4px;height:50px;display:flex;align-items:center;justify-content:center;font-size:18px;">&#128247;</div>
                <button class="b b-blue" style="width:100%;justify-content:center;font-size:11px;">Take Photo</button>
                <div style="font-size:10px;color:#64748b;">Camera or gallery upload</div>
              </div>
            </div>
          </div>
        </div>
        <div style="background:#f8fafc;border-radius:6px;padding:8px 12px;font-size:11px;color:#64748b;margin-top:10px;">
          <b>Already built:</b> JobPhotosSection component + useJobFiles hook exist. Need to surface them on job detail page and ensure tech portal upload works.
        </div>
      </div>
    </div>

    <!-- 7. Customizable Dropdowns -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#1e293b;color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;">
        <span style="font-weight:700;">7. Customizable Dropdowns</span>
        <span class="badge" style="background:#dcfce7;color:#166534;">Settings &rarr; All Views</span>
      </div>
      <div style="padding:16px;">
        <div style="margin-bottom:12px;color:#64748b;font-size:12px;">Companies define their own options for service types, sources, and lead statuses. Currently hardcoded arrays in the code — need to pull from company settings instead.</div>

        <div style="font-weight:600;font-size:12px;margin-bottom:8px;color:#64748b;text-transform:uppercase;">Where It Goes</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px;">
          <div style="border:2px solid #f59e0b;border-radius:8px;padding:10px;background:#fffbeb;">
            <div style="font-weight:600;font-size:11px;margin-bottom:6px;">Settings Page</div>
            <div style="font-size:11px;color:#64748b;margin-bottom:6px;">/settings/customize</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;background:white;overflow:hidden;">
              <div style="background:#f8fafc;padding:6px 10px;font-weight:600;font-size:11px;border-bottom:1px solid #e2e8f0;">Service Types</div>
              <div style="padding:6px 10px;font-size:12px;display:flex;justify-content:space-between;border-bottom:1px solid #f1f5f9;"><span>Interior Treatment</span><span style="color:#dc2626;cursor:pointer;font-size:10px;">&times;</span></div>
              <div style="padding:6px 10px;font-size:12px;display:flex;justify-content:space-between;border-bottom:1px solid #f1f5f9;"><span>Exterior Spray</span><span style="color:#dc2626;cursor:pointer;font-size:10px;">&times;</span></div>
              <div style="padding:6px 10px;font-size:12px;display:flex;justify-content:space-between;border-bottom:1px solid #f1f5f9;"><span>Termite Inspection</span><span style="color:#dc2626;cursor:pointer;font-size:10px;">&times;</span></div>
              <div style="padding:6px 10px;"><input type="text" placeholder="+ Add new type..." style="border:none;font-size:12px;color:#2563eb;width:100%;outline:none;"></div>
            </div>
          </div>
          <div style="border:2px solid #3b82f6;border-radius:8px;padding:10px;background:#eff6ff;">
            <div style="font-weight:600;font-size:11px;margin-bottom:6px;">Estimate / Job Dropdowns</div>
            <div style="font-size:11px;color:#64748b;margin-bottom:6px;">Reads from company settings</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;background:white;padding:8px;">
              <div class="fi"><span class="fi-l" style="font-size:12px;">Type</span><select style="border:none;color:#2563eb;font-weight:500;font-size:12px;"><option>Interior Treatment</option><option>Exterior Spray</option><option>Termite Inspection</option></select></div>
              <div class="fi"><span class="fi-l" style="font-size:12px;">Source</span><select style="border:none;color:#2563eb;font-weight:500;font-size:12px;"><option>Google Ads</option><option>Referral</option><option>Yelp</option></select></div>
              <div class="fi"><span class="fi-l" style="font-size:12px;">Lead Status</span><select style="border:none;color:#2563eb;font-weight:500;font-size:12px;"><option>New</option><option>Inspection Set</option><option>Quote Sent</option></select></div>
            </div>
          </div>
        </div>

        <div style="font-weight:600;font-size:12px;margin-bottom:6px;color:#64748b;text-transform:uppercase;">3 Lists to Customize</div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;">
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;text-align:center;">
            <div style="font-weight:600;font-size:11px;">Service Types</div>
            <div style="font-size:10px;color:#64748b;">What kind of work</div>
            <div style="font-size:10px;color:#94a3b8;margin-top:2px;">Currently: Local, Long Distance, Commercial...</div>
          </div>
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;text-align:center;">
            <div style="font-weight:600;font-size:11px;">Sources</div>
            <div style="font-size:10px;color:#64748b;">Where leads come from</div>
            <div style="font-size:10px;color:#94a3b8;margin-top:2px;">Currently: Referral, Google Ads, Phone...</div>
          </div>
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;text-align:center;">
            <div style="font-weight:600;font-size:11px;">Lead Statuses</div>
            <div style="font-size:10px;color:#64748b;">Sales pipeline stages</div>
            <div style="font-size:10px;color:#94a3b8;margin-top:2px;">Currently: New, Contacted, Qualified...</div>
          </div>
        </div>

        <div style="background:#f8fafc;border-radius:6px;padding:8px 12px;font-size:11px;color:#64748b;margin-top:10px;">
          <b>Small change:</b> DB already stores these as plain text — accepts any value. Just need a settings UI + swap the hardcoded arrays in QuoteInfoCard.tsx to read from company settings.
        </div>
      </div>
    </div>

    <!-- 8. Contract Auto-Attachment -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#1e293b;color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;">
        <span style="font-weight:700;">8. Contract Auto-Attachment</span>
        <span class="badge" style="background:#fef3c7;color:#92400e;">Settings + Estimate + Job</span>
      </div>
      <div style="padding:16px;">
        <div style="margin-bottom:12px;color:#64748b;font-size:12px;">Company defines standard contracts in settings. Contracts auto-attach to new estimates/jobs based on rules, or get added manually per job. Admin can remove any that don't apply.</div>

        <div style="font-weight:600;font-size:12px;margin-bottom:8px;color:#64748b;text-transform:uppercase;">Where It Goes</div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:14px;">
          <!-- Settings -->
          <div style="border:2px solid #f59e0b;border-radius:8px;padding:10px;background:#fffbeb;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">Settings — Contract Templates</div>
            <div style="font-size:11px;color:#64748b;margin-bottom:6px;">/settings/contracts</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;background:white;overflow:hidden;">
              <div style="padding:8px 10px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;align-items:center;">
                <div>
                  <div style="font-weight:600;font-size:11px;">Hourly Agreement</div>
                  <div style="font-size:10px;color:#64748b;">For hourly pricing jobs</div>
                </div>
                <div style="display:flex;align-items:center;gap:4px;">
                  <span style="font-size:9px;color:#92400e;font-weight:600;">AUTO</span>
                  <div class="sw on" style="width:28px;height:16px;"></div>
                </div>
              </div>
              <div style="padding:8px 10px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;align-items:center;">
                <div>
                  <div style="font-weight:600;font-size:11px;">Flat Rate Terms</div>
                  <div style="font-size:10px;color:#64748b;">For flat rate jobs</div>
                </div>
                <div style="display:flex;align-items:center;gap:4px;">
                  <span style="font-size:9px;color:#92400e;font-weight:600;">AUTO</span>
                  <div class="sw on" style="width:28px;height:16px;"></div>
                </div>
              </div>
              <div style="padding:8px 10px;display:flex;justify-content:space-between;align-items:center;">
                <div>
                  <div style="font-weight:600;font-size:11px;">Liability Waiver</div>
                  <div style="font-size:10px;color:#64748b;">Optional — add manually</div>
                </div>
                <div style="display:flex;align-items:center;gap:4px;">
                  <span style="font-size:9px;color:#94a3b8;">MANUAL</span>
                  <div class="sw" style="width:28px;height:16px;"></div>
                </div>
              </div>
            </div>
          </div>
          <!-- Estimate -->
          <div style="border:2px solid #3b82f6;border-radius:8px;padding:10px;background:#eff6ff;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">Estimate Detail</div>
            <div style="font-size:11px;color:#64748b;margin-bottom:6px;">Auto-attached based on pricing model</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;background:white;padding:8px;">
              <div style="font-weight:600;font-size:11px;margin-bottom:6px;">Contracts</div>
              <div style="border:1px solid #e2e8f0;border-radius:4px;padding:6px;margin-bottom:4px;display:flex;justify-content:space-between;align-items:center;">
                <div><div style="font-size:11px;font-weight:500;">Hourly Agreement</div><div style="font-size:10px;color:#64748b;">Auto-attached</div></div>
                <span style="color:#dc2626;cursor:pointer;font-size:10px;">&times;</span>
              </div>
              <div style="text-align:center;border:1px dashed #e2e8f0;border-radius:4px;padding:6px;">
                <span style="font-size:11px;color:#2563eb;">+ Add Contract</span>
              </div>
            </div>
          </div>
          <!-- Job -->
          <div style="border:2px solid #16a34a;border-radius:8px;padding:10px;background:#f0fdf4;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">Job Detail</div>
            <div style="font-size:11px;color:#64748b;margin-bottom:6px;">Inherits from estimate or auto-attaches</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;background:white;padding:8px;">
              <div style="display:flex;justify-content:space-between;margin-bottom:6px;"><span style="font-weight:600;font-size:11px;">Contracts</span><span style="font-size:11px;color:#2563eb;">+ Add</span></div>
              <div style="border:1px solid #e2e8f0;border-radius:4px;padding:6px;margin-bottom:4px;display:flex;justify-content:space-between;align-items:center;">
                <div style="display:flex;align-items:center;gap:4px;"><div style="font-size:11px;font-weight:500;">Hourly Agreement</div><span class="badge" style="background:#fef3c7;color:#92400e;font-size:9px;">Sent</span></div>
                <span style="color:#dc2626;cursor:pointer;font-size:10px;">&times;</span>
              </div>
              <div style="border:1px solid #e2e8f0;border-radius:4px;padding:6px;display:flex;justify-content:space-between;align-items:center;">
                <div style="display:flex;align-items:center;gap:4px;"><div style="font-size:11px;font-weight:500;">Liability Waiver</div><span class="badge" style="background:#f1f5f9;color:#64748b;font-size:9px;">Draft</span></div>
                <span style="color:#dc2626;cursor:pointer;font-size:10px;">&times;</span>
              </div>
            </div>
          </div>
        </div>

        <div style="font-weight:600;font-size:12px;margin-bottom:6px;color:#64748b;text-transform:uppercase;">How It Works</div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;">
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;">
            <div style="font-weight:600;font-size:11px;color:#f59e0b;">1. Settings</div>
            <div style="font-size:10px;color:#64748b;">Define contract templates. Toggle AUTO on/off. Optionally tie to pricing model (hourly / flat).</div>
          </div>
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;">
            <div style="font-weight:600;font-size:11px;color:#3b82f6;">2. New Estimate / Job</div>
            <div style="font-size:10px;color:#64748b;">AUTO contracts appear automatically. Admin can remove any that don't apply. Can add manual contracts too.</div>
          </div>
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;">
            <div style="font-weight:600;font-size:11px;color:#16a34a;">3. Send &amp; Sign</div>
            <div style="font-size:10px;color:#64748b;">Contracts sent with estimate/job. Customer signs. Status updates: Draft &rarr; Sent &rarr; Signed.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- 9. Customer Portal -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#1e293b;color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;">
        <span style="font-weight:700;">9. Resource Labels &amp; Terminology</span>
        <span class="badge" style="background:#dbeafe;color:#1e40af;">Settings</span>
      </div>
      <div style="padding:16px;">
        <div style="margin-bottom:12px;color:#64748b;font-size:12px;">Let companies rename labels and terminology so the platform feels like theirs, not a moving company tool.</div>

        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;">
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:10px;">
            <div style="font-weight:600;font-size:11px;margin-bottom:6px;">Resource Labels</div>
            <div style="font-size:10px;color:#64748b;margin-bottom:6px;">Rename or hide resource tiles</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;background:white;overflow:hidden;">
              <div style="padding:5px 8px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;font-size:11px;"><span>Trucks</span><input style="border:none;width:60px;text-align:right;font-size:11px;color:#2563eb;" value="Vehicles"></div>
              <div style="padding:5px 8px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;font-size:11px;"><span>Team</span><input style="border:none;width:60px;text-align:right;font-size:11px;color:#2563eb;" value="Techs"></div>
              <div style="padding:5px 8px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;font-size:11px;"><span>Hours</span><input style="border:none;width:60px;text-align:right;font-size:11px;color:#2563eb;" value="Hours"></div>
              <div style="padding:5px 8px;display:flex;justify-content:space-between;font-size:11px;"><span>Rate</span><input style="border:none;width:60px;text-align:right;font-size:11px;color:#2563eb;" value="Rate"></div>
            </div>
          </div>
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:10px;">
            <div style="font-weight:600;font-size:11px;margin-bottom:6px;">Terminology</div>
            <div style="font-size:10px;color:#64748b;margin-bottom:6px;">What do you call things?</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;background:white;overflow:hidden;">
              <div style="padding:5px 8px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;font-size:11px;"><span>Estimates</span><input style="border:none;width:60px;text-align:right;font-size:11px;color:#2563eb;" value="Quotes"></div>
              <div style="padding:5px 8px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;font-size:11px;"><span>Jobs</span><input style="border:none;width:60px;text-align:right;font-size:11px;color:#2563eb;" value="Work Orders"></div>
              <div style="padding:5px 8px;display:flex;justify-content:space-between;font-size:11px;"><span>Customers</span><input style="border:none;width:60px;text-align:right;font-size:11px;color:#2563eb;" value="Clients"></div>
            </div>
          </div>
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:10px;">
            <div style="font-weight:600;font-size:11px;margin-bottom:6px;">Number Formats</div>
            <div style="font-size:10px;color:#64748b;margin-bottom:6px;">Custom prefixes for IDs</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;background:white;overflow:hidden;">
              <div style="padding:5px 8px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;font-size:11px;"><span>Estimates</span><input style="border:none;width:80px;text-align:right;font-size:11px;color:#2563eb;" value="Q-2026-001"></div>
              <div style="padding:5px 8px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;font-size:11px;"><span>Jobs</span><input style="border:none;width:80px;text-align:right;font-size:11px;color:#2563eb;" value="WO-001"></div>
              <div style="padding:5px 8px;display:flex;justify-content:space-between;font-size:11px;"><span>Invoices</span><input style="border:none;width:80px;text-align:right;font-size:11px;color:#2563eb;" value="INV-001"></div>
            </div>
          </div>
        </div>

        <div style="background:#f8fafc;border-radius:6px;padding:8px 12px;font-size:11px;color:#64748b;margin-top:10px;">
          All stored in company settings JSONB. Resource label toggles partially exist in estimate settings already. Terminology and number formats are new.
        </div>
      </div>
    </div>

    <!-- 10. Documents Panel -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#1e293b;color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;">
        <span style="font-weight:700;">10. Documents Panel</span>
        <span class="badge" style="background:#dbeafe;color:#1e40af;">Estimate + Job Detail</span>
      </div>
      <div style="padding:16px;">
        <div style="margin-bottom:12px;color:#64748b;font-size:12px;">Slide panel from right side showing all contracts, estimates, invoices, and work orders associated with the estimate/job. Grouped by estimate and job.</div>

        <div style="font-weight:600;font-size:12px;margin-bottom:8px;color:#64748b;text-transform:uppercase;">Where It Goes</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
          <div style="border:2px solid #3b82f6;border-radius:8px;padding:10px;background:#eff6ff;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">Header Icon Button</div>
            <div style="font-size:11px;color:#64748b;margin-bottom:6px;">Estimate + Job detail headers</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;background:white;padding:8px;display:flex;align-items:center;gap:6px;">
              <div class="ico" style="cursor:default;">&#128196;</div>
              <span style="font-size:11px;">Click to open Documents panel</span>
            </div>
          </div>
          <div style="border:2px solid #1e293b;border-radius:8px;padding:10px;background:#f8fafc;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">Slide Panel Content</div>
            <div style="font-size:11px;color:#64748b;margin-bottom:6px;">Lists all documents by section</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;background:white;overflow:hidden;">
              <div style="padding:6px 10px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;font-size:11px;"><span style="font-weight:500;">Flat Rate Contract</span><span class="badge" style="background:#dcfce7;color:#166534;font-size:9px;">Signed</span></div>
              <div style="padding:6px 10px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;font-size:11px;"><span style="font-weight:500;">Estimate</span><span class="badge" style="background:#dcfce7;color:#166534;font-size:9px;">Sent</span></div>
              <div style="padding:6px 10px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;font-size:11px;"><span style="font-weight:500;">Invoice #INV-047</span><span class="badge" style="background:#fef3c7;color:#92400e;font-size:9px;">Unpaid</span></div>
              <div style="padding:6px 10px;display:flex;justify-content:space-between;font-size:11px;"><span style="font-weight:500;">Work Order</span><span class="badge" style="background:#f1f5f9;color:#64748b;font-size:9px;">Draft</span></div>
            </div>
          </div>
        </div>

        <div style="background:#f8fafc;border-radius:6px;padding:8px 12px;font-size:11px;color:#64748b;margin-top:10px;">
          <b>Mockup done</b> — slide panel already wired in this prototype. Needs: API to fetch documents by estimate/job, generate document functionality, status tracking (Draft/Sent/Signed/Paid).
        </div>
      </div>
    </div>

    <!-- 11. Activity Panel -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#1e293b;color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;">
        <span style="font-weight:700;">11. Activity Panel</span>
        <span class="badge" style="background:#dbeafe;color:#1e40af;">Estimate + Job Detail</span>
      </div>
      <div style="padding:16px;">
        <div style="margin-bottom:12px;color:#64748b;font-size:12px;">Slide panel showing timestamped log of every change to the estimate/job. Who did what and when — full audit trail.</div>

        <div style="font-weight:600;font-size:12px;margin-bottom:8px;color:#64748b;text-transform:uppercase;">What Gets Logged</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px;">
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:10px;">
            <div style="font-weight:600;font-size:11px;margin-bottom:6px;">Estimate Events</div>
            <div style="font-size:10px;color:#64748b;line-height:1.6;">
              &#10024; Estimate created<br>
              &#128736; Pricing / details changed<br>
              &#128232; Sent to customer<br>
              &#9989; Approved by customer<br>
              &#10005; Marked as lost<br>
              &#128221; Contract attached / signed
            </div>
          </div>
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:10px;">
            <div style="font-weight:600;font-size:11px;margin-bottom:6px;">Job Events</div>
            <div style="font-size:10px;color:#64748b;line-height:1.6;">
              &#128197; Job scheduled / rescheduled<br>
              &#128101; Crew / tech assigned<br>
              &#128232; Dispatched to team<br>
              &#9654; Job started (in progress)<br>
              &#9989; Job completed<br>
              &#128179; Payment received
            </div>
          </div>
        </div>

        <div style="font-weight:600;font-size:12px;margin-bottom:8px;color:#64748b;text-transform:uppercase;">Sample Timeline</div>
        <div style="border:1px solid #e2e8f0;border-radius:8px;padding:10px;background:white;">
          <div style="display:flex;gap:8px;padding:4px 0;border-bottom:1px solid #f1f5f9;"><span style="font-size:11px;">&#128179;</span><div style="font-size:11px;"><b>Payment received</b> — $100 deposit<br><span style="color:#64748b;">Feb 27, 3:42 PM &bull; Stripe</span></div></div>
          <div style="display:flex;gap:8px;padding:4px 0;border-bottom:1px solid #f1f5f9;"><span style="font-size:11px;">&#128197;</span><div style="font-size:11px;"><b>Job scheduled</b> for Feb 27<br><span style="color:#64748b;">Jan 16, 11:20 AM &bull; Daniela M.</span></div></div>
          <div style="display:flex;gap:8px;padding:4px 0;border-bottom:1px solid #f1f5f9;"><span style="font-size:11px;">&#9989;</span><div style="font-size:11px;"><b>Estimate approved</b> by customer<br><span style="color:#64748b;">Jan 16, 10:05 AM &bull; John Smith</span></div></div>
          <div style="display:flex;gap:8px;padding:4px 0;"><span style="font-size:11px;">&#10024;</span><div style="font-size:11px;"><b>Estimate created</b><br><span style="color:#64748b;">Jan 15, 2:00 PM &bull; Daniela M.</span></div></div>
        </div>

        <div style="background:#f8fafc;border-radius:6px;padding:8px 12px;font-size:11px;color:#64748b;margin-top:10px;">
          <b>Mockup done</b> — slide panel already wired. Needs: activity_log DB table, automatic event recording on CRUD operations, user attribution.
        </div>
      </div>
    </div>

    <!-- 12. Book Dropdown & Job Actions -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#1e293b;color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;">
        <span style="font-weight:700;">12. Book Dropdown &amp; Job Actions</span>
        <span class="badge" style="background:#fef3c7;color:#92400e;">Estimate + Job Headers</span>
      </div>
      <div style="padding:16px;">
        <div style="margin-bottom:12px;color:#64748b;font-size:12px;">Replace single action buttons with contextual dropdowns. Estimate gets "Book" dropdown. Job detail gets action icons (Documents, Activity, Payments) — NO Dispatch button (dispatch happens on dispatch board only).</div>

        <div style="font-weight:600;font-size:12px;margin-bottom:8px;color:#64748b;text-transform:uppercase;">Book Dropdown (Estimate)</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px;">
          <div style="border:2px solid #16a34a;border-radius:8px;padding:10px;background:#f0fdf4;">
            <div style="font-weight:600;font-size:11px;margin-bottom:6px;">Dropdown Items</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;background:white;overflow:hidden;">
              <div style="padding:6px 10px;border-bottom:1px solid #f1f5f9;font-size:11px;">&#128065; Preview Estimate</div>
              <div style="padding:6px 10px;border-bottom:1px solid #f1f5f9;font-size:11px;">&#9993; Send Estimate</div>
              <div style="padding:6px 10px;border-bottom:1px solid #f1f5f9;font-size:11px;">&#128179; Take Payment</div>
              <div style="padding:6px 10px;border-bottom:1px solid #f1f5f9;font-size:11px;">&#128197; Book Job</div>
              <div style="padding:6px 10px;border-bottom:1px solid #f1f5f9;font-size:11px;color:#dc2626;">&#10005; Mark Lost</div>
              <div style="padding:6px 10px;font-size:11px;">&#128203; Duplicate</div>
            </div>
          </div>
          <div style="border:2px solid #3b82f6;border-radius:8px;padding:10px;background:#eff6ff;">
            <div style="font-weight:600;font-size:11px;margin-bottom:6px;">Job Header Actions</div>
            <div style="font-size:10px;color:#64748b;margin-bottom:6px;">Icon buttons replace single Dispatch</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;background:white;padding:8px;display:flex;gap:8px;align-items:center;justify-content:center;">
              <div style="border:1px solid #e2e8f0;border-radius:4px;padding:4px 6px;font-size:11px;">&#128196; Docs</div>
              <div style="border:1px solid #e2e8f0;border-radius:4px;padding:4px 6px;font-size:11px;">&#128337; Activity</div>
              <div style="border:1px solid #e2e8f0;border-radius:4px;padding:4px 6px;font-size:11px;">&#128179; Pay</div>
              <div style="border:1px solid #e2e8f0;border-radius:4px;padding:4px 6px;font-size:11px;">Edit</div>
              <div style="border:1px solid #3b82f6;border-radius:4px;padding:4px 6px;font-size:11px;color:#2563eb;font-weight:600;">Schedule</div>
            </div>
            <div style="font-size:10px;color:#dc2626;margin-top:6px;text-align:center;">&#9888; No "Dispatch" button — dispatch is on the dispatch board</div>
          </div>
        </div>

        <div style="background:#f8fafc;border-radius:6px;padding:8px 12px;font-size:11px;color:#64748b;">
          <b>Mockup done</b> — Book dropdown and job icon buttons already wired in this prototype. Schedule Job button replaces Dispatch. Dispatch only happens on dispatch board.
        </div>
      </div>
    </div>

    <!-- 13. Prepaid Packages -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#1e293b;color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;">
        <span style="font-weight:700;">13. Prepaid Packages</span>
        <span class="badge" style="background:#f3e8ff;color:#7c3aed;">Settings + Recurring Job</span>
      </div>
      <div style="padding:16px;">
        <div style="margin-bottom:12px;color:#64748b;font-size:12px;">Companies define package deals in settings. Customer purchases X visits upfront at a discount. Each completed visit auto-deducts from the package. Visual tracker shows remaining.</div>

        <div style="font-weight:600;font-size:12px;margin-bottom:8px;color:#64748b;text-transform:uppercase;">Where It Goes</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px;">
          <!-- Settings -->
          <div style="border:2px solid #f59e0b;border-radius:8px;padding:10px;background:#fffbeb;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">Settings — Package Deals</div>
            <div style="font-size:11px;color:#64748b;margin-bottom:6px;">/settings/packages</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;background:white;overflow:hidden;">
              <div style="padding:8px 10px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;align-items:center;">
                <div>
                  <div style="font-weight:600;font-size:11px;">10-Visit Cleaning</div>
                  <div style="font-size:10px;color:#64748b;">10 visits &bull; $1,400 (save 15%)</div>
                </div>
                <div class="sw on" style="width:28px;height:16px;"></div>
              </div>
              <div style="padding:8px 10px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;align-items:center;">
                <div>
                  <div style="font-weight:600;font-size:11px;">5-Visit Starter</div>
                  <div style="font-size:10px;color:#64748b;">5 visits &bull; $750 (save 10%)</div>
                </div>
                <div class="sw on" style="width:28px;height:16px;"></div>
              </div>
              <div style="padding:6px 10px;"><input type="text" placeholder="+ Add package..." style="border:none;font-size:11px;color:#2563eb;width:100%;outline:none;"></div>
            </div>
          </div>
          <!-- Recurring job -->
          <div style="border:2px solid #7c3aed;border-radius:8px;padding:10px;background:#f5f3ff;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">Recurring Job — Package Card</div>
            <div style="font-size:11px;color:#64748b;margin-bottom:6px;">Shows when billing = Prepaid</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;background:white;padding:8px;">
              <div style="display:flex;justify-content:space-between;font-size:11px;margin-bottom:4px;">
                <span style="font-weight:600;">8 of 10 used</span>
                <span style="color:#7c3aed;font-weight:600;">2 left</span>
              </div>
              <div style="background:#e2e8f0;border-radius:9999px;height:6px;overflow:hidden;margin-bottom:6px;">
                <div style="background:#7c3aed;height:100%;width:80%;border-radius:9999px;"></div>
              </div>
              <div style="display:flex;gap:3px;justify-content:center;">
                <div style="width:14px;height:14px;border-radius:50%;background:#7c3aed;font-size:7px;color:white;display:flex;align-items:center;justify-content:center;">&#10003;</div>
                <div style="width:14px;height:14px;border-radius:50%;background:#7c3aed;font-size:7px;color:white;display:flex;align-items:center;justify-content:center;">&#10003;</div>
                <div style="width:14px;height:14px;border-radius:50%;background:#7c3aed;font-size:7px;color:white;display:flex;align-items:center;justify-content:center;">&#10003;</div>
                <div style="width:14px;height:14px;border-radius:50%;background:#7c3aed;font-size:7px;color:white;display:flex;align-items:center;justify-content:center;">&#10003;</div>
                <div style="width:14px;height:14px;border-radius:50%;background:#7c3aed;font-size:7px;color:white;display:flex;align-items:center;justify-content:center;">&#10003;</div>
                <div style="width:14px;height:14px;border-radius:50%;background:#7c3aed;font-size:7px;color:white;display:flex;align-items:center;justify-content:center;">&#10003;</div>
                <div style="width:14px;height:14px;border-radius:50%;background:#7c3aed;font-size:7px;color:white;display:flex;align-items:center;justify-content:center;">&#10003;</div>
                <div style="width:14px;height:14px;border-radius:50%;background:#7c3aed;font-size:7px;color:white;display:flex;align-items:center;justify-content:center;">&#10003;</div>
                <div style="width:14px;height:14px;border-radius:50%;background:#e2e8f0;font-size:7px;color:#7c3aed;display:flex;align-items:center;justify-content:center;font-weight:700;">9</div>
                <div style="width:14px;height:14px;border-radius:50%;background:#e2e8f0;font-size:7px;color:#7c3aed;display:flex;align-items:center;justify-content:center;font-weight:700;">10</div>
              </div>
              <div style="font-size:10px;color:#64748b;text-align:center;margin-top:4px;">Auto-renew ON</div>
            </div>
          </div>
        </div>

        <div style="font-weight:600;font-size:12px;margin-bottom:6px;color:#64748b;text-transform:uppercase;">How It Works</div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:6px;">
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;text-align:center;">
            <div style="font-weight:600;font-size:11px;color:#f59e0b;">1. Settings</div>
            <div style="font-size:10px;color:#64748b;">Define packages (visits, price, discount)</div>
          </div>
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;text-align:center;">
            <div style="font-weight:600;font-size:11px;color:#2563eb;">2. Purchase</div>
            <div style="font-size:10px;color:#64748b;">Customer buys package, card charged upfront</div>
          </div>
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;text-align:center;">
            <div style="font-weight:600;font-size:11px;color:#16a34a;">3. Auto-Deduct</div>
            <div style="font-size:10px;color:#64748b;">Each completed visit deducts from package</div>
          </div>
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;text-align:center;">
            <div style="font-weight:600;font-size:11px;color:#7c3aed;">4. Renew</div>
            <div style="font-size:10px;color:#64748b;">Auto-renew or prompt when visits run out</div>
          </div>
        </div>

        <div style="background:#f8fafc;border-radius:6px;padding:8px 12px;font-size:11px;color:#64748b;margin-top:10px;">
          <b>DB:</b> <code>service_packages</code> table (company-defined), <code>customer_packages</code> table (purchased instances with visits_used/visits_total). Package card shows on recurring job when billing = prepaid. Auto-deduct triggered when job status = completed.
        </div>
      </div>
    </div>

    <!-- 14. Customer Account Balance -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#1e293b;color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;">
        <span style="font-weight:700;">14. Customer Account Balance</span>
        <span class="badge" style="background:#fce7f3;color:#be185d;">Customer Detail</span>
      </div>
      <div style="padding:16px;">
        <div style="margin-bottom:12px;color:#64748b;font-size:12px;">Show total amount owed at the top of every customer record. Aggregates unpaid balances across all estimates, jobs, and invoices so you know instantly where they stand.</div>

        <div style="font-weight:600;font-size:12px;margin-bottom:8px;color:#64748b;text-transform:uppercase;">Where It Goes</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px;">
          <!-- Customer header -->
          <div style="border:2px solid #be185d;border-radius:8px;padding:10px;background:#fdf2f8;">
            <div style="font-weight:600;font-size:11px;margin-bottom:6px;">Customer Detail — Header</div>
            <div style="font-size:11px;color:#64748b;margin-bottom:6px;">Prominent balance at top of page</div>
            <div style="border:1px solid #e2e8f0;border-radius:8px;background:white;padding:10px;">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                <div>
                  <div style="font-weight:700;font-size:14px;">John Smith</div>
                  <div style="font-size:11px;color:#64748b;">(602) 555-0123 &bull; john@email.com</div>
                </div>
                <div style="text-align:right;">
                  <div style="font-size:10px;color:#64748b;text-transform:uppercase;">Account Balance</div>
                  <div style="font-size:20px;font-weight:700;color:#dc2626;">$725.00</div>
                </div>
              </div>
              <div style="display:flex;gap:6px;">
                <div style="flex:1;background:#fef2f2;border-radius:6px;padding:6px 8px;text-align:center;">
                  <div style="font-size:10px;color:#64748b;">Unpaid Jobs</div>
                  <div style="font-size:13px;font-weight:600;color:#dc2626;">2</div>
                </div>
                <div style="flex:1;background:#fef3c7;border-radius:6px;padding:6px 8px;text-align:center;">
                  <div style="font-size:10px;color:#64748b;">Open Invoices</div>
                  <div style="font-size:13px;font-weight:600;color:#92400e;">1</div>
                </div>
                <div style="flex:1;background:#dcfce7;border-radius:6px;padding:6px 8px;text-align:center;">
                  <div style="font-size:10px;color:#64748b;">Lifetime Paid</div>
                  <div style="font-size:13px;font-weight:600;color:#16a34a;">$3,200</div>
                </div>
              </div>
            </div>
          </div>
          <!-- Customer list -->
          <div style="border:2px solid #3b82f6;border-radius:8px;padding:10px;background:#eff6ff;">
            <div style="font-weight:600;font-size:11px;margin-bottom:6px;">Customer List — Balance Column</div>
            <div style="font-size:11px;color:#64748b;margin-bottom:6px;">Quick scan for outstanding balances</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;background:white;overflow:hidden;">
              <div style="padding:6px 10px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;font-size:11px;">
                <span style="font-weight:500;">John Smith</span>
                <span style="font-weight:600;color:#dc2626;">$725</span>
              </div>
              <div style="padding:6px 10px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;font-size:11px;">
                <span style="font-weight:500;">Maria Garcia</span>
                <span style="font-weight:600;color:#dc2626;">$150</span>
              </div>
              <div style="padding:6px 10px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;font-size:11px;">
                <span style="font-weight:500;">Tom Wilson</span>
                <span style="font-weight:500;color:#16a34a;">$0</span>
              </div>
              <div style="padding:6px 10px;display:flex;justify-content:space-between;font-size:11px;">
                <span style="font-weight:500;">Sarah Lee</span>
                <span style="font-weight:600;color:#dc2626;">$425</span>
              </div>
            </div>
            <div style="font-size:10px;color:#64748b;margin-top:6px;">Sortable &bull; Filter by "Has balance"</div>
          </div>
        </div>

        <div style="background:#f8fafc;border-radius:6px;padding:8px 12px;font-size:11px;color:#64748b;">
          <b>Calculated field:</b> Sum of unpaid amounts across jobs + invoices for the customer. Updates automatically when payments are received. Shows on customer detail header + customer list as a sortable/filterable column. No new DB table — computed from existing payment data.
        </div>
      </div>
    </div>

    <!-- 15. Arrival Time Windows -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#1e293b;color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;">
        <span style="font-weight:700;">15. Arrival Time Windows</span>
        <span class="badge" style="background:#fef3c7;color:#92400e;">Settings + Job + Estimate</span>
      </div>
      <div style="padding:16px;">
        <div style="margin-bottom:12px;color:#64748b;font-size:12px;">Company defines arrival windows in settings (e.g., 8-12, 10-2, 1-5). When scheduling a job, pick a window instead of an exact time. Customer sees "Arrival between 8 AM - 12 PM."</div>

        <div style="font-weight:600;font-size:12px;margin-bottom:8px;color:#64748b;text-transform:uppercase;">Where It Goes</div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:14px;">
          <!-- Settings -->
          <div style="border:2px solid #f59e0b;border-radius:8px;padding:10px;background:#fffbeb;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">Settings — Time Windows</div>
            <div style="font-size:11px;color:#64748b;margin-bottom:6px;">/settings/scheduling</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;background:white;overflow:hidden;">
              <div style="padding:6px 10px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;font-size:11px;"><span>Morning</span><span style="color:#2563eb;font-weight:500;">8:00 AM - 12:00 PM</span></div>
              <div style="padding:6px 10px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;font-size:11px;"><span>Midday</span><span style="color:#2563eb;font-weight:500;">10:00 AM - 2:00 PM</span></div>
              <div style="padding:6px 10px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;font-size:11px;"><span>Afternoon</span><span style="color:#2563eb;font-weight:500;">1:00 PM - 5:00 PM</span></div>
              <div style="padding:6px 10px;"><input type="text" placeholder="+ Add window..." style="border:none;font-size:11px;color:#2563eb;width:100%;outline:none;"></div>
            </div>
          </div>
          <!-- Job scheduling -->
          <div style="border:2px solid #3b82f6;border-radius:8px;padding:10px;background:#eff6ff;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">Job / Estimate — Schedule Card</div>
            <div style="font-size:11px;color:#64748b;margin-bottom:6px;">Pick window instead of exact time</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;background:white;padding:8px;">
              <div class="fi"><span style="font-size:11px;color:#64748b;">Date</span><span style="font-size:11px;color:#2563eb;font-weight:500;">Feb 27</span></div>
              <div class="fi"><span style="font-size:11px;color:#64748b;">Window</span><select style="border:none;color:#2563eb;font-weight:500;font-size:11px;"><option selected>Morning (8-12)</option><option>Midday (10-2)</option><option>Afternoon (1-5)</option><option>Exact time...</option></select></div>
            </div>
          </div>
          <!-- Customer sees -->
          <div style="border:2px solid #16a34a;border-radius:8px;padding:10px;background:#f0fdf4;">
            <div style="font-weight:600;font-size:11px;margin-bottom:4px;">Customer Sees</div>
            <div style="font-size:11px;color:#64748b;margin-bottom:6px;">Estimate page + confirmation</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;background:white;padding:10px;text-align:center;">
              <div style="font-size:11px;color:#64748b;">Scheduled</div>
              <div style="font-size:14px;font-weight:700;">Feb 27, 2026</div>
              <div style="font-size:12px;color:#2563eb;font-weight:500;">Arrival between 8 AM - 12 PM</div>
            </div>
          </div>
        </div>

        <div style="background:#f8fafc;border-radius:6px;padding:8px 12px;font-size:11px;color:#64748b;">
          <b>Stored in settings:</b> Array of window objects (label, startTime, endTime). Jobs store selected window ID. Customer-facing pages show window text instead of exact time. Option to use exact time for internal scheduling while showing window to customer.
        </div>
      </div>
    </div>

    <!-- 16. Customer Portal -->
    <div class="card" style="overflow:hidden;">
      <div style="background:#1e293b;color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;">
        <span style="font-weight:700;">15. Customer Portal</span>
        <span class="badge" style="background:#f1f5f9;color:#64748b;">Future — Separate Project</span>
      </div>
      <div style="padding:16px;">
        <div style="margin-bottom:12px;color:#64748b;font-size:12px;">Unified customer-facing dashboard. Lower priority — bigger scope, separate build.</div>

        <div style="font-weight:600;font-size:12px;margin-bottom:8px;color:#64748b;text-transform:uppercase;">Where It Goes</div>
        <div style="border:1px solid #e2e8f0;border-radius:8px;padding:10px;text-align:center;">
          <div style="font-size:11px;color:#64748b;">Public URL — <b>portal.yourcompany.com/[token]</b> or customer login</div>
          <div style="display:flex;justify-content:center;gap:12px;margin-top:8px;">
            <span class="badge" style="background:#eff6ff;color:#2563eb;">Estimates</span>
            <span class="badge" style="background:#dcfce7;color:#166534;">Jobs</span>
            <span class="badge" style="background:#fef3c7;color:#92400e;">Invoices</span>
            <span class="badge" style="background:#f3e8ff;color:#7c3aed;">Contracts</span>
            <span class="badge" style="background:#fce7f3;color:#be185d;">Payments</span>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div style="border:2px dashed #f59e0b;background:#fffbeb;border-radius:8px;padding:10px;text-align:center;margin-top:20px;">
    <b>Things Needed</b> — 16 items mapped to where they live in the system. Ready to implement and refine as we build.
  </div>
</div>

<!-- ================================================================ -->
<!-- 12. SYSTEM MAP                                                     -->
<!-- ================================================================ -->
<div class="view fade" id="v-map">
  <div style="text-align:center;margin-bottom:20px;">
    <div style="font-size:18px;font-weight:700;">How Everything Connects</div>
    <div style="color:#64748b;">Click any box to see that page</div>
  </div>

  <div class="card cp" style="max-width:900px;margin:0 auto;">
    <!-- Row 1: Entry Points -->
    <div style="text-align:center;margin-bottom:6px;font-size:11px;color:#64748b;text-transform:uppercase;font-weight:600;">Entry Points</div>
    <div style="display:flex;justify-content:center;gap:20px;margin-bottom:20px;">
      <div style="border:2px solid #2563eb;border-radius:8px;padding:12px 20px;text-align:center;cursor:pointer;min-width:160px;" onclick="go('est-list')">
        <div style="font-weight:700;color:#2563eb;">Create Estimate</div>
        <div style="font-size:11px;color:#64748b;">Full pricing flow</div>
      </div>
      <div style="border:2px solid #16a34a;border-radius:8px;padding:12px 20px;text-align:center;cursor:pointer;min-width:160px;" onclick="go('job-quick')">
        <div style="font-weight:700;color:#16a34a;">Quick Book Job</div>
        <div style="font-size:11px;color:#64748b;">Skip estimate</div>
      </div>
    </div>

    <!-- Arrow -->
    <div style="text-align:center;color:#cbd5e1;font-size:20px;margin-bottom:12px;">&darr;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&darr;</div>

    <!-- Row 2: Pages -->
    <div style="display:flex;justify-content:center;gap:12px;margin-bottom:20px;flex-wrap:wrap;">
      <div style="border:2px solid #e2e8f0;border-radius:8px;padding:10px 16px;text-align:center;cursor:pointer;width:130px;" onclick="go('est-detail')">
        <div style="font-weight:600;">Estimate Detail</div>
        <div style="font-size:11px;color:#64748b;">V3 editor + preview</div>
      </div>
      <div style="display:flex;align-items:center;color:#cbd5e1;">&rarr;</div>
      <div style="border:2px solid #e2e8f0;border-radius:8px;padding:10px 16px;text-align:center;cursor:pointer;width:130px;" onclick="go('est-preview')">
        <div style="font-weight:600;">Customer Page</div>
        <div style="font-size:11px;color:#64748b;">Branded proposal</div>
      </div>
      <div style="display:flex;align-items:center;color:#cbd5e1;">&rarr;</div>
      <div style="border:2px solid #16a34a;border-radius:8px;padding:10px 16px;text-align:center;width:130px;">
        <div style="font-weight:600;color:#16a34a;">Approval</div>
        <div style="font-size:11px;color:#64748b;">Online or phone</div>
      </div>
    </div>

    <!-- Arrow -->
    <div style="text-align:center;color:#cbd5e1;font-size:20px;margin-bottom:12px;">&darr;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&darr; (both paths)</div>

    <!-- Row 3: Jobs -->
    <div style="text-align:center;margin-bottom:6px;font-size:11px;color:#64748b;text-transform:uppercase;font-weight:600;">All Roads Lead to Jobs</div>
    <div style="display:flex;justify-content:center;gap:12px;margin-bottom:20px;flex-wrap:wrap;">
      <div style="border:2px solid #2563eb;border-radius:8px;padding:10px 16px;text-align:center;cursor:pointer;width:140px;" onclick="go('job-est')">
        <div style="font-weight:600;color:#2563eb;">Job (Estimate)</div>
        <div style="font-size:11px;color:#64748b;">Full context</div>
      </div>
      <div style="border:2px solid #16a34a;border-radius:8px;padding:10px 16px;text-align:center;cursor:pointer;width:140px;" onclick="go('job-quick')">
        <div style="font-weight:600;color:#16a34a;">Job (Quick)</div>
        <div style="font-size:11px;color:#64748b;">Simple view</div>
      </div>
      <div style="border:2px solid #8b5cf6;border-radius:8px;padding:10px 16px;text-align:center;cursor:pointer;width:140px;" onclick="go('job-recur')">
        <div style="font-weight:600;color:#8b5cf6;">Recurring</div>
        <div style="font-size:11px;color:#64748b;">Template + instances</div>
      </div>
    </div>

    <!-- Arrow -->
    <div style="text-align:center;color:#cbd5e1;font-size:20px;margin-bottom:12px;">&darr;&nbsp;&nbsp;&nbsp;&darr;&nbsp;&nbsp;&nbsp;&darr;</div>

    <!-- Row 4: Assignment -->
    <div style="text-align:center;margin-bottom:6px;font-size:11px;color:#f59e0b;text-transform:uppercase;font-weight:600;">Assignment (Company Setting)</div>
    <div style="display:flex;justify-content:center;gap:12px;margin-bottom:20px;flex-wrap:wrap;">
      <div style="border:2px solid #f59e0b;border-radius:8px;padding:10px 16px;text-align:center;width:150px;background:#fffbeb;">
        <div style="font-weight:600;color:#92400e;">Individual Mode</div>
        <div style="font-size:11px;color:#64748b;">Pest control, HVAC</div>
        <div style="font-size:11px;color:#64748b;">1 tech per job</div>
      </div>
      <div style="border:2px solid #f59e0b;border-radius:8px;padding:10px 16px;text-align:center;width:150px;background:#fffbeb;">
        <div style="font-weight:600;color:#92400e;">Crew Mode</div>
        <div style="font-size:11px;color:#64748b;">Cleaning, lawn care</div>
        <div style="font-size:11px;color:#64748b;">Named teams</div>
      </div>
      <div style="border:2px solid #f59e0b;border-radius:8px;padding:10px 16px;text-align:center;width:150px;background:#fffbeb;">
        <div style="font-weight:600;color:#92400e;">Both Mode</div>
        <div style="font-size:11px;color:#64748b;">Moving companies</div>
        <div style="font-size:11px;color:#64748b;">Per-job choice</div>
      </div>
    </div>

    <!-- Arrow -->
    <div style="text-align:center;color:#cbd5e1;font-size:20px;margin-bottom:12px;">&darr;</div>

    <!-- Row 5: Operations -->
    <div style="display:flex;justify-content:center;gap:12px;margin-bottom:20px;flex-wrap:wrap;">
      <div style="border:2px solid #f59e0b;border-radius:8px;padding:10px 16px;text-align:center;cursor:pointer;width:130px;" onclick="go('dispatch')">
        <div style="font-weight:600;color:#f59e0b;">Dispatch</div>
        <div style="font-size:11px;color:#64748b;">All jobs, all crews</div>
      </div>
      <div style="border:2px solid #e2e8f0;border-radius:8px;padding:10px 16px;text-align:center;width:130px;">
        <div style="font-weight:600;">Contract</div>
        <div style="font-size:11px;color:#64748b;">Sign, track</div>
      </div>
      <div style="border:2px solid #e2e8f0;border-radius:8px;padding:10px 16px;text-align:center;width:130px;">
        <div style="font-weight:600;">Invoice</div>
        <div style="font-size:11px;color:#64748b;">Final billing</div>
      </div>
      <div style="border:2px solid #e2e8f0;border-radius:8px;padding:10px 16px;text-align:center;width:130px;">
        <div style="font-weight:600;">Tech Portal</div>
        <div style="font-size:11px;color:#64748b;">Crew mobile view</div>
      </div>
    </div>

    <!-- Arrow -->
    <div style="text-align:center;color:#cbd5e1;font-size:20px;margin-bottom:12px;">&darr;</div>

    <!-- Row 6: Payments -->
    <div style="text-align:center;margin-bottom:6px;font-size:11px;color:#16a34a;text-transform:uppercase;font-weight:600;">Money Flow (Payments)</div>
    <div style="display:flex;justify-content:center;gap:12px;margin-bottom:20px;flex-wrap:wrap;">
      <div style="border:2px solid #16a34a;border-radius:8px;padding:10px 16px;text-align:center;cursor:pointer;width:140px;background:#f0fdf4;" onclick="go('payments')">
        <div style="font-weight:600;color:#166534;">Deposit</div>
        <div style="font-size:11px;color:#64748b;">On approval</div>
      </div>
      <div style="border:2px solid #16a34a;border-radius:8px;padding:10px 16px;text-align:center;cursor:pointer;width:140px;background:#f0fdf4;" onclick="go('payments')">
        <div style="font-weight:600;color:#166534;">Take Payment</div>
        <div style="font-size:11px;color:#64748b;">Admin collects</div>
      </div>
      <div style="border:2px solid #16a34a;border-radius:8px;padding:10px 16px;text-align:center;cursor:pointer;width:140px;background:#f0fdf4;" onclick="go('payments')">
        <div style="font-weight:600;color:#166534;">Invoice Pay</div>
        <div style="font-size:11px;color:#64748b;">Customer online</div>
      </div>
      <div style="border:2px solid #16a34a;border-radius:8px;padding:10px 16px;text-align:center;cursor:pointer;width:140px;background:#f0fdf4;" onclick="go('payments')">
        <div style="font-weight:600;color:#166534;">Auto-Charge</div>
        <div style="font-size:11px;color:#64748b;">Recurring</div>
      </div>
    </div>

    <!-- Arrow -->
    <div style="text-align:center;color:#cbd5e1;font-size:20px;margin-bottom:12px;">&darr;</div>

    <!-- Row 7: Customer Portal -->
    <div style="text-align:center;margin-bottom:6px;font-size:11px;color:#8b5cf6;text-transform:uppercase;font-weight:600;">Customer Experience</div>
    <div style="display:flex;justify-content:center;gap:20px;flex-wrap:wrap;">
      <div style="border:2px solid #8b5cf6;border-radius:8px;padding:14px 24px;text-align:center;cursor:pointer;min-width:200px;background:#f5f3ff;" onclick="go('portal')">
        <div style="font-weight:700;color:#7c3aed;font-size:14px;">Customer Portal</div>
        <div style="font-size:11px;color:#64748b;margin-top:2px;">Estimates, jobs, invoices, contracts, payments</div>
        <div style="font-size:11px;color:#64748b;">All in one place for the customer</div>
      </div>
    </div>
  </div>
</div>

</div>

<!-- ===== SLIDE PANELS ===== -->
<div class="overlay" id="ov" onclick="closePanel()"></div>

<!-- Payment Panel -->
<div class="spanel" id="sp-pay">
  <div class="sp-head">
    <span style="font-weight:600;">Payments</span>
    <button class="sp-close" onclick="closePanel()">&times;</button>
  </div>
  <div style="padding:16px;">
    <!-- Balance summary -->
    <div style="text-align:center;padding:16px 0;margin-bottom:14px;border-bottom:1px solid #e2e8f0;">
      <div style="font-size:11px;color:#64748b;text-transform:uppercase;">Balance Due</div>
      <div style="font-size:32px;font-weight:700;color:#dc2626;">$325.00</div>
      <div style="font-size:12px;color:#64748b;">EST-001 &bull; Local Move &bull; John Smith</div>
      <div style="display:flex;justify-content:center;gap:16px;margin-top:8px;font-size:12px;">
        <span><span style="color:#64748b;">Total:</span> <b>$425.00</b></span>
        <span><span style="color:#64748b;">Paid:</span> <b style="color:#16a34a;">$100.00</b></span>
      </div>
    </div>

    <!-- Quick actions -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:16px;">
      <button class="b b-green" style="justify-content:center;padding:10px;" onclick="showPayForm('remaining')">Collect Balance</button>
      <button class="b b-blue" style="justify-content:center;padding:10px;" onclick="showPayForm('custom')">Custom Amount</button>
    </div>

    <!-- Payment form (hidden until action clicked) -->
    <div id="pay-form" style="display:none;margin-bottom:16px;">
      <div style="border:1px solid #e2e8f0;border-radius:10px;overflow:hidden;">
        <div style="background:#f8fafc;padding:10px 14px;border-bottom:1px solid #e2e8f0;">
          <div style="font-weight:600;font-size:12px;" id="pay-form-title">Collect Deposit</div>
        </div>
        <div style="padding:14px;">
          <div style="margin-bottom:10px;">
            <div style="font-size:11px;color:#64748b;margin-bottom:4px;">Amount</div>
            <div style="border:1px solid #e2e8f0;border-radius:6px;padding:10px;font-size:18px;font-weight:700;" id="pay-amount">$100.00</div>
          </div>
          <div style="margin-bottom:10px;">
            <div style="font-size:11px;color:#64748b;margin-bottom:4px;">Method</div>
            <div class="tog" style="width:100%;">
              <button class="tog-b on" style="flex:1;text-align:center;" onclick="payMethod(this,'card')">Card</button>
              <button class="tog-b" style="flex:1;text-align:center;" onclick="payMethod(this,'cash')">Cash</button>
              <button class="tog-b" style="flex:1;text-align:center;" onclick="payMethod(this,'check')">Check</button>
              <button class="tog-b" style="flex:1;text-align:center;" onclick="payMethod(this,'other')">Other</button>
            </div>
          </div>
          <!-- Card fields -->
          <div id="pay-card-fields">
            <div style="border:1px solid #e2e8f0;border-radius:6px;padding:10px;margin-bottom:8px;">
              <div style="font-size:11px;color:#64748b;margin-bottom:2px;">Card Number</div>
              <div style="font-size:13px;color:#94a3b8;">4242 4242 4242 4242</div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px;">
              <div style="border:1px solid #e2e8f0;border-radius:6px;padding:10px;">
                <div style="font-size:11px;color:#64748b;">Expiry</div>
                <div style="font-size:13px;color:#94a3b8;">12/28</div>
              </div>
              <div style="border:1px solid #e2e8f0;border-radius:6px;padding:10px;">
                <div style="font-size:11px;color:#64748b;">CVC</div>
                <div style="font-size:13px;color:#94a3b8;">***</div>
              </div>
            </div>
          </div>
          <!-- Non-card fields -->
          <div id="pay-other-fields" style="display:none;">
            <div style="border:1px solid #e2e8f0;border-radius:6px;padding:10px;margin-bottom:10px;">
              <div style="font-size:11px;color:#64748b;margin-bottom:2px;">Reference / Note</div>
              <div style="font-size:13px;color:#94a3b8;">Check #1234, Cash receipt, etc.</div>
            </div>
          </div>
          <!-- CC Processing Fee (shows only when Card selected) -->
          <div id="pay-cc-fee" style="background:#fffbeb;border:1px solid #fde68a;border-radius:6px;padding:8px 10px;margin-bottom:10px;">
            <div style="display:flex;justify-content:space-between;font-size:12px;">
              <span style="color:#92400e;font-weight:500;">CC Processing (2.9%)</span>
              <span style="color:#92400e;font-weight:600;" id="cc-fee-amount">+$9.43</span>
            </div>
            <div style="display:flex;justify-content:space-between;font-size:12px;margin-top:4px;padding-top:4px;border-top:1px solid #fde68a;">
              <span style="font-weight:600;">Customer pays</span>
              <span style="font-weight:700;" id="cc-total-amount">$334.43</span>
            </div>
          </div>
          <button class="b b-green" style="width:100%;justify-content:center;padding:10px;" id="pay-submit-btn">Charge $334.43</button>
          <div style="text-align:center;margin-top:6px;display:flex;align-items:center;justify-content:center;gap:4px;">
            <span style="font-size:12px;">&#128274;</span>
            <span style="font-size:10px;color:#94a3b8;">Secured by Stripe</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Payment history -->
    <div style="font-size:12px;font-weight:600;margin-bottom:8px;color:#64748b;text-transform:uppercase;">Payment History</div>
    <div style="border:1px solid #e2e8f0;border-radius:8px;overflow:hidden;">
      <div style="padding:10px 12px;border-bottom:1px solid #f1f5f9;display:flex;align-items:center;justify-content:space-between;">
        <div style="display:flex;align-items:center;gap:8px;">
          <div style="width:28px;height:28px;border-radius:50%;background:#dcfce7;display:flex;align-items:center;justify-content:center;">
            <svg width="12" height="12" fill="none" stroke="#16a34a" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"/></svg>
          </div>
          <div>
            <div style="font-weight:600;font-size:12px;">Deposit — $100.00</div>
            <div style="font-size:11px;color:#64748b;">Jan 16, 2026 &bull; Visa ****4242</div>
          </div>
        </div>
        <span class="badge" style="background:#dcfce7;color:#166534;">Paid</span>
      </div>
      <div style="padding:8px 12px;background:#f8fafc;display:flex;justify-content:space-between;font-size:11px;color:#64748b;">
        <span>1 payment &bull; $100.00 collected</span>
        <a href="#" style="color:#2563eb;" onclick="event.preventDefault()">Receipt</a>
      </div>
    </div>

    <!-- Send payment link -->
    <div style="margin-top:14px;border-top:1px solid #e2e8f0;padding-top:14px;">
      <div style="font-size:12px;font-weight:600;margin-bottom:8px;">Send Payment Link</div>
      <div style="display:flex;gap:6px;">
        <button class="b b-out" style="flex:1;justify-content:center;">Email Link</button>
        <button class="b b-out" style="flex:1;justify-content:center;">Text Link</button>
      </div>
      <div style="font-size:11px;color:#64748b;margin-top:6px;">Customer receives a link to pay online via Stripe checkout</div>
    </div>
  </div>
</div>

<!-- Documents Panel -->
<div class="spanel" id="sp-docs">
  <div class="sp-head">
    <span style="font-weight:600;">Documents</span>
    <button class="sp-close" onclick="closePanel()">&times;</button>
  </div>
  <div style="padding:16px;">
    <!-- Opportunity / Estimate docs -->
    <div style="font-size:11px;font-weight:600;color:#64748b;text-transform:uppercase;margin-bottom:8px;">Estimate — EST-001</div>
    <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:16px;">
      <div style="border:1px solid #e2e8f0;border-radius:8px;padding:10px 12px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">
        <div style="display:flex;align-items:center;gap:10px;">
          <div style="width:32px;height:32px;border-radius:6px;background:#eff6ff;display:flex;align-items:center;justify-content:center;color:#2563eb;font-size:14px;">&#128196;</div>
          <div>
            <div style="font-weight:600;font-size:12px;">Estimate</div>
            <div style="font-size:10px;color:#64748b;">Generated Jan 15, 2026</div>
          </div>
        </div>
        <span class="badge" style="background:#dcfce7;color:#166534;">Sent</span>
      </div>
      <div style="border:1px solid #e2e8f0;border-radius:8px;padding:10px 12px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">
        <div style="display:flex;align-items:center;gap:10px;">
          <div style="width:32px;height:32px;border-radius:6px;background:#fef3c7;display:flex;align-items:center;justify-content:center;color:#92400e;font-size:14px;">&#128221;</div>
          <div>
            <div style="font-weight:600;font-size:12px;">Flat Rate Contract</div>
            <div style="font-size:10px;color:#64748b;">Auto-attached &bull; Jan 15, 2026</div>
          </div>
        </div>
        <span class="badge" style="background:#dcfce7;color:#166534;">Signed</span>
      </div>
    </div>

    <!-- Job docs -->
    <div style="font-size:11px;font-weight:600;color:#64748b;text-transform:uppercase;margin-bottom:8px;">Job — EST-001-1</div>
    <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:16px;">
      <div style="border:1px solid #e2e8f0;border-radius:8px;padding:10px 12px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">
        <div style="display:flex;align-items:center;gap:10px;">
          <div style="width:32px;height:32px;border-radius:6px;background:#f0fdf4;display:flex;align-items:center;justify-content:center;color:#16a34a;font-size:14px;">&#128221;</div>
          <div>
            <div style="font-weight:600;font-size:12px;">ARM Hourly Contract</div>
            <div style="font-size:10px;color:#64748b;">Auto-attached &bull; Jan 16, 2026</div>
          </div>
        </div>
        <span class="badge" style="background:#fef3c7;color:#92400e;">Sent</span>
      </div>
      <div style="border:1px solid #e2e8f0;border-radius:8px;padding:10px 12px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">
        <div style="display:flex;align-items:center;gap:10px;">
          <div style="width:32px;height:32px;border-radius:6px;background:#f3e8ff;display:flex;align-items:center;justify-content:center;color:#7c3aed;font-size:14px;">&#128196;</div>
          <div>
            <div style="font-weight:600;font-size:12px;">Invoice #INV-047</div>
            <div style="font-size:10px;color:#64748b;">Generated Feb 27, 2026</div>
          </div>
        </div>
        <span class="badge" style="background:#fef3c7;color:#92400e;">Unpaid</span>
      </div>
      <div style="border:1px solid #e2e8f0;border-radius:8px;padding:10px 12px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">
        <div style="display:flex;align-items:center;gap:10px;">
          <div style="width:32px;height:32px;border-radius:6px;background:#f8fafc;display:flex;align-items:center;justify-content:center;color:#64748b;font-size:14px;">&#128203;</div>
          <div>
            <div style="font-weight:600;font-size:12px;">Work Order</div>
            <div style="font-size:10px;color:#64748b;">Generated Feb 27, 2026</div>
          </div>
        </div>
        <span class="badge" style="background:#f1f5f9;color:#64748b;">Draft</span>
      </div>
    </div>

    <!-- Actions -->
    <div style="border-top:1px solid #e2e8f0;padding-top:12px;">
      <button class="b b-out" style="width:100%;justify-content:center;margin-bottom:6px;">+ Generate Document</button>
      <div style="font-size:11px;color:#64748b;text-align:center;">Create contracts, invoices, or work orders</div>
    </div>
  </div>
</div>

<!-- Activity Panel -->
<div class="spanel" id="sp-activity">
  <div class="sp-head">
    <span style="font-weight:600;">Activity</span>
    <button class="sp-close" onclick="closePanel()">&times;</button>
  </div>
  <div style="padding:16px;">
    <div style="font-size:11px;font-weight:600;color:#64748b;text-transform:uppercase;margin-bottom:12px;">Recent Activity</div>

    <!-- Activity entries -->
    <div style="display:flex;flex-direction:column;gap:0;position:relative;">
      <!-- Vertical line -->
      <div style="position:absolute;left:15px;top:24px;bottom:24px;width:2px;background:#e2e8f0;"></div>

      <div style="display:flex;gap:12px;padding:8px 0;position:relative;">
        <div style="width:30px;height:30px;border-radius:50%;background:#dcfce7;display:flex;align-items:center;justify-content:center;flex-shrink:0;z-index:1;">
          <span style="font-size:12px;">&#128179;</span>
        </div>
        <div>
          <div style="font-size:12px;font-weight:500;">Payment received — $100.00 deposit</div>
          <div style="font-size:11px;color:#64748b;">Feb 27, 2026 at 3:42 PM &bull; <span style="color:#2563eb;">Stripe</span></div>
        </div>
      </div>

      <div style="display:flex;gap:12px;padding:8px 0;position:relative;">
        <div style="width:30px;height:30px;border-radius:50%;background:#dbeafe;display:flex;align-items:center;justify-content:center;flex-shrink:0;z-index:1;">
          <span style="font-size:12px;">&#128197;</span>
        </div>
        <div>
          <div style="font-size:12px;font-weight:500;">Job scheduled for Feb 27</div>
          <div style="font-size:11px;color:#64748b;">Jan 16, 2026 at 11:20 AM &bull; <span style="color:#2563eb;">Daniela M.</span></div>
        </div>
      </div>

      <div style="display:flex;gap:12px;padding:8px 0;position:relative;">
        <div style="width:30px;height:30px;border-radius:50%;background:#dcfce7;display:flex;align-items:center;justify-content:center;flex-shrink:0;z-index:1;">
          <span style="font-size:12px;">&#9989;</span>
        </div>
        <div>
          <div style="font-size:12px;font-weight:500;">Estimate approved by customer</div>
          <div style="font-size:11px;color:#64748b;">Jan 16, 2026 at 10:05 AM &bull; <span style="color:#2563eb;">John Smith</span></div>
        </div>
      </div>

      <div style="display:flex;gap:12px;padding:8px 0;position:relative;">
        <div style="width:30px;height:30px;border-radius:50%;background:#fef3c7;display:flex;align-items:center;justify-content:center;flex-shrink:0;z-index:1;">
          <span style="font-size:12px;">&#128221;</span>
        </div>
        <div>
          <div style="font-size:12px;font-weight:500;">Contract sent — Flat Rate Contract</div>
          <div style="font-size:11px;color:#64748b;">Jan 15, 2026 at 4:30 PM &bull; <span style="color:#2563eb;">Daniela M.</span></div>
        </div>
      </div>

      <div style="display:flex;gap:12px;padding:8px 0;position:relative;">
        <div style="width:30px;height:30px;border-radius:50%;background:#dbeafe;display:flex;align-items:center;justify-content:center;flex-shrink:0;z-index:1;">
          <span style="font-size:12px;">&#128232;</span>
        </div>
        <div>
          <div style="font-size:12px;font-weight:500;">Estimate sent to customer</div>
          <div style="font-size:11px;color:#64748b;">Jan 15, 2026 at 4:15 PM &bull; <span style="color:#2563eb;">Daniela M.</span></div>
        </div>
      </div>

      <div style="display:flex;gap:12px;padding:8px 0;position:relative;">
        <div style="width:30px;height:30px;border-radius:50%;background:#f3e8ff;display:flex;align-items:center;justify-content:center;flex-shrink:0;z-index:1;">
          <span style="font-size:12px;">&#128736;</span>
        </div>
        <div>
          <div style="font-size:12px;font-weight:500;">Estimate updated — pricing changed</div>
          <div style="font-size:11px;color:#64748b;">Jan 15, 2026 at 3:45 PM &bull; <span style="color:#2563eb;">Daniela M.</span></div>
        </div>
      </div>

      <div style="display:flex;gap:12px;padding:8px 0;position:relative;">
        <div style="width:30px;height:30px;border-radius:50%;background:#dcfce7;display:flex;align-items:center;justify-content:center;flex-shrink:0;z-index:1;">
          <span style="font-size:12px;">&#10024;</span>
        </div>
        <div>
          <div style="font-size:12px;font-weight:500;">Estimate created</div>
          <div style="font-size:11px;color:#64748b;">Jan 15, 2026 at 2:00 PM &bull; <span style="color:#2563eb;">Daniela M.</span></div>
        </div>
      </div>
    </div>

    <div style="border-top:1px solid #e2e8f0;padding-top:12px;margin-top:8px;text-align:center;">
      <div style="font-size:11px;color:#64748b;">7 activities &bull; Last 45 days</div>
    </div>
  </div>
</div>

<!-- ===== SCHEDULE PANEL (slides from right) ===== -->
<div class="spanel" id="sp-schedule">
  <div class="sp-head" style="background:#1e293b;">
    <span style="font-weight:600;">Schedule Job</span>
    <button class="sp-close" onclick="closePanel()">×</button>
  </div>
  <div style="padding:0;">
    <!-- Job context bar -->
    <div style="padding:10px 16px;background:#f8fafc;border-bottom:1px solid #e2e8f0;">
      <div style="font-weight:600;font-size:13px;">EST-001 &bull; Local Move</div>
      <div style="font-size:11px;color:#64748b;">John &bull; ~3 hrs &bull; 2 team members needed</div>
    </div>

    <!-- Mini calendar -->
    <div style="padding:12px 16px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
        <span style="font-weight:600;font-size:13px;">February 2026</span>
        <div style="display:flex;gap:4px;">
          <button style="background:#f1f5f9;border:1px solid #e2e8f0;border-radius:4px;padding:2px 8px;cursor:pointer;font-size:11px;">&larr;</button>
          <button style="background:#f1f5f9;border:1px solid #e2e8f0;border-radius:4px;padding:2px 8px;cursor:pointer;font-size:11px;">&rarr;</button>
        </div>
      </div>
      <!-- Day headers -->
      <div style="display:grid;grid-template-columns:repeat(7,1fr);text-align:center;font-size:10px;color:#94a3b8;margin-bottom:4px;font-weight:600;">
        <div>Su</div><div>Mo</div><div>Tu</div><div>We</div><div>Th</div><div>Fr</div><div>Sa</div>
      </div>
      <!-- Calendar grid -->
      <div style="display:grid;grid-template-columns:repeat(7,1fr);text-align:center;gap:2px;font-size:11px;">
        <!-- Previous month -->
        <div style="padding:5px;color:#cbd5e1;">25</div><div style="padding:5px;color:#cbd5e1;">26</div><div style="padding:5px;color:#cbd5e1;">27</div><div style="padding:5px;color:#cbd5e1;">28</div><div style="padding:5px;color:#cbd5e1;">29</div><div style="padding:5px;color:#cbd5e1;">30</div><div style="padding:5px;color:#cbd5e1;">31</div>
        <!-- Week 1 -->
        <div style="padding:5px;">1</div><div style="padding:5px;">2</div><div style="padding:5px;">3</div><div style="padding:5px;">4</div><div style="padding:5px;">5</div><div style="padding:5px;">6</div><div style="padding:5px;">7</div>
        <!-- Week 2 -->
        <div style="padding:5px;">8</div>
        <div style="padding:5px;">9</div>
        <div style="padding:5px;position:relative;">10<div style="position:absolute;bottom:1px;left:50%;transform:translateX(-50%);width:5px;height:5px;border-radius:50%;background:#f59e0b;"></div></div>
        <div style="padding:5px;position:relative;">11<div style="position:absolute;bottom:1px;left:50%;transform:translateX(-50%);width:5px;height:5px;border-radius:50%;background:#f59e0b;"></div></div>
        <div style="padding:5px;position:relative;">12<div style="position:absolute;bottom:1px;left:50%;transform:translateX(-50%);width:5px;height:5px;border-radius:50%;background:#ef4444;"></div></div>
        <div style="padding:5px;position:relative;">13<div style="position:absolute;bottom:1px;left:50%;transform:translateX(-50%);width:5px;height:5px;border-radius:50%;background:#22c55e;"></div></div>
        <div style="padding:5px;">14</div>
        <!-- Week 3 -->
        <div style="padding:5px;">15</div>
        <div style="padding:5px;position:relative;">16<div style="position:absolute;bottom:1px;left:50%;transform:translateX(-50%);width:5px;height:5px;border-radius:50%;background:#22c55e;"></div></div>
        <div style="padding:5px;position:relative;">17<div style="position:absolute;bottom:1px;left:50%;transform:translateX(-50%);width:5px;height:5px;border-radius:50%;background:#22c55e;"></div></div>
        <div style="padding:5px;position:relative;">18<div style="position:absolute;bottom:1px;left:50%;transform:translateX(-50%);width:5px;height:5px;border-radius:50%;background:#22c55e;"></div></div>
        <div style="padding:5px;position:relative;">19<div style="position:absolute;bottom:1px;left:50%;transform:translateX(-50%);width:5px;height:5px;border-radius:50%;background:#f59e0b;"></div></div>
        <div style="padding:5px;position:relative;">20<div style="position:absolute;bottom:1px;left:50%;transform:translateX(-50%);width:5px;height:5px;border-radius:50%;background:#22c55e;"></div></div>
        <div style="padding:5px;">21</div>
        <!-- Week 4 -->
        <div style="padding:5px;">22</div>
        <div style="padding:5px;position:relative;">23<div style="position:absolute;bottom:1px;left:50%;transform:translateX(-50%);width:5px;height:5px;border-radius:50%;background:#22c55e;"></div></div>
        <div style="padding:5px;position:relative;">24<div style="position:absolute;bottom:1px;left:50%;transform:translateX(-50%);width:5px;height:5px;border-radius:50%;background:#22c55e;"></div></div>
        <div style="padding:5px;">25</div>
        <div style="padding:5px;">26</div>
        <div style="padding:5px;background:#2563eb;color:white;border-radius:6px;font-weight:700;cursor:pointer;">27</div>
        <div style="padding:5px;">28</div>
      </div>
      <!-- Legend -->
      <div style="display:flex;gap:10px;margin-top:6px;font-size:10px;color:#64748b;">
        <div style="display:flex;align-items:center;gap:3px;"><div style="width:6px;height:6px;border-radius:50%;background:#22c55e;"></div> Open</div>
        <div style="display:flex;align-items:center;gap:3px;"><div style="width:6px;height:6px;border-radius:50%;background:#f59e0b;"></div> Partial</div>
        <div style="display:flex;align-items:center;gap:3px;"><div style="width:6px;height:6px;border-radius:50%;background:#ef4444;"></div> Full</div>
      </div>
    </div>

    <!-- Selected day: time slots -->
    <div style="padding:0 16px 12px;">
      <div style="font-weight:600;font-size:12px;margin-bottom:2px;">Friday, Feb 27</div>
      <div style="font-size:11px;color:#64748b;margin-bottom:8px;">3 techs available &bull; 1 crew available</div>

      <div style="display:flex;flex-direction:column;gap:4px;">
        <div style="padding:8px 10px;border:1px solid #e2e8f0;border-radius:6px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;background:#f0fdf4;border-color:#86efac;">
          <div>
            <div style="font-size:12px;font-weight:600;">8:00 AM - 12:00 PM</div>
            <div style="font-size:10px;color:#64748b;">Mike R., Alex T. available</div>
          </div>
          <span style="background:#dcfce7;color:#166534;padding:2px 6px;border-radius:9999px;font-size:9px;font-weight:600;">Open</span>
        </div>
        <div style="padding:8px 10px;border:1px solid #fde68a;border-radius:6px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;background:#fffbeb;">
          <div>
            <div style="font-size:12px;font-weight:600;">10:00 AM - 2:00 PM</div>
            <div style="font-size:10px;color:#64748b;">Mike R. avail (Alex on JOB-044)</div>
          </div>
          <span style="background:#fef3c7;color:#92400e;padding:2px 6px;border-radius:9999px;font-size:9px;font-weight:600;">Partial</span>
        </div>
        <div style="padding:8px 10px;border:2px solid #2563eb;border-radius:6px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;background:#eff6ff;">
          <div>
            <div style="font-size:12px;font-weight:600;color:#2563eb;">1:00 PM - 5:00 PM</div>
            <div style="font-size:10px;color:#64748b;">Mike R., Alex T., Crew A</div>
          </div>
          <span style="background:#dbeafe;color:#1e40af;padding:2px 6px;border-radius:9999px;font-size:9px;font-weight:600;">Selected</span>
        </div>
      </div>
    </div>

    <!-- Assignment -->
    <div style="padding:0 16px 12px;border-top:1px solid #e2e8f0;padding-top:12px;">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
        <div>
          <div style="font-size:11px;color:#64748b;margin-bottom:3px;">Assign to</div>
          <select style="width:100%;padding:6px 8px;border:1px solid #e2e8f0;border-radius:6px;font-size:12px;">
            <option>Mike R.</option>
            <option>Alex T.</option>
            <option>Crew A (Mike, Alex, Sam)</option>
          </select>
        </div>
        <div>
          <div style="font-size:11px;color:#64748b;margin-bottom:3px;">Arrival Window</div>
          <select style="width:100%;padding:6px 8px;border:1px solid #e2e8f0;border-radius:6px;font-size:12px;">
            <option>1 PM - 5 PM</option>
            <option>8 AM - 12 PM</option>
            <option>10 AM - 2 PM</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Footer actions -->
    <div style="padding:12px 16px;border-top:1px solid #e2e8f0;background:#f8fafc;">
      <button class="b b-blue" style="width:100%;justify-content:center;margin-bottom:6px;" onclick="closePanel()">Confirm &mdash; Feb 27, 1:00 PM</button>
      <div style="text-align:center;">
        <a href="#" style="font-size:11px;color:#2563eb;text-decoration:none;" onclick="event.preventDefault();closePanel();go('scheduler')">Open Full Calendar &rarr;</a>
      </div>
    </div>
  </div>
</div>

<script>
// ===== View navigation =====
const views = ['est-list','est-detail','est-preview','jobs-list','job-est','job-quick','job-recur','scheduler','dispatch','payments','portal','needed','map'];
function go(v) {
  views.forEach(id => {
    document.getElementById('v-'+id).classList.remove('on');
    document.getElementById('n-'+id).classList.remove('on');
  });
  const el = document.getElementById('v-'+v);
  el.classList.add('on');
  el.classList.remove('fade');
  void el.offsetWidth;
  el.classList.add('fade');
  document.getElementById('n-'+v).classList.add('on');
  window.scrollTo({top:0,behavior:'smooth'});
}

// ===== Editor/Preview mode toggle =====
function mode(m) {
  document.getElementById('editor').style.display = m==='edit' ? 'grid' : 'none';
  document.getElementById('preview').style.display = m==='prev' ? 'grid' : 'none';
  document.getElementById('m-edit').classList.toggle('on', m==='edit');
  document.getElementById('m-prev').classList.toggle('on', m==='prev');
}

// ===== Slide Panel System =====
function openPanel(name) {
  document.getElementById('ov').classList.add('show');
  document.getElementById('sp-' + name).classList.add('open');
  document.body.style.overflow = 'hidden';
}
function closePanel() {
  document.getElementById('ov').classList.remove('show');
  document.querySelectorAll('.spanel').forEach(p => p.classList.remove('open'));
  document.body.style.overflow = '';
}
function showPayForm(type) {
  const form = document.getElementById('pay-form');
  const title = document.getElementById('pay-form-title');
  const amount = document.getElementById('pay-amount');
  const btn = document.getElementById('pay-submit-btn');
  const ccFee = document.getElementById('pay-cc-fee');
  form.style.display = 'block';
  // Reset method to Card (default)
  const togBtns = form.querySelectorAll('.tog-b');
  togBtns.forEach(b => b.classList.remove('on'));
  if (togBtns[0]) togBtns[0].classList.add('on');
  document.getElementById('pay-card-fields').style.display = 'block';
  document.getElementById('pay-other-fields').style.display = 'none';
  ccFee.style.display = 'block';

  let base = 325;
  if (type === 'remaining') {
    title.textContent = 'Collect Remaining Balance';
    base = 325;
    amount.textContent = '$325.00';
  } else if (type === 'deposit') {
    title.textContent = 'Collect Deposit';
    base = 100;
    amount.textContent = '$100.00';
  } else if (type === 'custom') {
    title.textContent = 'Custom Amount';
    base = 0;
    amount.innerHTML = '<input type="text" value="$0.00" style="border:none;font-size:18px;font-weight:700;width:100%;outline:none;" onclick="this.select()">';
    ccFee.style.display = 'none';
    btn.textContent = 'Charge Amount';
    return;
  } else {
    title.textContent = 'Full Payment';
    base = 425;
    amount.textContent = '$425.00';
  }
  // Calculate CC fee for card (default method)
  const fee = Math.round(base * 0.029 * 100) / 100;
  const total = Math.round((base + fee) * 100) / 100;
  document.getElementById('cc-fee-amount').textContent = '+$' + fee.toFixed(2);
  document.getElementById('cc-total-amount').textContent = '$' + total.toFixed(2);
  btn.textContent = 'Charge $' + total.toFixed(2);
}
function payMethod(el, method) {
  el.parentElement.querySelectorAll('.tog-b').forEach(b => b.classList.remove('on'));
  el.classList.add('on');
  document.getElementById('pay-card-fields').style.display = method === 'card' ? 'block' : 'none';
  document.getElementById('pay-other-fields').style.display = method !== 'card' ? 'block' : 'none';
  // CC processing fee — only shows for card payments
  const ccFee = document.getElementById('pay-cc-fee');
  const btn = document.getElementById('pay-submit-btn');
  const baseText = btn.textContent.replace(/Charge \$[\d,.]+/, '').trim();
  if (method === 'card') {
    ccFee.style.display = 'block';
    // Recalculate with 2.9% fee
    const amount = document.getElementById('pay-amount');
    const raw = parseFloat((amount.textContent || '$325').replace(/[^0-9.]/g, '')) || 325;
    const fee = Math.round(raw * 0.029 * 100) / 100;
    const total = Math.round((raw + fee) * 100) / 100;
    document.getElementById('cc-fee-amount').textContent = '+$' + fee.toFixed(2);
    document.getElementById('cc-total-amount').textContent = '$' + total.toFixed(2);
    btn.textContent = 'Charge $' + total.toFixed(2);
  } else {
    ccFee.style.display = 'none';
    const amount = document.getElementById('pay-amount');
    const raw = (amount.textContent || '$325').replace(/[^0-9.]/g, '');
    btn.textContent = 'Charge $' + parseFloat(raw || '325').toFixed(2);
  }
}

// ===== Assignment Mode System =====
let currentMode = 'both';

function setMode(m) {
  currentMode = m;
  ['individual','crew','both'].forEach(id => {
    document.getElementById('m-'+id).classList.toggle('on', id===m);
  });
  const hints = {
    individual: 'INDIVIDUAL MODE — Like pest control, HVAC, plumbing. One technician assigned per job. Dispatch board shows tech columns.',
    crew: 'CREW MODE — Like cleaning teams, lawn care crews. Named crews assigned to jobs. Dispatch board shows crew columns.',
    both: 'BOTH MODE — Like moving companies. Each job can be assigned to a crew OR individual tech. Tabbed selector on job cards.'
  };
  document.getElementById('mode-hint').textContent = hints[m];

  // Highlight assignment cards briefly
  document.querySelectorAll('.assign-card').forEach(el => {
    el.classList.add('highlight');
    setTimeout(() => el.classList.remove('highlight'), 1500);
  });

  renderAssignments();
}

function avatar(initials, color) {
  return `<div style="width:24px;height:24px;border-radius:50%;background:${color};color:white;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;flex-shrink:0;">${initials}</div>`;
}

function renderAssignments() {
  const m = currentMode;

  // ===== Job from Estimate — Assignment Card =====
  const jobEst = document.getElementById('assign-job-est');
  if (m === 'individual') {
    jobEst.innerHTML = `
      <div style="font-weight:600;margin-bottom:6px;">Assignment</div>
      <div class="fi"><span class="fi-l">Technician</span><select><option selected>Mike T.</option><option>Jake R.</option><option>Alex P.</option></select></div>
      <div style="display:flex;align-items:center;gap:6px;margin-top:6px;">
        ${avatar('MT','#3b82f6')}
        <div><div style="font-weight:500;">Mike Thompson</div><div style="font-size:11px;color:#64748b;">Lead Tech &bull; 4.9 rating</div></div>
      </div>
      <div class="fi" style="margin-top:6px;"><span class="fi-l">Dispatch</span><span class="badge" style="background:#fef3c7;color:#92400e;">Not Sent</span></div>
    `;
  } else if (m === 'crew') {
    jobEst.innerHTML = `
      <div style="font-weight:600;margin-bottom:6px;">Crew</div>
      <div class="fi"><span class="fi-l">Crew</span><select><option selected>Crew A — Mike's Team</option><option>Crew B — Jake's Team</option></select></div>
      <div style="display:flex;gap:4px;margin-top:6px;">
        ${avatar('MT','#3b82f6')}${avatar('JR','#8b5cf6')}
      </div>
      <div style="font-size:11px;color:#64748b;margin-top:4px;">Mike T. (lead), Jake R.</div>
      <div class="fi" style="margin-top:6px;"><span class="fi-l">Dispatch</span><span class="badge" style="background:#fef3c7;color:#92400e;">Not Sent</span></div>
    `;
  } else {
    jobEst.innerHTML = `
      <div style="font-weight:600;margin-bottom:6px;">Assignment</div>
      <div class="tog" style="margin-bottom:8px;">
        <button class="tog-b on" onclick="this.classList.add('on');this.nextElementSibling.classList.remove('on');document.getElementById('ae-crew').style.display='block';document.getElementById('ae-ind').style.display='none'">Crew</button>
        <button class="tog-b" onclick="this.classList.add('on');this.previousElementSibling.classList.remove('on');document.getElementById('ae-ind').style.display='block';document.getElementById('ae-crew').style.display='none'">Individual</button>
      </div>
      <div id="ae-crew">
        <div class="fi"><span class="fi-l">Crew</span><select><option selected>Crew A</option><option>Crew B</option></select></div>
        <div style="display:flex;gap:4px;margin-top:4px;">${avatar('MT','#3b82f6')}${avatar('JR','#8b5cf6')}</div>
        <div style="font-size:11px;color:#64748b;margin-top:4px;">Mike T. (lead), Jake R.</div>
      </div>
      <div id="ae-ind" style="display:none;">
        <div class="fi"><span class="fi-l">Tech</span><select><option selected>Mike T.</option><option>Jake R.</option><option>Alex P.</option></select></div>
        <div style="display:flex;align-items:center;gap:6px;margin-top:4px;">${avatar('MT','#3b82f6')}<span style="font-size:11px;color:#64748b;">Mike Thompson</span></div>
      </div>
      <div class="fi" style="margin-top:6px;"><span class="fi-l">Dispatch</span><span class="badge" style="background:#fef3c7;color:#92400e;">Not Sent</span></div>
    `;
  }

  // ===== Quick Book Job — Assignment Card =====
  const jobQuick = document.getElementById('assign-job-quick');
  if (m === 'individual') {
    jobQuick.innerHTML = `
      <div style="font-weight:600;margin-bottom:6px;">Assignment</div>
      <div class="fi"><span class="fi-l">Technician</span><select><option selected>Alex P.</option><option>Mike T.</option><option>Jake R.</option></select></div>
      <div style="display:flex;align-items:center;gap:6px;margin-top:6px;">
        ${avatar('AP','#f59e0b')}
        <div><div style="font-weight:500;">Alex Peterson</div><div style="font-size:11px;color:#64748b;">Pest Control &bull; Certified</div></div>
      </div>
      <div class="fi" style="margin-top:6px;"><span class="fi-l">Dispatch</span><span class="badge" style="background:#dcfce7;color:#166534;">Dispatched</span></div>
    `;
  } else if (m === 'crew') {
    jobQuick.innerHTML = `
      <div style="font-weight:600;margin-bottom:6px;">Crew</div>
      <div class="fi"><span class="fi-l">Crew</span><select><option selected>Alex's Unit</option><option>Crew A</option></select></div>
      <div style="display:flex;gap:4px;margin-top:6px;">${avatar('AP','#f59e0b')}</div>
      <div style="font-size:11px;color:#64748b;margin-top:4px;">Alex P. (solo crew)</div>
      <div class="fi" style="margin-top:6px;"><span class="fi-l">Dispatch</span><span class="badge" style="background:#dcfce7;color:#166534;">Dispatched</span></div>
    `;
  } else {
    jobQuick.innerHTML = `
      <div style="font-weight:600;margin-bottom:6px;">Assignment</div>
      <div class="tog" style="margin-bottom:8px;">
        <button class="tog-b" onclick="this.classList.add('on');this.nextElementSibling.classList.remove('on');document.getElementById('aq-crew').style.display='block';document.getElementById('aq-ind').style.display='none'">Crew</button>
        <button class="tog-b on" onclick="this.classList.add('on');this.previousElementSibling.classList.remove('on');document.getElementById('aq-ind').style.display='block';document.getElementById('aq-crew').style.display='none'">Individual</button>
      </div>
      <div id="aq-crew" style="display:none;">
        <div class="fi"><span class="fi-l">Crew</span><select><option selected>Alex's Unit</option></select></div>
        <div style="display:flex;gap:4px;margin-top:4px;">${avatar('AP','#f59e0b')}</div>
      </div>
      <div id="aq-ind">
        <div class="fi"><span class="fi-l">Tech</span><select><option selected>Alex P.</option><option>Mike T.</option></select></div>
        <div style="display:flex;align-items:center;gap:6px;margin-top:4px;">${avatar('AP','#f59e0b')}<span style="font-size:11px;color:#64748b;">Alex Peterson</span></div>
      </div>
      <div class="fi" style="margin-top:6px;"><span class="fi-l">Dispatch</span><span class="badge" style="background:#dcfce7;color:#166534;">Dispatched</span></div>
    `;
  }

  // ===== Quick Book Timeline dispatch entry =====
  const tlQuick = document.getElementById('tl-dispatch-quick');
  if (m === 'individual') {
    tlQuick.innerHTML = `<div class="dot" style="background:#2563eb;margin-top:4px;"></div><div><div>Dispatched to Alex P.</div><div style="font-size:11px;color:#94a3b8;">Feb 28</div></div>`;
  } else if (m === 'crew') {
    tlQuick.innerHTML = `<div class="dot" style="background:#2563eb;margin-top:4px;"></div><div><div>Dispatched to Alex's Unit</div><div style="font-size:11px;color:#94a3b8;">Feb 28</div></div>`;
  } else {
    tlQuick.innerHTML = `<div class="dot" style="background:#2563eb;margin-top:4px;"></div><div><div>Dispatched to Alex P.</div><div style="font-size:11px;color:#94a3b8;">Feb 28</div></div>`;
  }

  // ===== Recurring Job — Assignment in settings =====
  const recurRow = document.getElementById('recur-assign-row');
  if (m === 'individual') {
    recurRow.innerHTML = `<span class="fi-l">Technician</span><select><option selected>Sarah C.</option><option>Alex P.</option></select>`;
  } else if (m === 'crew') {
    recurRow.innerHTML = `<span class="fi-l">Crew</span><select><option selected>Sarah's Team</option><option>Crew A</option></select>`;
  } else {
    recurRow.innerHTML = `<span class="fi-l">Assigned</span><select><option selected>Sarah's Team (Crew)</option><option>Sarah C. (Individual)</option></select>`;
  }

  // ===== Recurring Job — Instance table =====
  const recurTable = document.getElementById('recur-instances');
  const assignLabel = m === 'individual' ? 'Technician' : m === 'crew' ? 'Crew' : 'Assigned';
  const instances = [
    { date: 'Mon, Feb 17', time: '9:00 AM', assign: m==='individual' ? 'Sarah C.' : "Sarah's Team", status: 'Scheduled', statusColor: 'background:#dbeafe;color:#1e40af' },
    { date: 'Mon, Feb 24', time: '9:00 AM', assign: m==='individual' ? 'Sarah C.' : "Sarah's Team", status: 'Scheduled', statusColor: 'background:#dbeafe;color:#1e40af' },
    { date: 'Mon, Mar 3', time: '9:00 AM', assign: m==='individual' ? '<select style="border:none;color:#2563eb;font-weight:500;background:none;font-size:13px;"><option>Sarah C.</option><option>Alex P.</option></select>' : m==='crew' ? '<select style="border:none;color:#2563eb;font-weight:500;background:none;font-size:13px;"><option>Sarah\'s Team</option><option>Crew A</option></select>' : '<select style="border:none;color:#2563eb;font-weight:500;background:none;font-size:13px;"><option>Sarah\'s Team</option><option>Sarah C.</option></select>', status: 'Pending', statusColor: 'background:#f1f5f9;color:#64748b' },
    { date: 'Mon, Mar 10', time: '9:00 AM', assign: m==='individual' ? 'Sarah C.' : "Sarah's Team", status: 'Pending', statusColor: 'background:#f1f5f9;color:#64748b' },
  ];
  recurTable.innerHTML = instances.map((inst, i) => `
    <tr style="${i < instances.length - 1 ? 'border-bottom:1px solid #f1f5f9;' : ''}">
      <td style="padding:8px 14px;font-weight:500;">${inst.date}</td>
      <td style="padding:8px 14px;">${inst.time}</td>
      <td style="padding:8px 14px;">${inst.assign}</td>
      <td style="padding:8px 14px;"><span class="badge" style="${inst.statusColor}">${inst.status}</span></td>
      <td style="padding:8px 14px;text-align:right;"><button class="b-ghost" style="font-size:11px;">Edit</button></td>
    </tr>
  `).join('');

  // ===== Jobs List — Assigned column =====
  document.querySelector('.assign-col-est1').innerHTML = m === 'individual'
    ? `<span style="display:flex;align-items:center;gap:4px;">${avatar('MT','#3b82f6')}<span>Mike T.</span></span>`
    : m === 'crew'
    ? `<span style="display:flex;align-items:center;gap:2px;">${avatar('MT','#3b82f6')}${avatar('JR','#8b5cf6')}<span style="margin-left:2px;">Crew A</span></span>`
    : `<span style="display:flex;align-items:center;gap:2px;">${avatar('MT','#3b82f6')}${avatar('JR','#8b5cf6')}<span style="margin-left:2px;">Crew A</span></span>`;

  document.querySelector('.assign-col-est2').innerHTML = m === 'individual'
    ? `<span style="display:flex;align-items:center;gap:4px;">${avatar('SC','#ec4899')}<span>Sarah C.</span></span>`
    : m === 'crew'
    ? `<span style="display:flex;align-items:center;gap:4px;">${avatar('SC','#ec4899')}<span>Sarah's Team</span></span>`
    : `<span style="display:flex;align-items:center;gap:4px;">${avatar('SC','#ec4899')}<span>Sarah's Team</span></span>`;

  document.querySelector('.assign-col-job42').innerHTML = m === 'individual'
    ? `<span style="display:flex;align-items:center;gap:4px;">${avatar('AP','#f59e0b')}<span>Alex P.</span></span>`
    : m === 'crew'
    ? `<span style="display:flex;align-items:center;gap:4px;">${avatar('AP','#f59e0b')}<span>Alex's Unit</span></span>`
    : `<span style="display:flex;align-items:center;gap:4px;">${avatar('AP','#f59e0b')}<span>Alex P.</span></span>`;

  // ===== Dispatch Board =====
  const board = document.getElementById('dispatch-board');
  if (m === 'individual') {
    board.style.display = 'grid';
    board.style.gridTemplateColumns = 'repeat(3,1fr)';
    board.style.gap = '10px';
    board.innerHTML = `
      <!-- Mike T. -->
      <div class="card" style="overflow:hidden;">
        <div style="background:#1e293b;color:white;padding:8px 12px;display:flex;align-items:center;gap:8px;">
          ${avatar('MT','#3b82f6')}
          <div><span style="font-weight:600;">Mike Thompson</span><div style="font-size:10px;opacity:0.7;">Lead Tech</div></div>
        </div>
        <div style="padding:8px;display:flex;flex-direction:column;gap:6px;">
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;cursor:pointer;" onclick="go('job-est')">
            <div style="display:flex;justify-content:space-between;"><span style="font-weight:600;">8:00 AM — John</span><span style="font-weight:600;">$425</span></div>
            <div style="color:#64748b;">Local Move &bull; Phoenix &rarr; Phoenix</div>
            <div style="margin-top:4px;"><span class="badge" style="background:#eff6ff;color:#2563eb;font-size:10px;">EST-001</span></div>
          </div>
        </div>
      </div>
      <!-- Sarah C. -->
      <div class="card" style="overflow:hidden;">
        <div style="background:#1e293b;color:white;padding:8px 12px;display:flex;align-items:center;gap:8px;">
          ${avatar('SC','#ec4899')}
          <div><span style="font-weight:600;">Sarah Chen</span><div style="font-size:10px;opacity:0.7;">Cleaning Specialist</div></div>
        </div>
        <div style="padding:8px;display:flex;flex-direction:column;gap:6px;">
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;cursor:pointer;" onclick="go('job-recur')">
            <div style="display:flex;justify-content:space-between;"><span style="font-weight:600;">9:00 AM — John</span><span style="font-weight:600;">$150</span></div>
            <div style="color:#64748b;">Weekly Cleaning</div>
            <div style="margin-top:4px;"><span class="badge" style="background:#f3e8ff;color:#7c3aed;font-size:10px;">Recurring</span></div>
          </div>
        </div>
      </div>
      <!-- Alex P. -->
      <div class="card" style="overflow:hidden;">
        <div style="background:#1e293b;color:white;padding:8px 12px;display:flex;align-items:center;gap:8px;">
          ${avatar('AP','#f59e0b')}
          <div><span style="font-weight:600;">Alex Peterson</span><div style="font-size:10px;opacity:0.7;">Pest Control</div></div>
        </div>
        <div style="padding:8px;display:flex;flex-direction:column;gap:6px;">
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;cursor:pointer;" onclick="go('job-quick')">
            <div style="display:flex;justify-content:space-between;"><span style="font-weight:600;">10:00 AM — John</span><span style="font-weight:600;">$75</span></div>
            <div style="color:#64748b;">Pest Spray</div>
            <div style="margin-top:4px;"><span class="badge" style="background:#f8fafc;color:#64748b;font-size:10px;">Quick Book</span></div>
          </div>
        </div>
      </div>
    `;
  } else if (m === 'crew') {
    board.style.display = 'grid';
    board.style.gridTemplateColumns = 'repeat(3,1fr)';
    board.style.gap = '10px';
    board.innerHTML = `
      <!-- Crew A -->
      <div class="card" style="overflow:hidden;">
        <div style="background:#1e293b;color:white;padding:8px 12px;display:flex;align-items:center;gap:8px;">
          <div style="display:flex;">${avatar('MT','#3b82f6')}<div style="margin-left:-6px;">${avatar('JR','#8b5cf6')}</div></div>
          <div><span style="font-weight:600;">Crew A — Mike's Team</span><div style="font-size:10px;opacity:0.7;">2 members</div></div>
        </div>
        <div style="padding:8px;display:flex;flex-direction:column;gap:6px;">
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;cursor:pointer;" onclick="go('job-est')">
            <div style="display:flex;justify-content:space-between;"><span style="font-weight:600;">8:00 AM — John</span><span style="font-weight:600;">$425</span></div>
            <div style="color:#64748b;">Local Move &bull; Phoenix &rarr; Phoenix</div>
            <div style="margin-top:4px;"><span class="badge" style="background:#eff6ff;color:#2563eb;font-size:10px;">EST-001</span></div>
          </div>
        </div>
      </div>
      <!-- Sarah's Team -->
      <div class="card" style="overflow:hidden;">
        <div style="background:#1e293b;color:white;padding:8px 12px;display:flex;align-items:center;gap:8px;">
          <div style="display:flex;">${avatar('SC','#ec4899')}<div style="margin-left:-6px;">${avatar('LM','#10b981')}</div></div>
          <div><span style="font-weight:600;">Sarah's Team</span><div style="font-size:10px;opacity:0.7;">2 members</div></div>
        </div>
        <div style="padding:8px;display:flex;flex-direction:column;gap:6px;">
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;cursor:pointer;" onclick="go('job-recur')">
            <div style="display:flex;justify-content:space-between;"><span style="font-weight:600;">9:00 AM — John</span><span style="font-weight:600;">$150</span></div>
            <div style="color:#64748b;">Weekly Cleaning</div>
            <div style="margin-top:4px;"><span class="badge" style="background:#f3e8ff;color:#7c3aed;font-size:10px;">Recurring</span></div>
          </div>
        </div>
      </div>
      <!-- Alex's Unit -->
      <div class="card" style="overflow:hidden;">
        <div style="background:#1e293b;color:white;padding:8px 12px;display:flex;align-items:center;gap:8px;">
          ${avatar('AP','#f59e0b')}
          <div><span style="font-weight:600;">Alex's Unit</span><div style="font-size:10px;opacity:0.7;">1 member</div></div>
        </div>
        <div style="padding:8px;display:flex;flex-direction:column;gap:6px;">
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;cursor:pointer;" onclick="go('job-quick')">
            <div style="display:flex;justify-content:space-between;"><span style="font-weight:600;">10:00 AM — John</span><span style="font-weight:600;">$75</span></div>
            <div style="color:#64748b;">Pest Spray</div>
            <div style="margin-top:4px;"><span class="badge" style="background:#f8fafc;color:#64748b;font-size:10px;">Quick Book</span></div>
          </div>
        </div>
      </div>
    `;
  } else {
    // BOTH mode - mix of crews and individuals
    board.style.display = 'grid';
    board.style.gridTemplateColumns = 'repeat(3,1fr)';
    board.style.gap = '10px';
    board.innerHTML = `
      <!-- Crew A (crew) -->
      <div class="card" style="overflow:hidden;">
        <div style="background:#1e293b;color:white;padding:8px 12px;display:flex;align-items:center;gap:8px;">
          <div style="display:flex;">${avatar('MT','#3b82f6')}<div style="margin-left:-6px;">${avatar('JR','#8b5cf6')}</div></div>
          <div><span style="font-weight:600;">Crew A — Mike's Team</span><div style="font-size:10px;opacity:0.7;">Crew &bull; 2 members</div></div>
        </div>
        <div style="padding:8px;display:flex;flex-direction:column;gap:6px;">
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;cursor:pointer;" onclick="go('job-est')">
            <div style="display:flex;justify-content:space-between;"><span style="font-weight:600;">8:00 AM — John</span><span style="font-weight:600;">$425</span></div>
            <div style="color:#64748b;">Local Move &bull; Phoenix &rarr; Phoenix</div>
            <div style="margin-top:4px;"><span class="badge" style="background:#eff6ff;color:#2563eb;font-size:10px;">EST-001</span> <span class="badge" style="background:#fef3c7;color:#92400e;font-size:10px;">Crew</span></div>
          </div>
        </div>
      </div>
      <!-- Sarah's Team (crew) -->
      <div class="card" style="overflow:hidden;">
        <div style="background:#1e293b;color:white;padding:8px 12px;display:flex;align-items:center;gap:8px;">
          <div style="display:flex;">${avatar('SC','#ec4899')}<div style="margin-left:-6px;">${avatar('LM','#10b981')}</div></div>
          <div><span style="font-weight:600;">Sarah's Team</span><div style="font-size:10px;opacity:0.7;">Crew &bull; 2 members</div></div>
        </div>
        <div style="padding:8px;display:flex;flex-direction:column;gap:6px;">
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;cursor:pointer;" onclick="go('job-recur')">
            <div style="display:flex;justify-content:space-between;"><span style="font-weight:600;">9:00 AM — John</span><span style="font-weight:600;">$150</span></div>
            <div style="color:#64748b;">Weekly Cleaning</div>
            <div style="margin-top:4px;"><span class="badge" style="background:#f3e8ff;color:#7c3aed;font-size:10px;">Recurring</span> <span class="badge" style="background:#fef3c7;color:#92400e;font-size:10px;">Crew</span></div>
          </div>
        </div>
      </div>
      <!-- Alex P. (individual) -->
      <div class="card" style="overflow:hidden;">
        <div style="background:#1e293b;color:white;padding:8px 12px;display:flex;align-items:center;gap:8px;">
          ${avatar('AP','#f59e0b')}
          <div><span style="font-weight:600;">Alex Peterson</span><div style="font-size:10px;opacity:0.7;">Individual</div></div>
        </div>
        <div style="padding:8px;display:flex;flex-direction:column;gap:6px;">
          <div style="border:1px solid #e2e8f0;border-radius:6px;padding:8px;cursor:pointer;" onclick="go('job-quick')">
            <div style="display:flex;justify-content:space-between;"><span style="font-weight:600;">10:00 AM — John</span><span style="font-weight:600;">$75</span></div>
            <div style="color:#64748b;">Pest Spray</div>
            <div style="margin-top:4px;"><span class="badge" style="background:#f8fafc;color:#64748b;font-size:10px;">Quick Book</span> <span class="badge" style="background:#eff6ff;color:#2563eb;font-size:10px;">Solo</span></div>
          </div>
        </div>
      </div>
    `;
  }
}

// Initialize on load
renderAssignments();
</script>
</body>
</html>
