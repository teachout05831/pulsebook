<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Full Flow: Estimate → Job → Contract</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f8fafc; margin: 0; color: #1e293b; }
    .card { background: white; border: 1px solid #e2e8f0; border-radius: 0.75rem; }
    .card-pad { padding: 1rem 1.25rem; }
    .fi { display: flex; align-items: center; justify-content: space-between; padding: 0.4rem 0; font-size: 0.8125rem; }
    .fi-label { color: #64748b; font-weight: 500; }
    .fi select { border: none; background: none; color: #2563eb; font-size: 0.8125rem; font-weight: 500; cursor: pointer; text-align: right; }
    .btn-sm { font-size: 0.75rem; font-weight: 500; padding: 0.375rem 0.75rem; border-radius: 0.375rem; cursor: pointer; display: inline-flex; align-items: center; gap: 0.375rem; transition: all 0.15s; border: none; }
    .btn-blue { background: #2563eb; color: white; }
    .btn-blue:hover { background: #1d4ed8; }
    .btn-green { background: #16a34a; color: white; }
    .btn-green:hover { background: #15803d; }
    .btn-out { background: white; color: #475569; border: 1px solid #e2e8f0 !important; }
    .btn-out:hover { background: #f1f5f9; }
    .btn-ghost { background: none; border: none; color: #64748b; cursor: pointer; font-size: 0.8125rem; }
    .btn-ghost:hover { color: #1e293b; }
    .ico-btn { width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border: 1px solid #e2e8f0; border-radius: 0.5rem; background: white; cursor: pointer; }
    .ico-btn:hover { background: #f1f5f9; }
    .sdot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
    .total-bar { background: #1e40af; color: white; border-radius: 0 0 0.75rem 0.75rem; padding: 0.75rem 1.25rem; margin-top: -1px; }
    .pr { display: flex; justify-content: space-between; padding: 0.375rem 0; font-size: 0.8125rem; }
    .pr a { color: #2563eb; text-decoration: none; }
    .pr .dash { color: #cbd5e1; }
    .tabs-main { display: flex; gap: 0; border-bottom: 2px solid #e2e8f0; overflow-x: auto; }
    .tab-main { padding: 0.75rem 1.25rem; font-size: 0.875rem; font-weight: 500; cursor: pointer; color: #94a3b8; border-bottom: 2px solid transparent; margin-bottom: -2px; white-space: nowrap; display: flex; align-items: center; gap: 0.5rem; }
    .tab-main.on { color: #2563eb; border-bottom-color: #2563eb; }
    .tabs-notes { display: flex; gap: 0; border-bottom: 1px solid #e2e8f0; }
    .tab-note { padding: 0.625rem 1rem; font-size: 0.8125rem; font-weight: 500; cursor: pointer; color: #94a3b8; border-bottom: 2px solid transparent; margin-bottom: -1px; }
    .tab-note.on { color: #1e293b; border-bottom-color: #1e293b; }
    .fade-in { animation: fadeIn 0.2s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
    .breadcrumb { display: flex; align-items: center; gap: 0.5rem; font-size: 0.8125rem; color: #64748b; margin-bottom: 0.75rem; }
    .breadcrumb a { color: #2563eb; text-decoration: none; cursor: pointer; }
    .breadcrumb a:hover { text-decoration: underline; }
    .breadcrumb .sep { color: #cbd5e1; }
    .flow-arrow { display: flex; align-items: center; justify-content: center; padding: 1rem 0; }
    .flow-arrow svg { color: #94a3b8; }
    .connector { width: 2px; height: 24px; background: #e2e8f0; margin: 0 auto; }
    .view { display: none; }
    .view.active { display: block; }
    @media (max-width: 1024px) {
      .layout-3 { grid-template-columns: 1fr !important; }
    }

    /* Flow diagram */
    .flow-box { border: 2px solid #e2e8f0; border-radius: 0.75rem; padding: 0.75rem 1rem; text-align: center; background: white; cursor: pointer; transition: all 0.15s; }
    .flow-box:hover { border-color: #2563eb; box-shadow: 0 2px 8px rgba(37,99,235,0.15); }
    .flow-box.active { border-color: #2563eb; background: #eff6ff; }
    .flow-box .label { font-size: 0.75rem; font-weight: 600; color: #1e293b; }
    .flow-box .sub { font-size: 0.625rem; color: #64748b; margin-top: 2px; }
    .flow-line { width: 40px; height: 2px; background: #e2e8f0; flex-shrink: 0; }

    /* Annotation callouts */
    .note-box { border: 2px dashed; border-radius: 0.5rem; padding: 0.75rem 1rem; margin-top: 1rem; }
    .note-box.blue { border-color: #3b82f6; background: #eff6ff; }
    .note-box.green { border-color: #16a34a; background: #f0fdf4; }
    .note-box.amber { border-color: #f59e0b; background: #fffbeb; }
    .note-box p { margin: 0; font-size: 0.8125rem; }
    .note-box .title { font-weight: 600; margin-bottom: 0.25rem; }
  </style>
</head>
<body>

  <!-- ===== CUSTOMER PAGE HEADER (always visible) ===== -->
  <div style="background:white;border-bottom:1px solid #e2e8f0;">
    <div style="max-width:1400px;margin:0 auto;padding:1rem 1.5rem;">
      <div class="flex items-center gap-3 mb-1">
        <a href="#" style="color:#64748b;font-size:0.8125rem;text-decoration:none;">&larr; Back to My Leads</a>
      </div>
      <div class="flex flex-wrap items-center justify-between gap-3 mb-2">
        <div class="flex items-center gap-3">
          <div style="width:44px;height:44px;border-radius:50%;background:#2563eb;color:white;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1.125rem;">J</div>
          <div>
            <div class="flex items-center gap-2">
              <h1 style="font-size:1.25rem;font-weight:700;margin:0;">John</h1>
              <span style="font-size:0.6875rem;background:#dbeafe;color:#2563eb;padding:2px 8px;border-radius:9999px;font-weight:600;">Lead</span>
            </div>
            <div style="font-size:0.75rem;color:#64748b;display:flex;gap:1rem;">
              <span>6029030482</span>
              <span>teachout05@gmail.com</span>
            </div>
          </div>
        </div>
        <div class="flex items-center gap-2 flex-wrap">
          <button class="btn-sm btn-out">Edit</button>
          <button class="btn-sm btn-blue" style="font-weight:600;">+New Job</button>
        </div>
      </div>

      <!-- Customer Tabs -->
      <div class="tabs-main" id="mainTabs">
        <div class="tab-main" onclick="switchMainTab('overview')">Overview</div>
        <div class="tab-main" onclick="switchMainTab('sales')">Sales</div>
        <div class="tab-main on" id="tab-estimates" onclick="switchMainTab('estimates')">Estimates <span style="background:#dbeafe;color:#2563eb;font-size:0.625rem;padding:1px 6px;border-radius:9999px;">2</span></div>
        <div class="tab-main" id="tab-jobs" onclick="switchMainTab('jobs')">Jobs <span style="background:#dbeafe;color:#2563eb;font-size:0.625rem;padding:1px 6px;border-radius:9999px;">1</span></div>
        <div class="tab-main" onclick="switchMainTab('invoices')">Invoices</div>
        <div class="tab-main" onclick="switchMainTab('files')">Files</div>
        <div class="tab-main" onclick="switchMainTab('notes')">Notes</div>
      </div>
    </div>
  </div>

  <!-- ===== CONTENT AREA ===== -->
  <div style="max-width:1400px;margin:0 auto;padding:1.5rem;">

    <!-- ============================================ -->
    <!-- FLOW DIAGRAM (shows at top of estimates tab) -->
    <!-- ============================================ -->
    <div id="flow-diagram" style="margin-bottom:1.5rem;">
      <div class="card card-pad">
        <div style="font-size:0.75rem;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.75rem;">Customer Lifecycle &mdash; Click any step to see that view</div>
        <div style="display:flex;align-items:center;gap:0;overflow-x:auto;padding-bottom:0.5rem;">
          <div class="flow-box active" id="fb-list" onclick="goTo('estimate-list')" style="min-width:120px;">
            <div class="label">Estimates</div>
            <div class="sub">List &amp; create</div>
          </div>
          <div class="flow-line"></div>
          <div class="flow-box" id="fb-detail" onclick="goTo('estimate-detail')" style="min-width:120px;">
            <div class="label">Estimate Detail</div>
            <div class="sub">V3 inline editor</div>
          </div>
          <div class="flow-line"></div>
          <div class="flow-box" id="fb-page" onclick="goTo('estimate-page')" style="min-width:130px;">
            <div class="label">Estimate Page</div>
            <div class="sub">Branded proposal</div>
          </div>
          <div class="flow-line"></div>
          <div class="flow-box" id="fb-approve" onclick="goTo('approval')" style="min-width:120px;">
            <div class="label">Customer Approves</div>
            <div class="sub">Signs &amp; deposits</div>
          </div>
          <div class="flow-line"></div>
          <div class="flow-box" id="fb-job" onclick="goTo('job-detail')" style="min-width:120px;">
            <div class="label">Job Created</div>
            <div class="sub">Scheduled &amp; assigned</div>
          </div>
          <div class="flow-line"></div>
          <div class="flow-box" id="fb-contract" onclick="goTo('contract')" style="min-width:130px;">
            <div class="label">Contract</div>
            <div class="sub">Sign, track, pay</div>
          </div>
          <div class="flow-line"></div>
          <div class="flow-box" id="fb-invoice" onclick="goTo('invoice')" style="min-width:110px;">
            <div class="label">Invoice</div>
            <div class="sub">Final billing</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ========================================= -->
    <!-- VIEW 1: ESTIMATE LIST                     -->
    <!-- ========================================= -->
    <div class="view active fade-in" id="v-estimate-list">
      <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
        <div>
          <h2 style="font-size:1.125rem;font-weight:600;margin:0;">Estimates</h2>
          <p style="font-size:0.8125rem;color:#64748b;margin:0.25rem 0 0;">2 total estimates</p>
        </div>
        <button class="btn-sm btn-blue" style="font-weight:600;padding:0.5rem 1rem;">+ Create Estimate</button>
      </div>

      <!-- Stats row -->
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1.5rem;">
        <div class="card card-pad"><div style="font-size:0.8125rem;color:#64748b;">Total</div><div style="font-size:1.5rem;font-weight:700;">2</div></div>
        <div class="card card-pad"><div style="font-size:0.8125rem;color:#64748b;">Pending</div><div style="font-size:1.5rem;font-weight:700;color:#d97706;">1</div></div>
        <div class="card card-pad"><div style="font-size:0.8125rem;color:#64748b;">Approved Value</div><div style="font-size:1.5rem;font-weight:700;color:#16a34a;">$850.00</div></div>
        <div class="card card-pad"><div style="font-size:0.8125rem;color:#64748b;">Conversion Rate</div><div style="font-size:1.5rem;font-weight:700;">50%</div></div>
      </div>

      <!-- Table -->
      <div class="card" style="overflow:hidden;">
        <table style="width:100%;border-collapse:collapse;font-size:0.8125rem;">
          <thead><tr style="background:#f8fafc;border-bottom:1px solid #e2e8f0;">
            <th style="text-align:left;padding:0.625rem 1.25rem;color:#64748b;font-weight:500;">Estimate #</th>
            <th style="text-align:left;padding:0.625rem 1.25rem;color:#64748b;font-weight:500;">Date</th>
            <th style="text-align:left;padding:0.625rem 1.25rem;color:#64748b;font-weight:500;">Amount</th>
            <th style="text-align:left;padding:0.625rem 1.25rem;color:#64748b;font-weight:500;">Status</th>
            <th style="text-align:left;padding:0.625rem 1.25rem;color:#64748b;font-weight:500;">Page</th>
            <th style="padding:0.625rem 1.25rem;"></th>
          </tr></thead>
          <tbody>
            <tr style="border-bottom:1px solid #f1f5f9;cursor:pointer;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''" onclick="goTo('estimate-detail')">
              <td style="padding:0.75rem 1.25rem;font-weight:600;">EST-001</td>
              <td style="padding:0.75rem 1.25rem;">Jan 15, 2026</td>
              <td style="padding:0.75rem 1.25rem;font-weight:600;">$425.00</td>
              <td style="padding:0.75rem 1.25rem;"><span style="font-size:0.6875rem;background:#fef3c7;color:#92400e;padding:2px 8px;border-radius:9999px;font-weight:600;">Sent</span></td>
              <td style="padding:0.75rem 1.25rem;"><span style="font-size:0.6875rem;background:#dbeafe;color:#1e40af;padding:2px 8px;border-radius:9999px;font-weight:500;">Published</span></td>
              <td style="padding:0.75rem 1.25rem;text-align:right;"><button class="btn-ghost" onclick="event.stopPropagation();goTo('estimate-detail')">View</button></td>
            </tr>
            <tr style="cursor:pointer;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">
              <td style="padding:0.75rem 1.25rem;font-weight:600;">EST-002</td>
              <td style="padding:0.75rem 1.25rem;">Jan 20, 2026</td>
              <td style="padding:0.75rem 1.25rem;font-weight:600;">$850.00</td>
              <td style="padding:0.75rem 1.25rem;"><span style="font-size:0.6875rem;background:#dcfce7;color:#166534;padding:2px 8px;border-radius:9999px;font-weight:600;">Approved</span></td>
              <td style="padding:0.75rem 1.25rem;"><span style="font-size:0.6875rem;background:#dcfce7;color:#166534;padding:2px 8px;border-radius:9999px;font-weight:500;">Signed</span></td>
              <td style="padding:0.75rem 1.25rem;text-align:right;"><button class="btn-ghost">View</button></td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="note-box blue">
        <p class="title">Step 1: Estimate List</p>
        <p>This is where you see all estimates for this customer. Click a row to open the full V3 inline detail. The "Page" column shows if a branded estimate page exists and its status.</p>
      </div>
    </div>

    <!-- ========================================= -->
    <!-- VIEW 2: ESTIMATE DETAIL (V3 inline)       -->
    <!-- ========================================= -->
    <div class="view fade-in" id="v-estimate-detail">
      <div class="breadcrumb">
        <a onclick="goTo('estimate-list')">Estimates</a>
        <span class="sep">/</span>
        <span>EST-001</span>
      </div>

      <!-- Estimate Header -->
      <div class="card" style="padding:1rem 1.25rem;margin-bottom:1rem;">
        <div class="flex flex-wrap items-center justify-between gap-2 mb-1">
          <div class="flex items-center gap-2">
            <h2 style="font-size:1.125rem;font-weight:700;margin:0;">John</h2>
            <span style="font-size:0.6875rem;color:#16a34a;font-weight:600;background:#f0fdf4;padding:2px 8px;border-radius:9999px;">Opportunity</span>
          </div>
        </div>
        <div style="font-size:0.75rem;color:#64748b;margin-bottom:0.75rem;">6029030482 &bull; teachout05@gmail.com</div>
        <div class="flex flex-wrap items-center justify-between gap-3">
          <div class="flex items-center gap-3">
            <h1 style="font-size:1.25rem;font-weight:700;margin:0;">Estimate #EST-001</h1>
            <span style="font-size:0.6875rem;color:#64748b;">Jan 15, 2026</span>
          </div>
          <div class="flex items-center gap-2">
            <button class="ico-btn" title="Documents"><svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg></button>
            <button class="ico-btn" title="History"><svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></button>
            <button class="btn-sm btn-green" onclick="goTo('estimate-page')">Send Estimate Page</button>
            <button class="btn-sm btn-green" onclick="goTo('job-detail')">Book &darr;</button>
          </div>
        </div>
      </div>

      <!-- 3-Column Layout (compact version) -->
      <div class="layout-3" style="display:grid;grid-template-columns:230px 1fr 280px;gap:1rem;align-items:start;">

        <!-- LEFT -->
        <div style="display:flex;flex-direction:column;gap:1rem;">
          <div class="card card-pad">
            <div style="font-size:0.8125rem;font-weight:600;margin-bottom:0.5rem;">Quote Info</div>
            <div class="fi"><span class="fi-label">Number</span><span style="font-weight:600;">EST-001</span></div>
            <div class="fi"><span class="fi-label">Type</span><select><option selected>Local</option></select></div>
            <div class="fi"><span class="fi-label">Source</span><select><option selected>Website</option></select></div>
            <div class="fi"><span class="fi-label">Sales</span><select><option selected>Daniela</option></select></div>
            <div class="fi"><span class="fi-label">Estimator</span><select><option>Unassigned</option></select></div>
            <div class="fi"><span class="fi-label">Tags</span><a href="#" style="color:#2563eb;font-size:0.8125rem;">+</a></div>
          </div>
          <div class="card card-pad">
            <div class="flex items-center justify-between mb-2">
              <span style="font-size:0.8125rem;font-weight:600;">Tasks</span>
              <a href="#" style="color:#2563eb;font-size:0.75rem;">+</a>
            </div>
            <p style="text-align:center;color:#94a3b8;font-size:0.75rem;padding:0.5rem 0;">No tasks yet</p>
          </div>
        </div>

        <!-- CENTER -->
        <div style="display:flex;flex-direction:column;gap:1rem;">
          <!-- Jobs Card — THIS IS THE CONNECTION -->
          <div class="card card-pad">
            <div class="flex items-center justify-between mb-3">
              <span style="font-size:0.875rem;font-weight:600;">Jobs</span>
              <a href="#" style="color:#2563eb;font-size:0.75rem;" onclick="event.preventDefault();goTo('job-detail')">+ Add Job</a>
            </div>
            <div style="border:2px dashed #e2e8f0;border-radius:0.5rem;padding:1.5rem;text-align:center;">
              <p style="color:#94a3b8;font-size:0.8125rem;margin:0 0 0.5rem;">No jobs linked yet</p>
              <button class="btn-sm btn-blue" onclick="goTo('job-detail')">Create Job from Estimate</button>
            </div>
          </div>

          <!-- Stops -->
          <div class="card card-pad">
            <div class="flex items-center gap-3 mb-3">
              <span style="font-size:0.875rem;font-weight:600;">Stops</span>
              <a href="#" style="color:#2563eb;font-size:0.75rem;">+</a>
            </div>
            <div style="display:flex;align-items:center;gap:0.75rem;padding:0.5rem 0;border-bottom:1px solid #f1f5f9;">
              <span class="sdot" style="background:#3b82f6;"></span>
              <span style="font-size:0.8125rem;color:#2563eb;font-weight:500;width:80px;">Origin</span>
              <span style="font-size:0.8125rem;">Phoenix, AZ 85015</span>
            </div>
            <div style="display:flex;align-items:center;gap:0.75rem;padding:0.5rem 0;">
              <span class="sdot" style="background:#16a34a;"></span>
              <span style="font-size:0.8125rem;color:#2563eb;font-weight:500;width:80px;">Destination</span>
              <span style="font-size:0.8125rem;">Phoenix, AZ 85041</span>
            </div>
          </div>

          <!-- Notes -->
          <div class="card">
            <div class="tabs-notes">
              <div class="tab-note on">Internal</div>
              <div class="tab-note">Customer</div>
              <div class="tab-note">Crew</div>
            </div>
            <div style="padding:1rem 1.25rem;">
              <textarea style="width:100%;min-height:80px;border:1px solid #e2e8f0;border-radius:0.5rem;padding:0.75rem;font-size:0.875rem;resize:vertical;">2 bedroom apartment move, 1st to 2nd floor</textarea>
            </div>
          </div>
        </div>

        <!-- RIGHT -->
        <div style="display:flex;flex-direction:column;gap:1rem;">
          <div class="card card-pad">
            <div style="font-size:0.8125rem;font-weight:600;margin-bottom:0.75rem;">Resources</div>
            <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:0.5rem;text-align:center;">
              <div style="background:#f8fafc;border-radius:0.375rem;padding:0.5rem;"><div style="font-size:0.625rem;color:#64748b;text-transform:uppercase;">Trucks</div><div style="font-size:1rem;font-weight:700;">1</div></div>
              <div style="background:#f8fafc;border-radius:0.375rem;padding:0.5rem;"><div style="font-size:0.625rem;color:#64748b;text-transform:uppercase;">Team</div><div style="font-size:1rem;font-weight:700;">2</div></div>
              <div style="background:#f8fafc;border-radius:0.375rem;padding:0.5rem;"><div style="font-size:0.625rem;color:#64748b;text-transform:uppercase;">Hours</div><div style="font-size:1rem;font-weight:700;">2h</div></div>
              <div style="background:#f0fdf4;border-radius:0.375rem;padding:0.5rem;"><div style="font-size:0.625rem;color:#16a34a;text-transform:uppercase;">Rate</div><div style="font-size:1rem;font-weight:700;color:#16a34a;">$150/hr</div></div>
            </div>
          </div>
          <div class="card">
            <div class="card-pad">
              <div class="pr"><a href="#">Moving Services</a><span style="font-weight:500;">$300.00</span></div>
              <div class="pr"><a href="#">Trip Fee</a><span style="font-weight:500;">$125.00</span></div>
              <div style="border-top:1px solid #e2e8f0;margin:0.5rem 0;"></div>
              <div class="pr"><span style="font-weight:600;">Balance</span><span style="font-weight:700;">$425.00</span></div>
            </div>
            <div class="total-bar">
              <div style="display:flex;justify-content:space-between;align-items:baseline;">
                <span style="font-weight:600;">Estimated Price:</span>
                <span style="font-size:1.25rem;font-weight:700;">$425.00</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Estimate Page Connection -->
      <div class="card card-pad" style="margin-top:1rem;">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <div>
            <div style="font-size:0.875rem;font-weight:600;">Estimate Page (Branded Proposal)</div>
            <div style="font-size:0.75rem;color:#64748b;">The customer-facing proposal with approval, payment &amp; signature</div>
          </div>
          <div class="flex items-center gap-2">
            <span style="font-size:0.6875rem;background:#dbeafe;color:#1e40af;padding:2px 8px;border-radius:9999px;font-weight:500;">Published</span>
            <button class="btn-sm btn-out" onclick="goTo('estimate-page')">Preview Page</button>
            <button class="btn-sm btn-blue" onclick="goTo('estimate-page')">Edit in Builder</button>
          </div>
        </div>
      </div>

      <div class="note-box blue">
        <p class="title">Step 2: Estimate Detail (V3 Inline)</p>
        <p>This is the full V3 estimate editor, rendered inline within the customer page. The <b>Jobs card</b> in the center column is the bridge — it shows "No jobs linked" until you book it. The <b>Estimate Page</b> bar at the bottom connects to the branded proposal the customer sees.</p>
        <p style="margin-top:0.5rem;"><b>Two paths forward:</b> "Send Estimate Page" → sends the branded proposal to the customer. "Book" → creates a job directly.</p>
      </div>
    </div>

    <!-- ========================================= -->
    <!-- VIEW 3: ESTIMATE PAGE (branded proposal)  -->
    <!-- ========================================= -->
    <div class="view fade-in" id="v-estimate-page">
      <div class="breadcrumb">
        <a onclick="goTo('estimate-list')">Estimates</a>
        <span class="sep">/</span>
        <a onclick="goTo('estimate-detail')">EST-001</a>
        <span class="sep">/</span>
        <span>Estimate Page</span>
      </div>

      <div class="card" style="overflow:hidden;">
        <!-- Page Builder preview -->
        <div style="background:#1e293b;color:white;padding:0.75rem 1.25rem;display:flex;align-items:center;justify-content:space-between;">
          <div class="flex items-center gap-3">
            <span style="font-size:0.875rem;font-weight:600;">Estimate Page Builder</span>
            <span style="font-size:0.6875rem;background:rgba(255,255,255,0.15);padding:2px 8px;border-radius:4px;">EST-001</span>
          </div>
          <div class="flex items-center gap-2">
            <button class="btn-sm" style="background:rgba(255,255,255,0.15);color:white;border:none;">Preview</button>
            <button class="btn-sm" style="background:#2563eb;color:white;border:none;">Publish & Send</button>
          </div>
        </div>

        <!-- Simulated page builder sections -->
        <div style="padding:2rem;background:#f8fafc;">
          <div style="max-width:700px;margin:0 auto;">
            <!-- Hero section -->
            <div class="card" style="overflow:hidden;margin-bottom:1rem;">
              <div style="background:linear-gradient(135deg,#1e40af,#3b82f6);padding:2.5rem 2rem;text-align:center;color:white;">
                <div style="font-size:0.75rem;text-transform:uppercase;letter-spacing:0.1em;opacity:0.8;margin-bottom:0.5rem;">Your Moving Estimate</div>
                <div style="font-size:1.5rem;font-weight:700;">$425.00</div>
                <div style="font-size:0.875rem;margin-top:0.5rem;opacity:0.9;">Local Move &bull; 2 Movers &bull; 2 Hours</div>
              </div>
            </div>

            <!-- Pricing section preview -->
            <div class="card card-pad" style="margin-bottom:1rem;">
              <div style="font-size:0.875rem;font-weight:600;margin-bottom:0.75rem;">Pricing Breakdown</div>
              <div class="pr"><span>Moving Services (2 movers × 2 hrs × $150/hr)</span><span style="font-weight:500;">$300.00</span></div>
              <div class="pr"><span>Trip Fee</span><span style="font-weight:500;">$125.00</span></div>
              <div style="border-top:1px solid #e2e8f0;margin:0.5rem 0;"></div>
              <div class="pr"><span style="font-weight:700;">Total</span><span style="font-weight:700;font-size:1rem;">$425.00</span></div>
            </div>

            <!-- Approval section preview -->
            <div class="card card-pad" style="margin-bottom:1rem;border-color:#16a34a;">
              <div style="text-align:center;">
                <div style="font-size:0.875rem;font-weight:600;margin-bottom:0.75rem;">Ready to Book?</div>
                <div style="display:flex;gap:0.75rem;justify-content:center;">
                  <button class="btn-sm btn-green" style="padding:0.625rem 2rem;font-size:0.875rem;" onclick="goTo('approval')">Approve & Sign</button>
                  <button class="btn-sm btn-out" style="padding:0.625rem 1.5rem;">Request Changes</button>
                </div>
                <div style="font-size:0.6875rem;color:#64748b;margin-top:0.5rem;">Deposit: $100 due upon approval</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="note-box amber">
        <p class="title">Step 3: Estimate Page (Branded Proposal)</p>
        <p>This is the <b>customer-facing page</b> built with the Page Builder. It has sections (hero, pricing, gallery, testimonials, approval, etc.). The customer gets a link like <code>/e/abc123</code>, views the proposal, and can approve + pay deposit right here.</p>
        <p style="margin-top:0.5rem;">The estimate page is <b>linked to the estimate</b> via <code>estimate.pageId</code>. One estimate = one branded page.</p>
      </div>
    </div>

    <!-- ========================================= -->
    <!-- VIEW 4: CUSTOMER APPROVAL                 -->
    <!-- ========================================= -->
    <div class="view fade-in" id="v-approval">
      <div class="breadcrumb">
        <a onclick="goTo('estimate-list')">Estimates</a>
        <span class="sep">/</span>
        <a onclick="goTo('estimate-detail')">EST-001</a>
        <span class="sep">/</span>
        <span>Customer Approved</span>
      </div>

      <div class="card card-pad" style="max-width:600px;margin:0 auto;">
        <div style="text-align:center;padding:1.5rem 0;">
          <div style="width:64px;height:64px;border-radius:50%;background:#dcfce7;display:flex;align-items:center;justify-content:center;margin:0 auto 1rem;">
            <svg width="32" height="32" fill="none" stroke="#16a34a" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
          </div>
          <h2 style="font-size:1.25rem;font-weight:700;margin:0 0 0.5rem;">Customer Approved!</h2>
          <p style="color:#64748b;font-size:0.875rem;margin:0 0 1.5rem;">John approved estimate EST-001 and paid a $100 deposit</p>

          <div style="background:#f8fafc;border-radius:0.5rem;padding:1rem;text-align:left;margin-bottom:1.5rem;">
            <div class="fi"><span class="fi-label">Estimate</span><span style="font-weight:600;">EST-001 — $425.00</span></div>
            <div class="fi"><span class="fi-label">Deposit Paid</span><span style="font-weight:600;color:#16a34a;">$100.00</span></div>
            <div class="fi"><span class="fi-label">Remaining</span><span style="font-weight:600;">$325.00</span></div>
            <div class="fi"><span class="fi-label">Approved At</span><span>Jan 16, 2026 2:34 PM</span></div>
            <div class="fi"><span class="fi-label">Signature</span><span style="color:#16a34a;font-weight:500;">&#10003; Signed</span></div>
          </div>

          <div style="font-size:0.875rem;font-weight:600;margin-bottom:0.75rem;">What happens next?</div>
          <div style="display:flex;flex-direction:column;gap:0.5rem;text-align:left;font-size:0.8125rem;">
            <div style="display:flex;gap:0.5rem;align-items:flex-start;">
              <span style="color:#16a34a;font-weight:700;flex-shrink:0;">1.</span>
              <span>Estimate status changes to <b>Approved</b></span>
            </div>
            <div style="display:flex;gap:0.5rem;align-items:flex-start;">
              <span style="color:#16a34a;font-weight:700;flex-shrink:0;">2.</span>
              <span><b>Job is auto-created</b> from the estimate (prefilled with line items, addresses, notes)</span>
            </div>
            <div style="display:flex;gap:0.5rem;align-items:flex-start;">
              <span style="color:#16a34a;font-weight:700;flex-shrink:0;">3.</span>
              <span>Estimate's <b>jobId</b> links to the new job (shown in Jobs card)</span>
            </div>
            <div style="display:flex;gap:0.5rem;align-items:flex-start;">
              <span style="color:#16a34a;font-weight:700;flex-shrink:0;">4.</span>
              <span>Job appears in <b>Dispatch Board</b> for scheduling &amp; crew assignment</span>
            </div>
          </div>

          <div style="margin-top:1.5rem;">
            <button class="btn-sm btn-blue" style="padding:0.5rem 1.5rem;" onclick="goTo('job-detail')">View Created Job &rarr;</button>
          </div>
        </div>
      </div>

      <div class="note-box green">
        <p class="title">Step 4: Approval → Job Creation</p>
        <p>When the customer approves the estimate page, the system auto-creates a Job. The estimate's <code>jobId</code> field gets set, linking them together. The job inherits line items, addresses, notes, and customer info from the estimate.</p>
      </div>
    </div>

    <!-- ========================================= -->
    <!-- VIEW 5: JOB DETAIL                        -->
    <!-- ========================================= -->
    <div class="view fade-in" id="v-job-detail">
      <div class="breadcrumb">
        <a onclick="goTo('estimate-list')">Estimates</a>
        <span class="sep">/</span>
        <a onclick="goTo('estimate-detail')">EST-001</a>
        <span class="sep">/</span>
        <span>Job EST-001-1</span>
      </div>

      <!-- Job Header -->
      <div class="card" style="padding:1rem 1.25rem;margin-bottom:1rem;">
        <div class="flex flex-wrap items-center justify-between gap-3 mb-2">
          <div>
            <div class="flex items-center gap-2 mb-1">
              <h1 style="font-size:1.25rem;font-weight:700;margin:0;">Job EST-001-1</h1>
              <span style="font-size:0.6875rem;background:#dbeafe;color:#1e40af;padding:2px 8px;border-radius:9999px;font-weight:600;">Scheduled</span>
            </div>
            <div style="font-size:0.75rem;color:#64748b;">Local Move &bull; Feb 27, 2026 at 8:00 AM</div>
          </div>
          <div class="flex items-center gap-2">
            <button class="btn-sm btn-out">Edit</button>
            <button class="btn-sm btn-out" onclick="goTo('contract')">Create Contract</button>
            <button class="btn-sm btn-green">Dispatch</button>
          </div>
        </div>

        <!-- Link back to estimate -->
        <div style="background:#eff6ff;border-radius:0.5rem;padding:0.625rem 1rem;display:flex;align-items:center;justify-content:space-between;">
          <div style="font-size:0.8125rem;">
            <span style="color:#64748b;">From Estimate:</span>
            <a href="#" onclick="event.preventDefault();goTo('estimate-detail')" style="color:#2563eb;font-weight:600;text-decoration:none;margin-left:0.25rem;">EST-001</a>
            <span style="color:#64748b;margin-left:0.5rem;">$425.00</span>
            <span style="font-size:0.6875rem;background:#dcfce7;color:#166534;padding:1px 6px;border-radius:9999px;margin-left:0.5rem;">Approved</span>
          </div>
          <a href="#" onclick="event.preventDefault();goTo('estimate-detail')" style="color:#2563eb;font-size:0.75rem;text-decoration:none;">View Estimate &rarr;</a>
        </div>
      </div>

      <!-- Job Content 2-col -->
      <div style="display:grid;grid-template-columns:1fr 320px;gap:1rem;align-items:start;">
        <!-- Left: Job Info -->
        <div style="display:flex;flex-direction:column;gap:1rem;">
          <!-- Assignment -->
          <div class="card card-pad">
            <div style="font-size:0.875rem;font-weight:600;margin-bottom:0.75rem;">Assignment</div>
            <div class="fi"><span class="fi-label">Crew</span><select><option selected>Crew A - Mike's Team</option></select></div>
            <div class="fi"><span class="fi-label">Truck</span><span>Truck #3 (26ft)</span></div>
            <div class="fi"><span class="fi-label">Dispatch Status</span><span style="color:#f59e0b;font-weight:500;">Not Dispatched</span></div>
          </div>

          <!-- Addresses (from estimate) -->
          <div class="card card-pad">
            <div style="font-size:0.875rem;font-weight:600;margin-bottom:0.75rem;">Addresses</div>
            <div style="display:flex;align-items:center;gap:0.75rem;padding:0.5rem 0;border-bottom:1px solid #f1f5f9;">
              <span class="sdot" style="background:#3b82f6;"></span>
              <div><div style="font-size:0.8125rem;font-weight:500;">Origin</div><div style="font-size:0.75rem;color:#64748b;">Phoenix, AZ 85015 &bull; Apartment, 1st floor</div></div>
            </div>
            <div style="display:flex;align-items:center;gap:0.75rem;padding:0.5rem 0;">
              <span class="sdot" style="background:#16a34a;"></span>
              <div><div style="font-size:0.8125rem;font-weight:500;">Destination</div><div style="font-size:0.75rem;color:#64748b;">Phoenix, AZ 85041 &bull; Apartment, 2nd floor</div></div>
            </div>
          </div>

          <!-- Line Items (from estimate) -->
          <div class="card card-pad">
            <div style="font-size:0.875rem;font-weight:600;margin-bottom:0.75rem;">Line Items <span style="font-size:0.6875rem;color:#64748b;font-weight:400;">(from estimate)</span></div>
            <div class="pr"><span>Moving Services (2 movers × 2 hrs)</span><span style="font-weight:500;">$300.00</span></div>
            <div class="pr"><span>Trip Fee</span><span style="font-weight:500;">$125.00</span></div>
            <div style="border-top:1px solid #e2e8f0;margin:0.5rem 0;"></div>
            <div class="pr"><span style="font-weight:600;">Total</span><span style="font-weight:700;">$425.00</span></div>
            <div class="pr"><span style="color:#16a34a;">Deposit Paid</span><span style="color:#16a34a;font-weight:500;">-$100.00</span></div>
            <div class="pr"><span style="font-weight:700;">Balance Due</span><span style="font-weight:700;">$325.00</span></div>
          </div>

          <!-- Notes (from estimate) -->
          <div class="card card-pad">
            <div style="font-size:0.875rem;font-weight:600;margin-bottom:0.5rem;">Crew Notes</div>
            <div style="font-size:0.8125rem;color:#475569;background:#f8fafc;padding:0.75rem;border-radius:0.375rem;">
              2 bedroom apartment move, 1st to 2nd floor. No appliances. Boxes and furniture only. Narrow staircase at destination.
            </div>
          </div>
        </div>

        <!-- Right: Contracts & Documents -->
        <div style="display:flex;flex-direction:column;gap:1rem;">
          <!-- Contracts -->
          <div class="card card-pad">
            <div class="flex items-center justify-between mb-3">
              <span style="font-size:0.875rem;font-weight:600;">Contracts</span>
              <button class="btn-sm btn-out" onclick="goTo('contract')">+ Create</button>
            </div>
            <div style="border:1px solid #e2e8f0;border-radius:0.5rem;padding:0.75rem;margin-bottom:0.5rem;cursor:pointer;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''" onclick="goTo('contract')">
              <div class="flex items-center justify-between">
                <span style="font-size:0.8125rem;font-weight:500;">Hourly Contract</span>
                <span style="font-size:0.6875rem;background:#fef3c7;color:#92400e;padding:1px 6px;border-radius:9999px;">Sent</span>
              </div>
              <div style="font-size:0.6875rem;color:#64748b;margin-top:2px;">Sent Jan 17 &bull; Awaiting signature</div>
            </div>
            <div style="border:1px dashed #e2e8f0;border-radius:0.5rem;padding:0.75rem;text-align:center;color:#94a3b8;font-size:0.75rem;">
              + Add another contract
            </div>
          </div>

          <!-- Job Timeline -->
          <div class="card card-pad">
            <div style="font-size:0.875rem;font-weight:600;margin-bottom:0.75rem;">Timeline</div>
            <div style="display:flex;flex-direction:column;gap:0.625rem;">
              <div style="display:flex;gap:0.625rem;font-size:0.8125rem;">
                <span style="width:8px;height:8px;border-radius:50%;background:#16a34a;margin-top:5px;flex-shrink:0;"></span>
                <div><div>Job created from estimate</div><div style="font-size:0.6875rem;color:#94a3b8;">Jan 16, 2026</div></div>
              </div>
              <div style="display:flex;gap:0.625rem;font-size:0.8125rem;">
                <span style="width:8px;height:8px;border-radius:50%;background:#3b82f6;margin-top:5px;flex-shrink:0;"></span>
                <div><div>Contract sent to customer</div><div style="font-size:0.6875rem;color:#94a3b8;">Jan 17, 2026</div></div>
              </div>
              <div style="display:flex;gap:0.625rem;font-size:0.8125rem;">
                <span style="width:8px;height:8px;border-radius:50%;background:#e2e8f0;margin-top:5px;flex-shrink:0;"></span>
                <div style="color:#94a3b8;"><div>Awaiting dispatch...</div></div>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="card card-pad">
            <div style="font-size:0.875rem;font-weight:600;margin-bottom:0.75rem;">Actions</div>
            <div style="display:flex;flex-direction:column;gap:0.5rem;">
              <button class="btn-sm btn-out" style="width:100%;justify-content:center;" onclick="goTo('contract')">View Contract</button>
              <button class="btn-sm btn-out" style="width:100%;justify-content:center;" onclick="goTo('invoice')">Create Invoice</button>
              <button class="btn-sm btn-out" style="width:100%;justify-content:center;" onclick="goTo('estimate-detail')">Back to Estimate</button>
            </div>
          </div>
        </div>
      </div>

      <div class="note-box green">
        <p class="title">Step 5: Job Detail</p>
        <p>The job is <b>linked back to the estimate</b> via the blue "From Estimate: EST-001" bar. It inherits addresses, line items, notes, and deposit info. The right column shows <b>contracts</b> attached to this job and a timeline of events.</p>
        <p style="margin-top:0.5rem;"><b>Key connection:</b> Estimate has <code>jobId</code> → this job. Job doesn't store estimateId directly, but the estimate detail's Jobs card shows the linked job, and the job header links back.</p>
      </div>
    </div>

    <!-- ========================================= -->
    <!-- VIEW 6: CONTRACT                          -->
    <!-- ========================================= -->
    <div class="view fade-in" id="v-contract">
      <div class="breadcrumb">
        <a onclick="goTo('estimate-list')">Estimates</a>
        <span class="sep">/</span>
        <a onclick="goTo('estimate-detail')">EST-001</a>
        <span class="sep">/</span>
        <a onclick="goTo('job-detail')">Job EST-001-1</a>
        <span class="sep">/</span>
        <span>Hourly Contract</span>
      </div>

      <div class="card" style="padding:1rem 1.25rem;margin-bottom:1rem;">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <div>
            <h1 style="font-size:1.125rem;font-weight:700;margin:0;">Hourly Contract</h1>
            <div style="font-size:0.75rem;color:#64748b;">Job EST-001-1 &bull; John &bull; Feb 27, 2026</div>
          </div>
          <div class="flex items-center gap-2">
            <span style="font-size:0.6875rem;background:#fef3c7;color:#92400e;padding:2px 8px;border-radius:9999px;font-weight:600;">Awaiting Signature</span>
            <button class="btn-sm btn-out">Preview</button>
            <button class="btn-sm btn-blue">Send to Customer</button>
          </div>
        </div>
      </div>

      <!-- Contract Blocks Preview -->
      <div style="max-width:700px;margin:0 auto;">
        <div class="card card-pad" style="margin-bottom:1rem;">
          <div style="font-size:0.875rem;font-weight:600;margin-bottom:0.5rem;">Company Header</div>
          <div style="background:#f8fafc;padding:1rem;border-radius:0.5rem;text-align:center;">
            <div style="font-size:1rem;font-weight:700;">ARM Moving LLC</div>
            <div style="font-size:0.75rem;color:#64748b;">1237 S Val Vista Dr, Mesa, AZ 85204</div>
          </div>
        </div>

        <div class="card card-pad" style="margin-bottom:1rem;">
          <div style="font-size:0.875rem;font-weight:600;margin-bottom:0.5rem;">Pricing Table</div>
          <div class="pr"><span>Moving Services (2 movers × $150/hr)</span><span style="font-weight:500;">$300.00</span></div>
          <div class="pr"><span>Trip Fee</span><span style="font-weight:500;">$125.00</span></div>
          <div style="border-top:1px solid #e2e8f0;margin:0.5rem 0;"></div>
          <div class="pr"><span style="font-weight:700;">Total</span><span style="font-weight:700;">$425.00</span></div>
        </div>

        <div class="card card-pad" style="margin-bottom:1rem;">
          <div style="font-size:0.875rem;font-weight:600;margin-bottom:0.5rem;">Time Tracking (Crew)</div>
          <div style="background:#f8fafc;padding:1rem;border-radius:0.5rem;text-align:center;color:#94a3b8;font-size:0.8125rem;">
            <div>Crew clocks in/out on job day</div>
            <div style="font-size:0.75rem;margin-top:0.25rem;">GPS verified &bull; Billable hours auto-calculated</div>
          </div>
        </div>

        <div class="card card-pad" style="margin-bottom:1rem;border-color:#f59e0b;">
          <div style="font-size:0.875rem;font-weight:600;margin-bottom:0.5rem;">Signature Block</div>
          <div style="display:flex;gap:1rem;">
            <div style="flex:1;border:1px dashed #e2e8f0;border-radius:0.5rem;padding:1rem;text-align:center;">
              <div style="font-size:0.75rem;color:#64748b;margin-bottom:0.25rem;">Customer Signature</div>
              <div style="font-size:0.8125rem;color:#f59e0b;">Awaiting...</div>
            </div>
            <div style="flex:1;border:1px dashed #e2e8f0;border-radius:0.5rem;padding:1rem;text-align:center;">
              <div style="font-size:0.75rem;color:#64748b;margin-bottom:0.25rem;">Company Signature</div>
              <div style="font-size:0.8125rem;color:#94a3b8;">Pending customer first</div>
            </div>
          </div>
        </div>

        <div class="card card-pad" style="margin-bottom:1rem;">
          <div style="font-size:0.875rem;font-weight:600;margin-bottom:0.5rem;">Payment Block</div>
          <div class="fi"><span class="fi-label">Deposit</span><span style="color:#16a34a;font-weight:600;">$100.00 Paid</span></div>
          <div class="fi"><span class="fi-label">Balance Due</span><span style="font-weight:600;">$325.00 on completion</span></div>
        </div>
      </div>

      <div class="note-box amber">
        <p class="title">Step 6: Contract</p>
        <p>Contracts are <b>attached to jobs</b> (not estimates). They're built from templates with blocks: company header, pricing table, time tracking, signatures, payments. The customer signs via a public link (<code>/contracts/sign/[token]</code>). On job day, the crew uses time tracking blocks for clock-in/out.</p>
        <p style="margin-top:0.5rem;"><b>Connection:</b> contract_instances.job_id → jobs.id. A job can have multiple contracts (hourly contract, work order, etc.).</p>
      </div>
    </div>

    <!-- ========================================= -->
    <!-- VIEW 7: INVOICE                           -->
    <!-- ========================================= -->
    <div class="view fade-in" id="v-invoice">
      <div class="breadcrumb">
        <a onclick="goTo('estimate-list')">Estimates</a>
        <span class="sep">/</span>
        <a onclick="goTo('job-detail')">Job EST-001-1</a>
        <span class="sep">/</span>
        <span>Invoice</span>
      </div>

      <div class="card" style="padding:1rem 1.25rem;margin-bottom:1rem;">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <div>
            <h1 style="font-size:1.125rem;font-weight:700;margin:0;">Invoice #INV-001</h1>
            <div style="font-size:0.75rem;color:#64748b;">Job EST-001-1 &bull; John &bull; Due Mar 6, 2026</div>
          </div>
          <div class="flex items-center gap-2">
            <span style="font-size:0.6875rem;background:#fef3c7;color:#92400e;padding:2px 8px;border-radius:9999px;font-weight:600;">Outstanding</span>
            <button class="btn-sm btn-out">Download PDF</button>
            <button class="btn-sm btn-blue">Record Payment</button>
          </div>
        </div>
      </div>

      <div style="max-width:600px;margin:0 auto;">
        <div class="card card-pad">
          <div style="background:#f8fafc;border-radius:0.5rem;padding:0.75rem;margin-bottom:1rem;display:flex;align-items:center;gap:0.75rem;">
            <div style="font-size:0.8125rem;color:#64748b;">Linked to:</div>
            <a href="#" onclick="event.preventDefault();goTo('estimate-detail')" style="color:#2563eb;font-size:0.8125rem;">Estimate EST-001</a>
            <span style="color:#cbd5e1;">&bull;</span>
            <a href="#" onclick="event.preventDefault();goTo('job-detail')" style="color:#2563eb;font-size:0.8125rem;">Job EST-001-1</a>
          </div>

          <div class="pr"><span>Moving Services (2 movers × 2.5 hrs actual)</span><span style="font-weight:500;">$375.00</span></div>
          <div class="pr"><span>Trip Fee</span><span style="font-weight:500;">$125.00</span></div>
          <div style="border-top:1px solid #e2e8f0;margin:0.5rem 0;"></div>
          <div class="pr"><span style="font-weight:600;">Subtotal</span><span style="font-weight:600;">$500.00</span></div>
          <div class="pr"><span>Tax (8.6%)</span><span>$43.00</span></div>
          <div style="border-top:1px solid #e2e8f0;margin:0.5rem 0;"></div>
          <div class="pr"><span style="font-weight:700;">Total</span><span style="font-weight:700;">$543.00</span></div>

          <div style="border-top:1px solid #e2e8f0;margin:0.75rem 0;"></div>
          <div style="font-size:0.8125rem;font-weight:600;margin-bottom:0.5rem;">Payments</div>
          <div class="pr"><span style="color:#16a34a;">Deposit (Jan 16)</span><span style="color:#16a34a;">-$100.00</span></div>
          <div style="border-top:1px solid #e2e8f0;margin:0.5rem 0;"></div>
          <div class="pr"><span style="font-weight:700;font-size:1rem;">Balance Due</span><span style="font-weight:700;font-size:1rem;color:#dc2626;">$443.00</span></div>
        </div>
      </div>

      <div class="note-box blue">
        <p class="title">Step 7: Invoice</p>
        <p>The invoice is linked to <b>both the job and the estimate</b>. It may differ from the estimate if the job took longer (hourly billing). The deposit from the estimate approval is automatically applied. This is the final billing step.</p>
        <p style="margin-top:0.5rem;"><b>Notice:</b> The estimate was $425 but the actual job took 2.5 hours instead of 2, so the invoice is $500 + tax. The $100 deposit is deducted.</p>
      </div>
    </div>

  </div>

  <script>
    const views = ['estimate-list','estimate-detail','estimate-page','approval','job-detail','contract','invoice'];
    const flowBoxes = ['fb-list','fb-detail','fb-page','fb-approve','fb-job','fb-contract','fb-invoice'];

    function goTo(view) {
      // Hide all views
      views.forEach(v => {
        document.getElementById('v-' + v).classList.remove('active');
      });
      // Show target
      const el = document.getElementById('v-' + view);
      el.classList.add('active');
      el.classList.remove('fade-in');
      void el.offsetWidth;
      el.classList.add('fade-in');

      // Update flow diagram highlights
      const idx = views.indexOf(view);
      flowBoxes.forEach((fb, i) => {
        const box = document.getElementById(fb);
        if (i === idx) {
          box.classList.add('active');
        } else {
          box.classList.remove('active');
        }
      });

      // Update main tabs
      if (view === 'job-detail') {
        setMainTab('jobs');
      } else {
        setMainTab('estimates');
      }

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function switchMainTab(tab) {
      if (tab === 'estimates') goTo('estimate-list');
      else if (tab === 'jobs') goTo('job-detail');
    }

    function setMainTab(tab) {
      document.querySelectorAll('.tab-main').forEach(t => t.classList.remove('on'));
      document.getElementById('tab-' + tab)?.classList.add('on');
    }
  </script>

</body>
</html>
